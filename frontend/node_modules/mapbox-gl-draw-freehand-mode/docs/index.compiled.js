(()=>{"use strict";const e="add",t="polygon",o="Feature",n="Polygon",r="simple_select",i="vertex",a="true",s="false";function u(e){const t=e.featureTarget;return!!t&&!!t.properties&&t.properties.meta===i}const c={enable(e){setTimeout((()=>{e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()}),0)},disable(e){setTimeout((()=>{e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()}),0)}};function l(e,t,n,r){return{type:o,properties:{meta:i,parent:e,coord_path:n,active:r?a:s},geometry:{type:"Point",coordinates:t}}}const p={onSetup:function(){const r=this.newFeature({type:o,properties:{},geometry:{type:n,coordinates:[[]]}});return this.addFeature(r),this.clearSelectedFeatures(),c.disable(this),this.updateUIClasses({mouse:e}),this.activateUIButton(t),this.setActionableState({trash:!0}),{polygon:r,currentVertexPosition:0}},clickAnywhere:function(t,o){if(t.currentVertexPosition>0&&(n=o,i=t.polygon.coordinates[0][t.currentVertexPosition-1],n.lngLat&&n.lngLat.lng===i[0]&&n.lngLat.lat===i[1]))return this.changeMode(r,{featureIds:[t.polygon.id]});var n,i;this.updateUIClasses({mouse:e}),t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,o.lngLat.lng,o.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,o.lngLat.lng,o.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(r,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),u(t)&&this.updateUIClasses({mouse:"pointer"})}};p.onTap=p.onClick=function(e,t){return u(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},p.onKeyUp=function(e,t){!function(e){return 27===e.keyCode}(t)?function(e){return 13===e.keyCode}(t)&&this.changeMode(r,{featureIds:[e.polygon.id]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(r))},p.onStop=function(e){this.updateUIClasses({mouse:"none"}),c.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.polygon.id)&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.map.fire("draw.create",{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(r,{},{silent:!0})))},p.toDisplayFeatures=function(e,t,n){const r=t.properties.id===e.polygon.id;if(t.properties.active=r?a:s,!r)return n(t);if(0===t.geometry.coordinates.length)return;const i=t.geometry.coordinates[0].length;if(!(i<3)){if(t.properties.meta="feature",n(l(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),i>3){const o=t.geometry.coordinates[0].length-3;n(l(e.polygon.id,t.geometry.coordinates[0][o],`0.${o}`,!1))}if(i<=4){const e=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(n({type:o,properties:t.properties,geometry:{coordinates:e,type:"LineString"}}),3===i)return}return n(t)}},p.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(r)};const g=p;function d(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function y(e){var t=d(e);if(2===t.length&&!f(t[0],t[1]))return t;var o=[],n=t.length-1,r=o.length;o.push(t[0]);for(var i=1;i<n;i++){var a=o[o.length-1];t[i][0]===a[0]&&t[i][1]===a[1]||(o.push(t[i]),(r=o.length)>2&&h(o[r-3],o[r-1],o[r-2])&&o.splice(o.length-2,1))}if(o.push(t[t.length-1]),r=o.length,f(t[0],t[t.length-1])&&r<4)throw new Error("invalid polygon");return h(o[r-3],o[r-1],o[r-2])&&o.splice(o.length-2,1),o}function f(e,t){return e[0]===t[0]&&e[1]===t[1]}function h(e,t,o){var n=o[0],r=o[1],i=e[0],a=e[1],s=t[0],u=t[1],c=s-i,l=u-a;return 0==(n-i)*l-(r-a)*c&&(Math.abs(c)>=Math.abs(l)?c>0?i<=n&&n<=s:s<=n&&n<=i:l>0?a<=r&&r<=u:u<=r&&r<=a)}function m(e){var t={type:"Feature"};return Object.keys(e).forEach((function(o){switch(o){case"type":case"properties":case"geometry":return;default:t[o]=e[o]}})),t.properties=b(e.properties),t.geometry=v(e.geometry),t}function b(e){var t={};return e?(Object.keys(e).forEach((function(o){var n=e[o];"object"==typeof n?null===n?t[o]=null:Array.isArray(n)?t[o]=n.map((function(e){return e})):t[o]=b(n):t[o]=n})),t):t}function v(e){var t={type:e.type};return e.bbox&&(t.bbox=e.bbox),"GeometryCollection"===e.type?(t.geometries=e.geometries.map((function(e){return v(e)})),t):(t.coordinates=x(e.coordinates),t)}function x(e){var t=e;return"object"!=typeof t[0]?t.slice():t.map((function(e){return x(e)}))}function w(e,t,o){var n=t.x,r=t.y,i=o.x-n,a=o.y-r;if(0!==i||0!==a){var s=((e.x-n)*i+(e.y-r)*a)/(i*i+a*a);s>1?(n=o.x,r=o.y):s>0&&(n+=i*s,r+=a*s)}return(i=e.x-n)*i+(a=e.y-r)*a}function C(e,t,o,n,r){for(var i,a=n,s=t+1;s<o;s++){var u=w(e[s],e[t],e[o]);u>a&&(i=s,a=u)}a>n&&(i-t>1&&C(e,t,i,n,r),r.push(e[i]),o-i>1&&C(e,i,o,n,r))}function M(e,t){var o=e.length-1,n=[e[0]];return C(e,0,o,t,n),n.push(e[o]),n}function P(e,t,o){if(e.length<=2)return e;var n=void 0!==t?t*t:1;return M(e=o?e:function(e,t){for(var o,n,r,i,a,s=e[0],u=[s],c=1,l=e.length;c<l;c++)r=s,void 0,void 0,(i=(n=o=e[c]).x-r.x)*i+(a=n.y-r.y)*a>t&&(u.push(o),s=o);return s!==o&&u.push(o),u}(e,n),n)}function k(e,t,o){return P(e.map((function(e){return{x:e[0],y:e[1],z:e[2]}})),t,o).map((function(e){return e.z?[e.x,e.y,e.z]:[e.x,e.y]}))}function F(e,t,o){return e.map((function(e){var n=e.map((function(e){return{x:e[0],y:e[1]}}));if(n.length<4)throw new Error("invalid polygon");for(var r=P(n,t,o).map((function(e){return[e.x,e.y]}));!S(r);)r=P(n,t-=.01*t,o).map((function(e){return[e.x,e.y]}));return r[r.length-1][0]===r[0][0]&&r[r.length-1][1]===r[0][1]||r.push(r[0]),r}))}function S(e){return!(e.length<3||3===e.length&&e[2][0]===e[0][0]&&e[2][1]===e[0][1])}const L=function(e,t){if(!(o=t=t||{})||o.constructor!==Object)throw new Error("options is invalid");var o,n=void 0!==t.tolerance?t.tolerance:1,r=t.highQuality||!1,i=t.mutate||!1;if(!e)throw new Error("geojson is required");if(n&&n<0)throw new Error("invalid tolerance");return!0!==i&&(e=function(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return m(e);case"FeatureCollection":return function(e){var t={type:"FeatureCollection"};return Object.keys(e).forEach((function(o){switch(o){case"type":case"features":return;default:t[o]=e[o]}})),t.features=e.features.map((function(e){return m(e)})),t}(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return v(e);default:throw new Error("unknown GeoJSON type")}}(e)),function(e,t){var o,n,r,i,a,s,u,c,l,p,g=0,d="FeatureCollection"===e.type,y="Feature"===e.type,f=d?e.features.length:1;for(o=0;o<f;o++){for(s=d?e.features[o].geometry:y?e.geometry:e,c=d?e.features[o].properties:y?e.properties:{},l=d?e.features[o].bbox:y?e.bbox:void 0,p=d?e.features[o].id:y?e.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,r=0;r<a;r++)if(null!==(i=u?s.geometries[r]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(i,g,c,l,p))return!1;break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(!1===t(i.geometries[n],g,c,l,p))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,g,c,l,p))return!1;g++}}(e,(function(e){!function(e,t,o){var n=e.type;if("Point"===n||"MultiPoint"===n)return e;!function(e,t){void 0===t&&(t={});var o="object"==typeof t?t.mutate:t;if(!e)throw new Error("geojson is required");var n=function(e,t){return"FeatureCollection"===e.type?"FeatureCollection":"GeometryCollection"===e.type?"GeometryCollection":"Feature"===e.type&&null!==e.geometry?e.geometry.type:e.type}(e),r=[];switch(n){case"LineString":r=y(e);break;case"MultiLineString":case"Polygon":d(e).forEach((function(e){r.push(y(e))}));break;case"MultiPolygon":d(e).forEach((function(e){var t=[];e.forEach((function(e){t.push(y(e))})),r.push(t)}));break;case"Point":return e;case"MultiPoint":var i={};d(e).forEach((function(e){var t=e.join("-");i.hasOwnProperty(t)||(r.push(e),i[t]=!0)}));break;default:throw new Error(n+" geometry not supported")}e.coordinates?!0===o&&(e.coordinates=r):!0===o?e.geometry.coordinates=r:function(e,t,o){void 0===o&&(o={});var n={type:"Feature"};(0===o.id||o.id)&&(n.id=o.id),o.bbox&&(n.bbox=o.bbox),n.properties=t||{},n.geometry=e}({type:n,coordinates:r},e.properties,{bbox:e.bbox,id:e.id})}(e,!0);var r=e.coordinates;switch(n){case"LineString":e.coordinates=k(r,t,o);break;case"MultiLineString":e.coordinates=r.map((function(e){return k(e,t,o)}));break;case"Polygon":e.coordinates=F(r,t,o);break;case"MultiPolygon":e.coordinates=r.map((function(e){return F(e,t,o)}))}}(e,n,r)})),e},E=Object.assign({},g);E.onSetup=function(){const r=this.newFeature({type:o,properties:{},geometry:{type:n,coordinates:[[]]}});return this.addFeature(r),this.clearSelectedFeatures(),setTimeout((()=>{this.map&&this.map.dragPan&&this.map.dragPan.disable()}),0),this.updateUIClasses({mouse:e}),this.activateUIButton(t),this.setActionableState({trash:!0}),{polygon:r,currentVertexPosition:0,dragMoving:!1}},E.onDrag=E.onTouchMove=function(t,o){t.dragMoving=!0,this.updateUIClasses({mouse:e}),t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,o.lngLat.lng,o.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,o.lngLat.lng,o.lngLat.lat)},E.onMouseUp=function(e,t){e.dragMoving&&(this.simplify(e.polygon),this.fireUpdate(),this.changeMode(r,{featureIds:[e.polygon.id]}))},E.onTouchEnd=function(e,t){this.onMouseUp(e,t)},E.fireUpdate=function(){this.map.fire("draw.update",{action:"move",features:this.getSelected().map((e=>e.toGeoJSON()))})},E.simplify=function(e){const t=1/Math.pow(1.05,10*this.map.getZoom());L(e,{mutate:!0,tolerance:t,highQuality:!0})};const V=E;mapboxgl.accessToken="pk.eyJ1IjoiYmVuZWhta2UiLCJhIjoiY2plYTl6b3c2MHg5ODJxbGV4aXR4Z3p6YSJ9.d3jSAbsqSmpJwyVcp9iXbw";var I=new mapboxgl.Map({container:document.getElementById("map"),style:"mapbox://styles/mapbox/streets-v11",center:[-94.737236,32.514885],zoom:12}),j=new MapboxDraw({modes:Object.assign(MapboxDraw.modes,{draw_polygon:V})});I.addControl(j,"top-left"),I.on("draw.create",(function(){console.log(arguments,j.getAll())}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXBib3gtZ2wtZHJhdy1mcmVlaGFuZC1tb2RlLy4vbm9kZV9tb2R1bGVzL0BtYXBib3gvbWFwYm94LWdsLWRyYXcvc3JjL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly9tYXBib3gtZ2wtZHJhdy1mcmVlaGFuZC1tb2RlLy4vbm9kZV9tb2R1bGVzL0BtYXBib3gvbWFwYm94LWdsLWRyYXcvc3JjL2xpYi9jb21tb25fc2VsZWN0b3JzLmpzIiwid2VicGFjazovL21hcGJveC1nbC1kcmF3LWZyZWVoYW5kLW1vZGUvLi9ub2RlX21vZHVsZXMvQG1hcGJveC9tYXBib3gtZ2wtZHJhdy9zcmMvbGliL2RvdWJsZV9jbGlja196b29tLmpzIiwid2VicGFjazovL21hcGJveC1nbC1kcmF3LWZyZWVoYW5kLW1vZGUvLi9ub2RlX21vZHVsZXMvQG1hcGJveC9tYXBib3gtZ2wtZHJhdy9zcmMvbGliL2NyZWF0ZV92ZXJ0ZXguanMiLCJ3ZWJwYWNrOi8vbWFwYm94LWdsLWRyYXctZnJlZWhhbmQtbW9kZS8uL25vZGVfbW9kdWxlcy9AbWFwYm94L21hcGJveC1nbC1kcmF3L3NyYy9tb2Rlcy9kcmF3X3BvbHlnb24uanMiLCJ3ZWJwYWNrOi8vbWFwYm94LWdsLWRyYXctZnJlZWhhbmQtbW9kZS8uL25vZGVfbW9kdWxlcy9AbWFwYm94L21hcGJveC1nbC1kcmF3L3NyYy9saWIvaXNfZXZlbnRfYXRfY29vcmRpbmF0ZXMuanMiLCJ3ZWJwYWNrOi8vbWFwYm94LWdsLWRyYXctZnJlZWhhbmQtbW9kZS8uL25vZGVfbW9kdWxlcy9AdHVyZi9pbnZhcmlhbnQvZGlzdC9lcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9tYXBib3gtZ2wtZHJhdy1mcmVlaGFuZC1tb2RlLy4vbm9kZV9tb2R1bGVzL0B0dXJmL2NsZWFuLWNvb3Jkcy9kaXN0L2VzL2luZGV4LmpzIiwid2VicGFjazovL21hcGJveC1nbC1kcmF3LWZyZWVoYW5kLW1vZGUvLi9ub2RlX21vZHVsZXMvQHR1cmYvY2xvbmUvZGlzdC9lcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9tYXBib3gtZ2wtZHJhdy1mcmVlaGFuZC1tb2RlLy4vbm9kZV9tb2R1bGVzL0B0dXJmL3NpbXBsaWZ5L2Rpc3QvZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vbWFwYm94LWdsLWRyYXctZnJlZWhhbmQtbW9kZS8uL25vZGVfbW9kdWxlcy9AdHVyZi9oZWxwZXJzL2Rpc3QvZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vbWFwYm94LWdsLWRyYXctZnJlZWhhbmQtbW9kZS8uL25vZGVfbW9kdWxlcy9AdHVyZi9tZXRhL2Rpc3QvZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vbWFwYm94LWdsLWRyYXctZnJlZWhhbmQtbW9kZS8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly9tYXBib3gtZ2wtZHJhdy1mcmVlaGFuZC1tb2RlLy4vZG9jcy9pbmRleC5qcyJdLCJuYW1lcyI6WyJjdXJzb3JzIiwidHlwZXMiLCJnZW9qc29uVHlwZXMiLCJtb2RlcyIsIm1ldGEiLCJhY3RpdmVTdGF0ZXMiLCJpc1ZlcnRleCIsImUiLCJmZWF0dXJlVGFyZ2V0IiwicHJvcGVydGllcyIsImN0eCIsInNldFRpbWVvdXQiLCJtYXAiLCJkb3VibGVDbGlja1pvb20iLCJfY3R4Iiwic3RvcmUiLCJnZXRJbml0aWFsQ29uZmlnVmFsdWUiLCJlbmFibGUiLCJkaXNhYmxlIiwicGFyZW50SWQiLCJjb29yZGluYXRlcyIsInBhdGgiLCJzZWxlY3RlZCIsInR5cGUiLCJwYXJlbnQiLCJjb29yZF9wYXRoIiwiYWN0aXZlIiwiZ2VvbWV0cnkiLCJEcmF3UG9seWdvbiIsInBvbHlnb24iLCJ0aGlzIiwibmV3RmVhdHVyZSIsImFkZEZlYXR1cmUiLCJjbGVhclNlbGVjdGVkRmVhdHVyZXMiLCJ1cGRhdGVVSUNsYXNzZXMiLCJtb3VzZSIsImFjdGl2YXRlVUlCdXR0b24iLCJzZXRBY3Rpb25hYmxlU3RhdGUiLCJ0cmFzaCIsImN1cnJlbnRWZXJ0ZXhQb3NpdGlvbiIsInN0YXRlIiwiZXZlbnQiLCJsbmdMYXQiLCJsbmciLCJsYXQiLCJjaGFuZ2VNb2RlIiwiZmVhdHVyZUlkcyIsImlkIiwidXBkYXRlQ29vcmRpbmF0ZSIsIm9uVGFwIiwib25DbGljayIsImNsaWNrT25WZXJ0ZXgiLCJjbGlja0FueXdoZXJlIiwib25LZXlVcCIsImtleUNvZGUiLCJkZWxldGVGZWF0dXJlIiwic2lsZW50Iiwib25TdG9wIiwidW5kZWZpbmVkIiwiZ2V0RmVhdHVyZSIsInJlbW92ZUNvb3JkaW5hdGUiLCJpc1ZhbGlkIiwiZmlyZSIsImZlYXR1cmVzIiwidG9HZW9KU09OIiwidG9EaXNwbGF5RmVhdHVyZXMiLCJnZW9qc29uIiwiZGlzcGxheSIsImlzQWN0aXZlUG9seWdvbiIsImxlbmd0aCIsImNvb3JkaW5hdGVDb3VudCIsImVuZFBvcyIsImxpbmVDb29yZGluYXRlcyIsIm9uVHJhc2giLCJnZXRDb29yZHMiLCJjb29yZHMiLCJBcnJheSIsImlzQXJyYXkiLCJFcnJvciIsImNsZWFuTGluZSIsImxpbmUiLCJwb2ludHMiLCJlcXVhbHMiLCJuZXdQb2ludHMiLCJzZWNvbmRUb0xhc3QiLCJuZXdQb2ludHNMZW5ndGgiLCJwdXNoIiwiaSIsInByZXZBZGRlZFBvaW50IiwiaXNQb2ludE9uTGluZVNlZ21lbnQiLCJzcGxpY2UiLCJwdDEiLCJwdDIiLCJzdGFydCIsImVuZCIsInBvaW50IiwieCIsInkiLCJzdGFydFgiLCJzdGFydFkiLCJlbmRYIiwiZW5kWSIsImR4bCIsImR5bCIsIk1hdGgiLCJhYnMiLCJjbG9uZUZlYXR1cmUiLCJjbG9uZWQiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsImtleSIsImNsb25lUHJvcGVydGllcyIsImNsb25lR2VvbWV0cnkiLCJ2YWx1ZSIsIml0ZW0iLCJnZW9tIiwiYmJveCIsImdlb21ldHJpZXMiLCJnIiwiZGVlcFNsaWNlIiwic2xpY2UiLCJjb29yZCIsImdldFNxU2VnRGlzdCIsInAiLCJwMSIsInAyIiwiZHgiLCJkeSIsInQiLCJzaW1wbGlmeURQU3RlcCIsImZpcnN0IiwibGFzdCIsInNxVG9sZXJhbmNlIiwic2ltcGxpZmllZCIsImluZGV4IiwibWF4U3FEaXN0Iiwic3FEaXN0Iiwic2ltcGxpZnlEb3VnbGFzUGV1Y2tlciIsInNpbXBsaWZ5IiwidG9sZXJhbmNlIiwiaGlnaGVzdFF1YWxpdHkiLCJwcmV2UG9pbnQiLCJsZW4iLCJzaW1wbGlmeVJhZGlhbERpc3QiLCJzaW1wbGlmeUxpbmUiLCJoaWdoUXVhbGl0eSIsInoiLCJzaW1wbGlmeVBvbHlnb24iLCJyaW5nIiwicHRzIiwic2ltcGxlUmluZyIsImNoZWNrVmFsaWRpdHkiLCJvcHRpb25zIiwiaW5wdXQiLCJjb25zdHJ1Y3RvciIsIm11dGF0ZSIsImZlYXR1cmUiLCJjbG9uZUZlYXR1cmVDb2xsZWN0aW9uIiwiY2FsbGJhY2siLCJqIiwic3RvcEciLCJnZW9tZXRyeU1heWJlQ29sbGVjdGlvbiIsImlzR2VvbWV0cnlDb2xsZWN0aW9uIiwiZmVhdHVyZVByb3BlcnRpZXMiLCJmZWF0dXJlQkJveCIsImZlYXR1cmVJZCIsImZlYXR1cmVJbmRleCIsImlzRmVhdHVyZUNvbGxlY3Rpb24iLCJpc0ZlYXR1cmUiLCJzdG9wIiwiZ2VvbUVhY2giLCJfbmFtZSIsImdldFR5cGUiLCJuZXdDb29yZHMiLCJwb2x5Z29ucyIsInBvbHlQb2ludHMiLCJleGlzdGluZyIsImpvaW4iLCJoYXNPd25Qcm9wZXJ0eSIsImZlYXQiLCJsaW5lcyIsInJpbmdzIiwic2ltcGxpZnlHZW9tIiwiRnJlZWhhbmRNb2RlIiwiYXNzaWduIiwib25TZXR1cCIsImRyYWdQYW4iLCJkcmFnTW92aW5nIiwib25EcmFnIiwib25Ub3VjaE1vdmUiLCJvbk1vdXNlVXAiLCJmaXJlVXBkYXRlIiwib25Ub3VjaEVuZCIsImFjdGlvbiIsImdldFNlbGVjdGVkIiwiZiIsInBvdyIsImdldFpvb20iLCJtYXBib3hnbCIsImFjY2Vzc1Rva2VuIiwiTWFwIiwiY29udGFpbmVyIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiY2VudGVyIiwiem9vbSIsIkRyYXciLCJNYXBib3hEcmF3IiwiZHJhd19wb2x5Z29uIiwiYWRkQ29udHJvbCIsIm9uIiwiY29uc29sZSIsImxvZyIsImFyZ3VtZW50cyIsImdldEFsbCJdLCJtYXBwaW5ncyI6Im1CQUFPLE1BcUJNQSxFQUNOLE1BT01DLEVBQ0YsVUFLRUMsRUFDRixVQURFQSxFQUVGLFVBVUVDLEVBSUksZ0JBc0JKQyxFQUdILFNBR0dDLEVBQ0gsT0FER0EsRUFFRCxRQ3hDTCxTQUFTQyxFQUFTQyxHQUN2QixNQUFNQyxFQUFnQkQsRUFBRUMsY0FDeEIsUUFBS0EsS0FDQUEsRUFBY0MsWUFDWkQsRUFBY0MsV0FBV0wsT0FBUyxFQzdDM0MsU0FDRSxPQUFPTSxHQUNMQyxZQUFXLEtBRUpELEVBQUlFLEtBQVFGLEVBQUlFLElBQUlDLGlCQUFvQkgsRUFBSUksTUFBU0osRUFBSUksS0FBS0MsT0FBVUwsRUFBSUksS0FBS0MsTUFBTUMsdUJBRXZGTixFQUFJSSxLQUFLQyxNQUFNQyxzQkFBc0Isb0JBQzFDTixFQUFJRSxJQUFJQyxnQkFBZ0JJLFdBQ3ZCLElBRUwsUUFBUVAsR0FDTkMsWUFBVyxLQUNKRCxFQUFJRSxLQUFRRixFQUFJRSxJQUFJQyxpQkFFekJILEVBQUlFLElBQUlDLGdCQUFnQkssWUFDdkIsS0NGUSxXQUFTQyxFQUFVQyxFQUFhQyxFQUFNQyxHQUNuRCxNQUFPLENBQ0xDLEtBQU0sRUFDTmQsV0FBWSxDQUNWTCxLQUFNLEVBQ05vQixPQUFRTCxFQUNSTSxXQUFZSixFQUNaSyxPQUFRLEVBQWEsRUFBZ0MsR0FFdkRDLFNBQVUsQ0FDUkosS0hnQkcsUUdmSEgsZ0JDbEJOLE1BQU1RLEVBQWMsQ0FFcEIsUUFBc0IsV0FDcEIsTUFBTUMsRUFBVUMsS0FBS0MsV0FBVyxDQUM5QlIsS0FBTSxFQUNOZCxXQUFZLEdBQ1prQixTQUFVLENBQ1JKLEtBQU0sRUFDTkgsWUFBYSxDQUFDLE9BY2xCLE9BVkFVLEtBQUtFLFdBQVdILEdBRWhCQyxLQUFLRyx3QkFDTCxVQUF3QkgsTUFDeEJBLEtBQUtJLGdCQUFnQixDQUFFQyxNQUFPLElBQzlCTCxLQUFLTSxpQkFBaUIsR0FDdEJOLEtBQUtPLG1CQUFtQixDQUN0QkMsT0FBTyxJQUdGLENBQ0xULFVBQ0FVLHNCQUF1QixJQUkzQixjQUE0QixTQUFTQyxFQUFPakMsR0FDMUMsR0FBSWlDLEVBQU1ELHNCQUF3QixJQ25DTkUsRURtQ2dDbEMsRUNuQ3pCYSxFRG1DNEJvQixFQUFNWCxRQUFRVCxZQUFZLEdBQUdvQixFQUFNRCxzQkFBd0IsR0NsQ3JIRSxFQUFNQyxRQUNKRCxFQUFNQyxPQUFPQyxNQUFRdkIsRUFBWSxJQUFNcUIsRUFBTUMsT0FBT0UsTUFBUXhCLEVBQVksSURrQzdFLE9BQU9VLEtBQUtlLFdBQVcsRUFBK0IsQ0FBRUMsV0FBWSxDQUFDTixFQUFNWCxRQUFRa0IsTUNwQ3ZGLElBQThCTixFQUFPckIsRURzQ25DVSxLQUFLSSxnQkFBZ0IsQ0FBRUMsTUFBTyxJQUM5QkssRUFBTVgsUUFBUW1CLGlCQUFpQixLQUFLUixFQUFNRCx3QkFBeUJoQyxFQUFFbUMsT0FBT0MsSUFBS3BDLEVBQUVtQyxPQUFPRSxLQUMxRkosRUFBTUQsd0JBQ05DLEVBQU1YLFFBQVFtQixpQkFBaUIsS0FBS1IsRUFBTUQsd0JBQXlCaEMsRUFBRW1DLE9BQU9DLElBQUtwQyxFQUFFbUMsT0FBT0UsTUFHNUYsY0FBNEIsU0FBU0osR0FDbkMsT0FBT1YsS0FBS2UsV0FBVyxFQUErQixDQUFFQyxXQUFZLENBQUNOLEVBQU1YLFFBQVFrQixPQUdyRixZQUEwQixTQUFTUCxFQUFPakMsR0FDeENpQyxFQUFNWCxRQUFRbUIsaUJBQWlCLEtBQUtSLEVBQU1ELHdCQUF5QmhDLEVBQUVtQyxPQUFPQyxJQUFLcEMsRUFBRW1DLE9BQU9FLEtBQ3RGLEVBQXlCckMsSUFDM0J1QixLQUFLSSxnQkFBZ0IsQ0FBRUMsTUoxQmhCLGNJOEJYUCxFQUFZcUIsTUFBUXJCLEVBQVlzQixRQUFVLFNBQVNWLEVBQU9qQyxHQUN4RCxPQUFJLEVBQXlCQSxHQUFXdUIsS0FBS3FCLGNBQWNYLEVBQU9qQyxHQUMzRHVCLEtBQUtzQixjQUFjWixFQUFPakMsSUFHbkNxQixFQUFZeUIsUUFBVSxTQUFTYixFQUFPakMsSUhQL0IsU0FBcUJBLEdBQzFCLE9BQXFCLEtBQWRBLEVBQUUrQyxRR09MLENBQTRCL0MsR0hKM0IsU0FBb0JBLEdBQ3pCLE9BQXFCLEtBQWRBLEVBQUUrQyxRR01FLENBQTJCL0MsSUFDcEN1QixLQUFLZSxXQUFXLEVBQStCLENBQUVDLFdBQVksQ0FBQ04sRUFBTVgsUUFBUWtCLE9BSDVFakIsS0FBS3lCLGNBQWMsQ0FBQ2YsRUFBTVgsUUFBUWtCLElBQUssQ0FBRVMsUUFBUSxJQUNqRDFCLEtBQUtlLFdBQVcsS0FNcEJqQixFQUFZNkIsT0FBUyxTQUFTakIsR0FDNUJWLEtBQUtJLGdCQUFnQixDQUFFQyxNSjVDakIsU0k2Q04sU0FBdUJMLE1BQ3ZCQSxLQUFLTSx3QkFHcUNzQixJQUF0QzVCLEtBQUs2QixXQUFXbkIsRUFBTVgsUUFBUWtCLE1BR2xDUCxFQUFNWCxRQUFRK0IsaUJBQWlCLEtBQUtwQixFQUFNRCx5QkFDdENDLEVBQU1YLFFBQVFnQyxVQUNoQi9CLEtBQUtsQixJQUFJa0QsS0p2QkgsY0l1QmlDLENBQ3JDQyxTQUFVLENBQUN2QixFQUFNWCxRQUFRbUMsZ0JBRzNCbEMsS0FBS3lCLGNBQWMsQ0FBQ2YsRUFBTVgsUUFBUWtCLElBQUssQ0FBRVMsUUFBUSxJQUNqRDFCLEtBQUtlLFdBQVcsRUFBK0IsR0FBSSxDQUFFVyxRQUFRLE9BSWpFNUIsRUFBWXFDLGtCQUFvQixTQUFTekIsRUFBTzBCLEVBQVNDLEdBQ3ZELE1BQU1DLEVBQWtCRixFQUFRekQsV0FBV3NDLEtBQU9QLEVBQU1YLFFBQVFrQixHQUVoRSxHQURBbUIsRUFBUXpELFdBQVdpQixPQUFTLEVBQW9CLEVBQWdDLEdBQzNFMEMsRUFBaUIsT0FBT0QsRUFBUUQsR0FJckMsR0FBNEMsSUFBeENBLEVBQVF2QyxTQUFTUCxZQUFZaUQsT0FBYyxPQUUvQyxNQUFNQyxFQUFrQkosRUFBUXZDLFNBQVNQLFlBQVksR0FBR2lELE9BR3hELEtBQUlDLEVBQWtCLEdBQXRCLENBS0EsR0FGQUosRUFBUXpELFdBQVdMLEtKOUJWLFVJK0JUK0QsRUFBUSxFQUFhM0IsRUFBTVgsUUFBUWtCLEdBQUltQixFQUFRdkMsU0FBU1AsWUFBWSxHQUFHLEdBQUksT0FBTyxJQUM5RWtELEVBQWtCLEVBQUcsQ0FHdkIsTUFBTUMsRUFBU0wsRUFBUXZDLFNBQVNQLFlBQVksR0FBR2lELE9BQVMsRUFDeERGLEVBQVEsRUFBYTNCLEVBQU1YLFFBQVFrQixHQUFJbUIsRUFBUXZDLFNBQVNQLFlBQVksR0FBR21ELEdBQVMsS0FBS0EsS0FBVSxJQUVqRyxHQUFJRCxHQUFtQixFQUFHLENBR3hCLE1BQU1FLEVBQWtCLENBQ3RCLENBQUNOLEVBQVF2QyxTQUFTUCxZQUFZLEdBQUcsR0FBRyxHQUFJOEMsRUFBUXZDLFNBQVNQLFlBQVksR0FBRyxHQUFHLElBQUssQ0FBQzhDLEVBQVF2QyxTQUFTUCxZQUFZLEdBQUcsR0FBRyxHQUFJOEMsRUFBUXZDLFNBQVNQLFlBQVksR0FBRyxHQUFHLEtBVzdKLEdBUkErQyxFQUFRLENBQ041QyxLQUFNLEVBQ05kLFdBQVl5RCxFQUFRekQsV0FDcEJrQixTQUFVLENBQ1JQLFlBQWFvRCxFQUNiakQsS0p0Rk8sZ0JJeUZhLElBQXBCK0MsRUFDRixPQUlKLE9BQU9ILEVBQVFELEtBR2pCdEMsRUFBWTZDLFFBQVUsU0FBU2pDLEdBQzdCVixLQUFLeUIsY0FBYyxDQUFDZixFQUFNWCxRQUFRa0IsSUFBSyxDQUFFUyxRQUFRLElBQ2pEMUIsS0FBS2UsV0FBVyxJQUdsQixVRTdGTyxTQUFTNkIsRUFBVUMsR0FDdEIsR0FBSUMsTUFBTUMsUUFBUUYsR0FDZCxPQUFPQSxFQUdYLEdBQW9CLFlBQWhCQSxFQUFPcEQsTUFDUCxHQUF3QixPQUFwQm9ELEVBQU9oRCxTQUNQLE9BQU9nRCxFQUFPaEQsU0FBU1AsaUJBSzNCLEdBQUl1RCxFQUFPdkQsWUFDUCxPQUFPdUQsRUFBT3ZELFlBR3RCLE1BQU0sSUFBSTBELE1BQU0sK0RDMkJwQixTQUFTQyxFQUFVQyxHQUNmLElBQUlDLEVBQVNQLEVBQVVNLEdBRXZCLEdBQXNCLElBQWxCQyxFQUFPWixTQUFpQmEsRUFBT0QsRUFBTyxHQUFJQSxFQUFPLElBQ2pELE9BQU9BLEVBQ1gsSUFBSUUsRUFBWSxHQUNaQyxFQUFlSCxFQUFPWixPQUFTLEVBQy9CZ0IsRUFBa0JGLEVBQVVkLE9BQ2hDYyxFQUFVRyxLQUFLTCxFQUFPLElBQ3RCLElBQUssSUFBSU0sRUFBSSxFQUFHQSxFQUFJSCxFQUFjRyxJQUFLLENBQ25DLElBQUlDLEVBQWlCTCxFQUFVQSxFQUFVZCxPQUFTLEdBQzlDWSxFQUFPTSxHQUFHLEtBQU9DLEVBQWUsSUFDaENQLEVBQU9NLEdBQUcsS0FBT0MsRUFBZSxLQUdoQ0wsRUFBVUcsS0FBS0wsRUFBT00sS0FDdEJGLEVBQWtCRixFQUFVZCxRQUNOLEdBQ2RvQixFQUFxQk4sRUFBVUUsRUFBa0IsR0FBSUYsRUFBVUUsRUFBa0IsR0FBSUYsRUFBVUUsRUFBa0IsS0FDakhGLEVBQVVPLE9BQU9QLEVBQVVkLE9BQVMsRUFBRyxJQU12RCxHQUZBYyxFQUFVRyxLQUFLTCxFQUFPQSxFQUFPWixPQUFTLElBQ3RDZ0IsRUFBa0JGLEVBQVVkLE9BQ3hCYSxFQUFPRCxFQUFPLEdBQUlBLEVBQU9BLEVBQU9aLE9BQVMsS0FBT2dCLEVBQWtCLEVBQ2xFLE1BQU0sSUFBSVAsTUFBTSxtQkFHcEIsT0FGSVcsRUFBcUJOLEVBQVVFLEVBQWtCLEdBQUlGLEVBQVVFLEVBQWtCLEdBQUlGLEVBQVVFLEVBQWtCLEtBQ2pIRixFQUFVTyxPQUFPUCxFQUFVZCxPQUFTLEVBQUcsR0FDcENjLEVBVVgsU0FBU0QsRUFBT1MsRUFBS0MsR0FDakIsT0FBT0QsRUFBSSxLQUFPQyxFQUFJLElBQU1ELEVBQUksS0FBT0MsRUFBSSxHQVkvQyxTQUFTSCxFQUFxQkksRUFBT0MsRUFBS0MsR0FDdEMsSUFBSUMsRUFBSUQsRUFBTSxHQUFJRSxFQUFJRixFQUFNLEdBQ3hCRyxFQUFTTCxFQUFNLEdBQUlNLEVBQVNOLEVBQU0sR0FDbENPLEVBQU9OLEVBQUksR0FBSU8sRUFBT1AsRUFBSSxHQUcxQlEsRUFBTUYsRUFBT0YsRUFDYkssRUFBTUYsRUFBT0YsRUFFakIsT0FBYyxJQUxKSCxFQUFJRSxHQUlJSyxHQUhSTixFQUFJRSxHQUdnQkcsSUFHckJFLEtBQUtDLElBQUlILElBQVFFLEtBQUtDLElBQUlGLEdBQ3hCRCxFQUFNLEVBQUlKLEdBQVVGLEdBQUtBLEdBQUtJLEVBQU9BLEdBQVFKLEdBQUtBLEdBQUtFLEVBRXZESyxFQUFNLEVBQUlKLEdBQVVGLEdBQUtBLEdBQUtJLEVBQU9BLEdBQVFKLEdBQUtBLEdBQUtFLEdDcEh0RSxTQUFTTyxFQUFheEMsR0FDbEIsSUFBSXlDLEVBQVMsQ0FBRXBGLEtBQU0sV0FlckIsT0FiQXFGLE9BQU9DLEtBQUszQyxHQUFTNEMsU0FBUSxTQUFVQyxHQUNuQyxPQUFRQSxHQUNKLElBQUssT0FDTCxJQUFLLGFBQ0wsSUFBSyxXQUNELE9BQ0osUUFDSUosRUFBT0ksR0FBTzdDLEVBQVE2QyxPQUlsQ0osRUFBT2xHLFdBQWF1RyxFQUFnQjlDLEVBQVF6RCxZQUM1Q2tHLEVBQU9oRixTQUFXc0YsRUFBYy9DLEVBQVF2QyxVQUNqQ2dGLEVBU1gsU0FBU0ssRUFBZ0J2RyxHQUNyQixJQUFJa0csRUFBUyxHQUNiLE9BQUtsRyxHQUdMbUcsT0FBT0MsS0FBS3BHLEdBQVlxRyxTQUFRLFNBQVVDLEdBQ3RDLElBQUlHLEVBQVF6RyxFQUFXc0csR0FDRixpQkFBVkcsRUFDTyxPQUFWQSxFQUVBUCxFQUFPSSxHQUFPLEtBRVRuQyxNQUFNQyxRQUFRcUMsR0FFbkJQLEVBQU9JLEdBQU9HLEVBQU10RyxLQUFJLFNBQVV1RyxHQUM5QixPQUFPQSxLQUtYUixFQUFPSSxHQUFPQyxFQUFnQkUsR0FJbENQLEVBQU9JLEdBQU9HLEtBR2ZQLEdBeEJJQSxFQTBEZixTQUFTTSxFQUFjdEYsR0FDbkIsSUFBSXlGLEVBQU8sQ0FBRTdGLEtBQU1JLEVBQVNKLE1BSTVCLE9BSElJLEVBQVMwRixPQUNURCxFQUFLQyxLQUFPMUYsRUFBUzBGLE1BRUgsdUJBQWxCMUYsRUFBU0osTUFDVDZGLEVBQUtFLFdBQWEzRixFQUFTMkYsV0FBVzFHLEtBQUksU0FBVTJHLEdBQ2hELE9BQU9OLEVBQWNNLE1BRWxCSCxJQUVYQSxFQUFLaEcsWUFBY29HLEVBQVU3RixFQUFTUCxhQUMvQmdHLEdBU1gsU0FBU0ksRUFBVTdDLEdBQ2YsSUFBSWdDLEVBQVNoQyxFQUNiLE1BQXlCLGlCQUFkZ0MsRUFBTyxHQUNQQSxFQUFPYyxRQUVYZCxFQUFPL0YsS0FBSSxTQUFVOEcsR0FDeEIsT0FBT0YsRUFBVUUsTUNsSXpCLFNBQVNDLEVBQWFDLEVBQUdDLEVBQUlDLEdBQzNCLElBQUk5QixFQUFJNkIsRUFBRzdCLEVBQ1RDLEVBQUk0QixFQUFHNUIsRUFDUDhCLEVBQUtELEVBQUc5QixFQUFJQSxFQUNaZ0MsRUFBS0YsRUFBRzdCLEVBQUlBLEVBRWQsR0FBVyxJQUFQOEIsR0FBbUIsSUFBUEMsRUFBVSxDQUN4QixJQUFJQyxJQUFNTCxFQUFFNUIsRUFBSUEsR0FBSytCLEdBQU1ILEVBQUUzQixFQUFJQSxHQUFLK0IsSUFBT0QsRUFBS0EsRUFBS0MsRUFBS0EsR0FFeERDLEVBQUksR0FDTmpDLEVBQUk4QixFQUFHOUIsRUFDUEMsRUFBSTZCLEVBQUc3QixHQUNFZ0MsRUFBSSxJQUNiakMsR0FBSytCLEVBQUtFLEVBQ1ZoQyxHQUFLK0IsRUFBS0MsR0FPZCxPQUhBRixFQUFLSCxFQUFFNUIsRUFBSUEsR0FHQytCLEdBRlpDLEVBQUtKLEVBQUUzQixFQUFJQSxHQUVXK0IsRUF3QnhCLFNBQVNFLEVBQWVqRCxFQUFRa0QsRUFBT0MsRUFBTUMsRUFBYUMsR0FJeEQsSUFIQSxJQUNFQyxFQURFQyxFQUFZSCxFQUdQOUMsRUFBSTRDLEVBQVEsRUFBRzVDLEVBQUk2QyxFQUFNN0MsSUFBSyxDQUNyQyxJQUFJa0QsRUFBU2QsRUFBYTFDLEVBQU9NLEdBQUlOLEVBQU9rRCxHQUFRbEQsRUFBT21ELElBRXZESyxFQUFTRCxJQUNYRCxFQUFRaEQsRUFDUmlELEVBQVlDLEdBSVpELEVBQVlILElBQ1ZFLEVBQVFKLEVBQVEsR0FDbEJELEVBQWVqRCxFQUFRa0QsRUFBT0ksRUFBT0YsRUFBYUMsR0FDcERBLEVBQVdoRCxLQUFLTCxFQUFPc0QsSUFDbkJILEVBQU9HLEVBQVEsR0FDakJMLEVBQWVqRCxFQUFRc0QsRUFBT0gsRUFBTUMsRUFBYUMsSUFLdkQsU0FBU0ksRUFBdUJ6RCxFQUFRb0QsR0FDdEMsSUFBSUQsRUFBT25ELEVBQU9aLE9BQVMsRUFFdkJpRSxFQUFhLENBQUNyRCxFQUFPLElBSXpCLE9BSEFpRCxFQUFlakQsRUFBUSxFQUFHbUQsRUFBTUMsRUFBYUMsR0FDN0NBLEVBQVdoRCxLQUFLTCxFQUFPbUQsSUFFaEJFLEVBSVQsU0FBU0ssRUFBUzFELEVBQVEyRCxFQUFXQyxHQUNuQyxHQUFJNUQsRUFBT1osUUFBVSxFQUFHLE9BQU9ZLEVBRS9CLElBQUlvRCxPQUE0QjNFLElBQWRrRixFQUEwQkEsRUFBWUEsRUFBWSxFQUtwRSxPQUZTRixFQURUekQsRUFBUzRELEVBQWlCNUQsRUExRDVCLFNBQTRCQSxFQUFRb0QsR0FLbEMsSUFKQSxJQUVFdEMsRUFyQ2U4QixFQUFJQyxFQUNqQkMsRUFDRkMsRUFpQ0VjLEVBQVk3RCxFQUFPLEdBQ3JCRSxFQUFZLENBQUMyRCxHQUdOdkQsRUFBSSxFQUFHd0QsRUFBTTlELEVBQU9aLE9BQVFrQixFQUFJd0QsRUFBS3hELElBdkN6QnVDLEVBMENFZ0IsT0F6Q25CZixPQUNGQyxHQURFRCxHQURhRixFQXdDZjlCLEVBQVFkLEVBQU9NLElBdkNMUyxFQUFJOEIsRUFBRzlCLEdBR1ArQixHQUZWQyxFQUFLSCxFQUFHNUIsRUFBSTZCLEVBQUc3QixHQUVLK0IsRUFzQ2NLLElBQ2hDbEQsRUFBVUcsS0FBS1MsR0FDZitDLEVBQVkvQyxHQU1oQixPQUZJK0MsSUFBYy9DLEdBQU9aLEVBQVVHLEtBQUtTLEdBRWpDWixFQTBDNEI2RCxDQUFtQi9ELEVBQVFvRCxHQUN0QkEsR0F5SDFDLFNBQVNZLEVBQWE3SCxFQUFhd0gsRUFBV00sR0FDNUMsT0FBT1AsRUFDTHZILEVBQVlSLEtBQUksU0FBVThHLEdBQ3hCLE1BQU8sQ0FBRTFCLEVBQUcwQixFQUFNLEdBQUl6QixFQUFHeUIsRUFBTSxHQUFJeUIsRUFBR3pCLEVBQU0sT0FFOUNrQixFQUNBTSxHQUNBdEksS0FBSSxTQUFVK0QsR0FDZCxPQUFPQSxFQUFPd0UsRUFBSSxDQUFDeEUsRUFBT3FCLEVBQUdyQixFQUFPc0IsRUFBR3RCLEVBQU93RSxHQUFLLENBQUN4RSxFQUFPcUIsRUFBR3JCLEVBQU9zQixNQWF6RSxTQUFTbUQsRUFBZ0JoSSxFQUFhd0gsRUFBV00sR0FDL0MsT0FBTzlILEVBQVlSLEtBQUksU0FBVXlJLEdBQy9CLElBQUlDLEVBQU1ELEVBQUt6SSxLQUFJLFNBQVU4RyxHQUMzQixNQUFPLENBQUUxQixFQUFHMEIsRUFBTSxHQUFJekIsRUFBR3lCLEVBQU0sT0FFakMsR0FBSTRCLEVBQUlqRixPQUFTLEVBQ2YsTUFBTSxJQUFJUyxNQUFNLG1CQVFsQixJQU5BLElBQUl5RSxFQUFhWixFQUFTVyxFQUFLVixFQUFXTSxHQUFhdEksS0FBSSxTQUN6RCtELEdBRUEsTUFBTyxDQUFDQSxFQUFPcUIsRUFBR3JCLEVBQU9zQixPQUduQnVELEVBQWNELElBRXBCQSxFQUFhWixFQUFTVyxFQUR0QlYsR0FBeUIsSUFBWkEsRUFDeUJNLEdBQWF0SSxLQUFJLFNBQ3JEK0QsR0FFQSxNQUFPLENBQUNBLEVBQU9xQixFQUFHckIsRUFBT3NCLE1BUzdCLE9BTEVzRCxFQUFXQSxFQUFXbEYsT0FBUyxHQUFHLEtBQU9rRixFQUFXLEdBQUcsSUFDdkRBLEVBQVdBLEVBQVdsRixPQUFTLEdBQUcsS0FBT2tGLEVBQVcsR0FBRyxJQUV2REEsRUFBV2pFLEtBQUtpRSxFQUFXLElBRXRCQSxLQVdYLFNBQVNDLEVBQWNILEdBQ3JCLFFBQUlBLEVBQUtoRixPQUFTLEdBR0EsSUFBaEJnRixFQUFLaEYsUUFDTGdGLEVBQUssR0FBRyxLQUFPQSxFQUFLLEdBQUcsSUFDdkJBLEVBQUssR0FBRyxLQUFPQSxFQUFLLEdBQUcsSUFJM0IsUUFsSkEsU0FBb0JuRixFQUFTdUYsR0FHM0IsS0N1ZHVCQyxFRHhkdkJELEVBQVVBLEdBQVcsS0N5ZERDLEVBQU1DLGNBQWdCL0MsT0R4ZGxCLE1BQU0sSUFBSTlCLE1BQU0sc0JDdWRuQyxJQUFrQjRFLEVEdGRuQmQsT0FBa0NsRixJQUF0QitGLEVBQVFiLFVBQTBCYSxFQUFRYixVQUFZLEVBQ2xFTSxFQUFjTyxFQUFRUCxjQUFlLEVBQ3JDVSxFQUFTSCxFQUFRRyxTQUFVLEVBRS9CLElBQUsxRixFQUFTLE1BQU0sSUFBSVksTUFBTSx1QkFDOUIsR0FBSThELEdBQWFBLEVBQVksRUFBRyxNQUFNLElBQUk5RCxNQUFNLHFCQVFoRCxPQUxlLElBQVg4RSxJQUFpQjFGLEVEekp2QixTQUFlQSxHQUNYLElBQUtBLEVBQ0QsTUFBTSxJQUFJWSxNQUFNLHVCQUVwQixPQUFRWixFQUFRM0MsTUFDWixJQUFLLFVBQ0QsT0FBT21GLEVBQWF4QyxHQUN4QixJQUFLLG9CQUNELE9BaUZaLFNBQWdDQSxHQUM1QixJQUFJeUMsRUFBUyxDQUFFcEYsS0FBTSxxQkFlckIsT0FiQXFGLE9BQU9DLEtBQUszQyxHQUFTNEMsU0FBUSxTQUFVQyxHQUNuQyxPQUFRQSxHQUNKLElBQUssT0FDTCxJQUFLLFdBQ0QsT0FDSixRQUNJSixFQUFPSSxHQUFPN0MsRUFBUTZDLE9BSWxDSixFQUFPNUMsU0FBV0csRUFBUUgsU0FBU25ELEtBQUksU0FBVWlKLEdBQzdDLE9BQU9uRCxFQUFhbUQsTUFFakJsRCxFQWpHUW1ELENBQXVCNUYsR0FDbEMsSUFBSyxRQUNMLElBQUssYUFDTCxJQUFLLFVBQ0wsSUFBSyxhQUNMLElBQUssa0JBQ0wsSUFBSyxlQUNMLElBQUsscUJBQ0QsT0FBTytDLEVBQWMvQyxHQUN6QixRQUNJLE1BQU0sSUFBSVksTUFBTSx5QkN1SUssQ0FBTVosSUVxVnZDLFNBQWtCQSxFQUFTNkYsR0FDekIsSUFBSXhFLEVBQ0Z5RSxFQUNBekMsRUFDQTVGLEVBQ0FzSSxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUFlLEVBQ2ZDLEVBQXVDLHNCQUFqQnRHLEVBQVEzQyxLQUM5QmtKLEVBQTZCLFlBQWpCdkcsRUFBUTNDLEtBQ3BCbUosRUFBT0YsRUFBc0J0RyxFQUFRSCxTQUFTTSxPQUFTLEVBY3pELElBQUtrQixFQUFJLEVBQUdBLEVBQUltRixFQUFNbkYsSUFBSyxDQTRCekIsSUEzQkEyRSxFQUEwQk0sRUFDdEJ0RyxFQUFRSCxTQUFTd0IsR0FBRzVELFNBQ3BCOEksRUFDQXZHLEVBQVF2QyxTQUNSdUMsRUFDSmtHLEVBQW9CSSxFQUNoQnRHLEVBQVFILFNBQVN3QixHQUFHOUUsV0FDcEJnSyxFQUNBdkcsRUFBUXpELFdBQ1IsR0FDSjRKLEVBQWNHLEVBQ1Z0RyxFQUFRSCxTQUFTd0IsR0FBRzhCLEtBQ3BCb0QsRUFDQXZHLEVBQVFtRCxVQUNSM0QsRUFDSjRHLEVBQVlFLEVBQ1J0RyxFQUFRSCxTQUFTd0IsR0FBR3hDLEdBQ3BCMEgsRUFDQXZHLEVBQVFuQixRQUNSVyxFQUlKdUcsR0FIQUUsSUFBdUJELEdBQ2MsdUJBQWpDQSxFQUF3QjNJLE1BR3hCMkksRUFBd0I1QyxXQUFXakQsT0FDbkMsRUFFQ2tELEVBQUksRUFBR0EsRUFBSTBDLEVBQU8xQyxJQU1yQixHQUFpQixRQUxqQjVGLEVBQVd3SSxFQUNQRCxFQUF3QjVDLFdBQVdDLEdBQ25DMkMsR0FnQkosT0FBUXZJLEVBQVNKLE1BQ2YsSUFBSyxRQUNMLElBQUssYUFDTCxJQUFLLGFBQ0wsSUFBSyxVQUNMLElBQUssa0JBQ0wsSUFBSyxlQUNILElBT1EsSUFOTndJLEVBQ0VwSSxFQUNBNEksRUFDQUgsRUFDQUMsRUFDQUMsR0FHRixPQUFPLEVBQ1QsTUFFRixJQUFLLHFCQUNILElBQUtOLEVBQUksRUFBR0EsRUFBSXJJLEVBQVMyRixXQUFXakQsT0FBUTJGLElBQzFDLElBT1EsSUFOTkQsRUFDRXBJLEVBQVMyRixXQUFXMEMsR0FDcEJPLEVBQ0FILEVBQ0FDLEVBQ0FDLEdBR0YsT0FBTyxFQUVYLE1BRUYsUUFDRSxNQUFNLElBQUl4RixNQUFNLDhCQS9DbEIsSUFPUSxJQU5OaUYsRUFDRSxLQUNBUSxFQUNBSCxFQUNBQyxFQUNBQyxHQUdGLE9BQU8sRUEwQ2JDLEtGcmNGSSxDQUFTekcsR0FBUyxTQUFVa0QsSUFlOUIsU0FBc0J6RixFQUFVaUgsRUFBV00sR0FDekMsSUFBSTNILEVBQU9JLEVBQVNKLEtBR3BCLEdBQWEsVUFBVEEsR0FBNkIsZUFBVEEsRUFBdUIsT0FBT0ksR0ZyS3hELFNBQXFCdUMsRUFBU3VGLFFBQ1YsSUFBWkEsSUFBc0JBLEVBQVUsSUFFcEMsSUFBSUcsRUFBNEIsaUJBQVpILEVBQXVCQSxFQUFRRyxPQUFTSCxFQUM1RCxJQUFLdkYsRUFDRCxNQUFNLElBQUlZLE1BQU0sdUJBQ3BCLElBQUl2RCxFRHdMRCxTQUFpQjJDLEVBQVMwRyxHQUM3QixNQUFxQixzQkFBakIxRyxFQUFRM0MsS0FDRCxvQkFFVSx1QkFBakIyQyxFQUFRM0MsS0FDRCxxQkFFVSxZQUFqQjJDLEVBQVEzQyxNQUEyQyxPQUFyQjJDLEVBQVF2QyxTQUMvQnVDLEVBQVF2QyxTQUFTSixLQUVyQjJDLEVBQVEzQyxLQ2xNSnNKLENBQVEzRyxHQUVmNEcsRUFBWSxHQUNoQixPQUFRdkosR0FDSixJQUFLLGFBQ0R1SixFQUFZL0YsRUFBVWIsR0FDdEIsTUFDSixJQUFLLGtCQUNMLElBQUssVUFDRFEsRUFBVVIsR0FBUzRDLFNBQVEsU0FBVTlCLEdBQ2pDOEYsRUFBVXhGLEtBQUtQLEVBQVVDLE9BRTdCLE1BQ0osSUFBSyxlQUNETixFQUFVUixHQUFTNEMsU0FBUSxTQUFVaUUsR0FDakMsSUFBSUMsRUFBYSxHQUNqQkQsRUFBU2pFLFNBQVEsU0FBVXVDLEdBQ3ZCMkIsRUFBVzFGLEtBQUtQLEVBQVVzRSxPQUU5QnlCLEVBQVV4RixLQUFLMEYsTUFFbkIsTUFDSixJQUFLLFFBQ0QsT0FBTzlHLEVBQ1gsSUFBSyxhQUNELElBQUkrRyxFQUFXLEdBQ2Z2RyxFQUFVUixHQUFTNEMsU0FBUSxTQUFVWSxHQUNqQyxJQUFJWCxFQUFNVyxFQUFNd0QsS0FBSyxLQUNoQkQsRUFBU0UsZUFBZXBFLEtBQ3pCK0QsRUFBVXhGLEtBQUtvQyxHQUNmdUQsRUFBU2xFLElBQU8sTUFHeEIsTUFDSixRQUNJLE1BQU0sSUFBSWpDLE1BQU12RCxFQUFPLDJCQUczQjJDLEVBQVE5QyxhQUNPLElBQVh3SSxJQUNBMUYsRUFBUTlDLFlBQWMwSixJQU1YLElBQVhsQixFQUNBMUYsRUFBUXZDLFNBQVNQLFlBQWMwSixFR3dCcEMsU0FBaUIxRCxFQUFNM0csRUFBWWdKLFFBQ3RCLElBQVpBLElBQXNCQSxFQUFVLElBQ3BDLElBQUkyQixFQUFPLENBQUU3SixLQUFNLFlBQ0EsSUFBZmtJLEVBQVExRyxJQUFZMEcsRUFBUTFHLE1BQzVCcUksRUFBS3JJLEdBQUswRyxFQUFRMUcsSUFFbEIwRyxFQUFRcEMsT0FDUitELEVBQUsvRCxLQUFPb0MsRUFBUXBDLE1BRXhCK0QsRUFBSzNLLFdBQWFBLEdBQWMsR0FDaEMySyxFQUFLekosU0FBV3lGLEVIL0JMLENBQVEsQ0FBRTdGLEtBQU1BLEVBQU1ILFlBQWEwSixHQUFhNUcsRUFBUXpELFdBQVksQ0FDdkU0RyxLQUFNbkQsRUFBUW1ELEtBQ2R0RSxHQUFJbUIsRUFBUW5CLEtFOEd0QixDQUFZcEIsR0FBVSxHQUV0QixJQUFJUCxFQUFjTyxFQUFTUCxZQUMzQixPQUFRRyxHQUNOLElBQUssYUFDSEksRUFBc0IsWUFBSXNILEVBQ3hCN0gsRUFDQXdILEVBQ0FNLEdBRUYsTUFDRixJQUFLLGtCQUNIdkgsRUFBc0IsWUFBSVAsRUFBWVIsS0FBSSxTQUFVeUssR0FDbEQsT0FBT3BDLEVBQWFvQyxFQUFPekMsRUFBV00sTUFFeEMsTUFDRixJQUFLLFVBQ0h2SCxFQUFzQixZQUFJeUgsRUFDeEJoSSxFQUNBd0gsRUFDQU0sR0FFRixNQUNGLElBQUssZUFDSHZILEVBQXNCLFlBQUlQLEVBQVlSLEtBQUksU0FBVTBLLEdBQ2xELE9BQU9sQyxFQUFnQmtDLEVBQU8xQyxFQUFXTSxPQTlDN0NxQyxDQUFhbkUsRUFBTXdCLEVBQVdNLE1BRXpCaEYsR0d0S0hzSCxFQUFlNUUsT0FBTzZFLE9BQU8sR0FBSSxHQUV2Q0QsRUFBYUUsUUFBVSxXQUNuQixNQUFNN0osRUFBVUMsS0FBS0MsV0FBVyxDQUM1QlIsS0FBTXJCLEVBQ05PLFdBQVksR0FDWmtCLFNBQVUsQ0FDTkosS0FBTXJCLEVBQ05rQixZQUFhLENBQUMsT0FtQnRCLE9BZkFVLEtBQUtFLFdBQVdILEdBQ2hCQyxLQUFLRyx3QkFHTHRCLFlBQVcsS0FDRm1CLEtBQUtsQixLQUFRa0IsS0FBS2xCLElBQUkrSyxTQUMzQjdKLEtBQUtsQixJQUFJK0ssUUFBUXpLLFlBQ2xCLEdBRUhZLEtBQUtJLGdCQUFnQixDQUFFQyxNQUFPbkMsSUFDOUI4QixLQUFLTSxpQkFBaUJuQyxHQUN0QjZCLEtBQUtPLG1CQUFtQixDQUNwQkMsT0FBTyxJQUdKLENBQ0hULFVBQ0FVLHNCQUF1QixFQUN2QnFKLFlBQVksSUFJcEJKLEVBQWFLLE9BQVNMLEVBQWFNLFlBQWMsU0FBVXRKLEVBQU9qQyxHQUM5RGlDLEVBQU1vSixZQUFhLEVBQ25COUosS0FBS0ksZ0JBQWdCLENBQUVDLE1BQU9uQyxJQUM5QndDLEVBQU1YLFFBQVFtQixpQkFBaUIsS0FBS1IsRUFBTUQsd0JBQXlCaEMsRUFBRW1DLE9BQU9DLElBQUtwQyxFQUFFbUMsT0FBT0UsS0FDMUZKLEVBQU1ELHdCQUNOQyxFQUFNWCxRQUFRbUIsaUJBQWlCLEtBQUtSLEVBQU1ELHdCQUF5QmhDLEVBQUVtQyxPQUFPQyxJQUFLcEMsRUFBRW1DLE9BQU9FLE1BRzlGNEksRUFBYU8sVUFBWSxTQUFVdkosRUFBT2pDLEdBQ2xDaUMsRUFBTW9KLGFBQ045SixLQUFLNkcsU0FBU25HLEVBQU1YLFNBQ3BCQyxLQUFLa0ssYUFDTGxLLEtBQUtlLFdBQVcxQyxFQUFxQixDQUFFMkMsV0FBWSxDQUFDTixFQUFNWCxRQUFRa0IsUUFJMUV5SSxFQUFhUyxXQUFhLFNBQVN6SixFQUFPakMsR0FDdEN1QixLQUFLaUssVUFBVXZKLEVBQU9qQyxJQUcxQmlMLEVBQWFRLFdBQWEsV0FDdEJsSyxLQUFLbEIsSUFBSWtELEtaQUgsY1lBdUIsQ0FDekJvSSxPWlNBLE9ZUkFuSSxTQUFVakMsS0FBS3FLLGNBQWN2TCxLQUFJd0wsR0FBS0EsRUFBRXBJLGlCQUloRHdILEVBQWE3QyxTQUFXLFNBQVM5RyxHQUMvQixNQUFNK0csRUFBWSxFQUFJcEMsS0FBSzZGLElBQUksS0FBTSxHQUFLdkssS0FBS2xCLElBQUkwTCxXQUNuRCxFQUFTekssRUFBUyxDQUNkK0gsUUFBUSxFQUNSaEIsVUFBV0EsRUFDWE0sYUFBYSxLQUluQixVQ3hFQXFELFNBQVNDLFlBQWMsNkZBQ3JCLElBQUk1TCxFQUFNLElBQUkyTCxTQUFTRSxJQUFJLENBQzNCQyxVQUFXQyxTQUFTQyxlQUFlLE9BQ25DQyxNQUFPLHFDQUNQQyxPQUFRLEVBQUUsVUFBWSxXQUN0QkMsS0FBTSxLQUdKQyxFQUFPLElBQUlDLFdBQVcsQ0FDeEI5TSxNQUFPeUcsT0FBTzZFLE9BQU93QixXQUFXOU0sTUFBTyxDQUNyQytNLGFBQWMsTUFJbEJ0TSxFQUFJdU0sV0FBV0gsRUFBTSxZQUNyQnBNLEVBQUl3TSxHQUFHLGVBQ1AsV0FDSUMsUUFBUUMsSUFBSUMsVUFBV1AsRUFBS1EsYyIsImZpbGUiOiJpbmRleC5jb21waWxlZC5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBjbGFzc2VzID0ge1xuICBDT05UUk9MX0JBU0U6ICdtYXBib3hnbC1jdHJsJyxcbiAgQ09OVFJPTF9QUkVGSVg6ICdtYXBib3hnbC1jdHJsLScsXG4gIENPTlRST0xfQlVUVE9OOiAnbWFwYm94LWdsLWRyYXdfY3RybC1kcmF3LWJ0bicsXG4gIENPTlRST0xfQlVUVE9OX0xJTkU6ICdtYXBib3gtZ2wtZHJhd19saW5lJyxcbiAgQ09OVFJPTF9CVVRUT05fUE9MWUdPTjogJ21hcGJveC1nbC1kcmF3X3BvbHlnb24nLFxuICBDT05UUk9MX0JVVFRPTl9QT0lOVDogJ21hcGJveC1nbC1kcmF3X3BvaW50JyxcbiAgQ09OVFJPTF9CVVRUT05fVFJBU0g6ICdtYXBib3gtZ2wtZHJhd190cmFzaCcsXG4gIENPTlRST0xfQlVUVE9OX0NPTUJJTkVfRkVBVFVSRVM6ICdtYXBib3gtZ2wtZHJhd19jb21iaW5lJyxcbiAgQ09OVFJPTF9CVVRUT05fVU5DT01CSU5FX0ZFQVRVUkVTOiAnbWFwYm94LWdsLWRyYXdfdW5jb21iaW5lJyxcbiAgQ09OVFJPTF9HUk9VUDogJ21hcGJveGdsLWN0cmwtZ3JvdXAnLFxuICBBVFRSSUJVVElPTjogJ21hcGJveGdsLWN0cmwtYXR0cmliJyxcbiAgQUNUSVZFX0JVVFRPTjogJ2FjdGl2ZScsXG4gIEJPWF9TRUxFQ1Q6ICdtYXBib3gtZ2wtZHJhd19ib3hzZWxlY3QnXG59O1xuXG5leHBvcnQgY29uc3Qgc291cmNlcyA9IHtcbiAgSE9UOiAnbWFwYm94LWdsLWRyYXctaG90JyxcbiAgQ09MRDogJ21hcGJveC1nbC1kcmF3LWNvbGQnXG59O1xuXG5leHBvcnQgY29uc3QgY3Vyc29ycyA9IHtcbiAgQUREOiAnYWRkJyxcbiAgTU9WRTogJ21vdmUnLFxuICBEUkFHOiAnZHJhZycsXG4gIFBPSU5URVI6ICdwb2ludGVyJyxcbiAgTk9ORTogJ25vbmUnXG59O1xuXG5leHBvcnQgY29uc3QgdHlwZXMgPSB7XG4gIFBPTFlHT046ICdwb2x5Z29uJyxcbiAgTElORTogJ2xpbmVfc3RyaW5nJyxcbiAgUE9JTlQ6ICdwb2ludCdcbn07XG5cbmV4cG9ydCBjb25zdCBnZW9qc29uVHlwZXMgPSB7XG4gIEZFQVRVUkU6ICdGZWF0dXJlJyxcbiAgUE9MWUdPTjogJ1BvbHlnb24nLFxuICBMSU5FX1NUUklORzogJ0xpbmVTdHJpbmcnLFxuICBQT0lOVDogJ1BvaW50JyxcbiAgRkVBVFVSRV9DT0xMRUNUSU9OOiAnRmVhdHVyZUNvbGxlY3Rpb24nLFxuICBNVUxUSV9QUkVGSVg6ICdNdWx0aScsXG4gIE1VTFRJX1BPSU5UOiAnTXVsdGlQb2ludCcsXG4gIE1VTFRJX0xJTkVfU1RSSU5HOiAnTXVsdGlMaW5lU3RyaW5nJyxcbiAgTVVMVElfUE9MWUdPTjogJ011bHRpUG9seWdvbidcbn07XG5cbmV4cG9ydCBjb25zdCBtb2RlcyA9IHtcbiAgRFJBV19MSU5FX1NUUklORzogJ2RyYXdfbGluZV9zdHJpbmcnLFxuICBEUkFXX1BPTFlHT046ICdkcmF3X3BvbHlnb24nLFxuICBEUkFXX1BPSU5UOiAnZHJhd19wb2ludCcsXG4gIFNJTVBMRV9TRUxFQ1Q6ICdzaW1wbGVfc2VsZWN0JyxcbiAgRElSRUNUX1NFTEVDVDogJ2RpcmVjdF9zZWxlY3QnLFxuICBTVEFUSUM6ICdzdGF0aWMnXG59O1xuXG5leHBvcnQgY29uc3QgZXZlbnRzID0ge1xuICBDUkVBVEU6ICdkcmF3LmNyZWF0ZScsXG4gIERFTEVURTogJ2RyYXcuZGVsZXRlJyxcbiAgVVBEQVRFOiAnZHJhdy51cGRhdGUnLFxuICBTRUxFQ1RJT05fQ0hBTkdFOiAnZHJhdy5zZWxlY3Rpb25jaGFuZ2UnLFxuICBNT0RFX0NIQU5HRTogJ2RyYXcubW9kZWNoYW5nZScsXG4gIEFDVElPTkFCTEU6ICdkcmF3LmFjdGlvbmFibGUnLFxuICBSRU5ERVI6ICdkcmF3LnJlbmRlcicsXG4gIENPTUJJTkVfRkVBVFVSRVM6ICdkcmF3LmNvbWJpbmUnLFxuICBVTkNPTUJJTkVfRkVBVFVSRVM6ICdkcmF3LnVuY29tYmluZSdcbn07XG5cbmV4cG9ydCBjb25zdCB1cGRhdGVBY3Rpb25zID0ge1xuICBNT1ZFOiAnbW92ZScsXG4gIENIQU5HRV9DT09SRElOQVRFUzogJ2NoYW5nZV9jb29yZGluYXRlcydcbn07XG5cbmV4cG9ydCBjb25zdCBtZXRhID0ge1xuICBGRUFUVVJFOiAnZmVhdHVyZScsXG4gIE1JRFBPSU5UOiAnbWlkcG9pbnQnLFxuICBWRVJURVg6ICd2ZXJ0ZXgnXG59O1xuXG5leHBvcnQgY29uc3QgYWN0aXZlU3RhdGVzID0ge1xuICBBQ1RJVkU6ICd0cnVlJyxcbiAgSU5BQ1RJVkU6ICdmYWxzZSdcbn07XG5cbmV4cG9ydCBjb25zdCBpbnRlcmFjdGlvbnMgPSBbXG4gICdzY3JvbGxab29tJyxcbiAgJ2JveFpvb20nLFxuICAnZHJhZ1JvdGF0ZScsXG4gICdkcmFnUGFuJyxcbiAgJ2tleWJvYXJkJyxcbiAgJ2RvdWJsZUNsaWNrWm9vbScsXG4gICd0b3VjaFpvb21Sb3RhdGUnXG5dO1xuXG5leHBvcnQgY29uc3QgTEFUX01JTiA9IC05MDtcbmV4cG9ydCBjb25zdCBMQVRfUkVOREVSRURfTUlOID0gLTg1O1xuZXhwb3J0IGNvbnN0IExBVF9NQVggPSA5MDtcbmV4cG9ydCBjb25zdCBMQVRfUkVOREVSRURfTUFYID0gODU7XG5leHBvcnQgY29uc3QgTE5HX01JTiA9IC0yNzA7XG5leHBvcnQgY29uc3QgTE5HX01BWCA9IDI3MDtcbiIsImltcG9ydCAqIGFzIENvbnN0YW50cyBmcm9tICcuLi9jb25zdGFudHMnO1xuXG5leHBvcnQgZnVuY3Rpb24gaXNPZk1ldGFUeXBlKHR5cGUpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKGUpIHtcbiAgICBjb25zdCBmZWF0dXJlVGFyZ2V0ID0gZS5mZWF0dXJlVGFyZ2V0O1xuICAgIGlmICghZmVhdHVyZVRhcmdldCkgcmV0dXJuIGZhbHNlO1xuICAgIGlmICghZmVhdHVyZVRhcmdldC5wcm9wZXJ0aWVzKSByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIGZlYXR1cmVUYXJnZXQucHJvcGVydGllcy5tZXRhID09PSB0eXBlO1xuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNTaGlmdE1vdXNlZG93bihlKSB7XG4gIGlmICghZS5vcmlnaW5hbEV2ZW50KSByZXR1cm4gZmFsc2U7XG4gIGlmICghZS5vcmlnaW5hbEV2ZW50LnNoaWZ0S2V5KSByZXR1cm4gZmFsc2U7XG4gIHJldHVybiBlLm9yaWdpbmFsRXZlbnQuYnV0dG9uID09PSAwO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNBY3RpdmVGZWF0dXJlKGUpIHtcbiAgaWYgKCFlLmZlYXR1cmVUYXJnZXQpIHJldHVybiBmYWxzZTtcbiAgaWYgKCFlLmZlYXR1cmVUYXJnZXQucHJvcGVydGllcykgcmV0dXJuIGZhbHNlO1xuICByZXR1cm4gZS5mZWF0dXJlVGFyZ2V0LnByb3BlcnRpZXMuYWN0aXZlID09PSBDb25zdGFudHMuYWN0aXZlU3RhdGVzLkFDVElWRSAmJlxuICAgIGUuZmVhdHVyZVRhcmdldC5wcm9wZXJ0aWVzLm1ldGEgPT09IENvbnN0YW50cy5tZXRhLkZFQVRVUkU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0luYWN0aXZlRmVhdHVyZShlKSB7XG4gIGlmICghZS5mZWF0dXJlVGFyZ2V0KSByZXR1cm4gZmFsc2U7XG4gIGlmICghZS5mZWF0dXJlVGFyZ2V0LnByb3BlcnRpZXMpIHJldHVybiBmYWxzZTtcbiAgcmV0dXJuIGUuZmVhdHVyZVRhcmdldC5wcm9wZXJ0aWVzLmFjdGl2ZSA9PT0gQ29uc3RhbnRzLmFjdGl2ZVN0YXRlcy5JTkFDVElWRSAmJlxuICAgIGUuZmVhdHVyZVRhcmdldC5wcm9wZXJ0aWVzLm1ldGEgPT09IENvbnN0YW50cy5tZXRhLkZFQVRVUkU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub1RhcmdldChlKSB7XG4gIHJldHVybiBlLmZlYXR1cmVUYXJnZXQgPT09IHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzRmVhdHVyZShlKSB7XG4gIGlmICghZS5mZWF0dXJlVGFyZ2V0KSByZXR1cm4gZmFsc2U7XG4gIGlmICghZS5mZWF0dXJlVGFyZ2V0LnByb3BlcnRpZXMpIHJldHVybiBmYWxzZTtcbiAgcmV0dXJuIGUuZmVhdHVyZVRhcmdldC5wcm9wZXJ0aWVzLm1ldGEgPT09IENvbnN0YW50cy5tZXRhLkZFQVRVUkU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1ZlcnRleChlKSB7XG4gIGNvbnN0IGZlYXR1cmVUYXJnZXQgPSBlLmZlYXR1cmVUYXJnZXQ7XG4gIGlmICghZmVhdHVyZVRhcmdldCkgcmV0dXJuIGZhbHNlO1xuICBpZiAoIWZlYXR1cmVUYXJnZXQucHJvcGVydGllcykgcmV0dXJuIGZhbHNlO1xuICByZXR1cm4gZmVhdHVyZVRhcmdldC5wcm9wZXJ0aWVzLm1ldGEgPT09IENvbnN0YW50cy5tZXRhLlZFUlRFWDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzU2hpZnREb3duKGUpIHtcbiAgaWYgKCFlLm9yaWdpbmFsRXZlbnQpIHJldHVybiBmYWxzZTtcbiAgcmV0dXJuIGUub3JpZ2luYWxFdmVudC5zaGlmdEtleSA9PT0gdHJ1ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzRXNjYXBlS2V5KGUpIHtcbiAgcmV0dXJuIGUua2V5Q29kZSA9PT0gMjc7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0VudGVyS2V5KGUpIHtcbiAgcmV0dXJuIGUua2V5Q29kZSA9PT0gMTM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1RydWUoKSB7XG4gIHJldHVybiB0cnVlO1xufVxuIiwiZXhwb3J0IGRlZmF1bHQge1xuICBlbmFibGUoY3R4KSB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAvLyBGaXJzdCBjaGVjayB3ZSd2ZSBnb3QgYSBtYXAgYW5kIHNvbWUgY29udGV4dC5cbiAgICAgIGlmICghY3R4Lm1hcCB8fCAhY3R4Lm1hcC5kb3VibGVDbGlja1pvb20gfHwgIWN0eC5fY3R4IHx8ICFjdHguX2N0eC5zdG9yZSB8fCAhY3R4Ll9jdHguc3RvcmUuZ2V0SW5pdGlhbENvbmZpZ1ZhbHVlKSByZXR1cm47XG4gICAgICAvLyBOb3cgY2hlY2sgaW5pdGlhbCBzdGF0ZSB3YXNuJ3QgZmFsc2UgKHdlIGxlYXZlIGl0IGRpc2FibGVkIGlmIHNvKVxuICAgICAgaWYgKCFjdHguX2N0eC5zdG9yZS5nZXRJbml0aWFsQ29uZmlnVmFsdWUoJ2RvdWJsZUNsaWNrWm9vbScpKSByZXR1cm47XG4gICAgICBjdHgubWFwLmRvdWJsZUNsaWNrWm9vbS5lbmFibGUoKTtcbiAgICB9LCAwKTtcbiAgfSxcbiAgZGlzYWJsZShjdHgpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmICghY3R4Lm1hcCB8fCAhY3R4Lm1hcC5kb3VibGVDbGlja1pvb20pIHJldHVybjtcbiAgICAgIC8vIEFsd2F5cyBkaXNhYmxlIGhlcmUsIGFzIGl0J3MgbmVjZXNzYXJ5IGluIHNvbWUgY2FzZXMuXG4gICAgICBjdHgubWFwLmRvdWJsZUNsaWNrWm9vbS5kaXNhYmxlKCk7XG4gICAgfSwgMCk7XG4gIH1cbn07XG4iLCJpbXBvcnQgKiBhcyBDb25zdGFudHMgZnJvbSAnLi4vY29uc3RhbnRzJztcblxuLyoqXG4gKiBSZXR1cm5zIEdlb0pTT04gZm9yIGEgUG9pbnQgcmVwcmVzZW50aW5nIHRoZVxuICogdmVydGV4IG9mIGFub3RoZXIgZmVhdHVyZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGFyZW50SWRcbiAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gY29vcmRpbmF0ZXNcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0gRG90LXNlcGFyYXRlZCBudW1iZXJzIGluZGljYXRpbmcgZXhhY3RseVxuICogICB3aGVyZSB0aGUgcG9pbnQgZXhpc3RzIHdpdGhpbiBpdHMgcGFyZW50IGZlYXR1cmUncyBjb29yZGluYXRlcy5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gc2VsZWN0ZWRcbiAqIEByZXR1cm4ge0dlb0pTT059IFBvaW50XG4gKi9cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uKHBhcmVudElkLCBjb29yZGluYXRlcywgcGF0aCwgc2VsZWN0ZWQpIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBDb25zdGFudHMuZ2VvanNvblR5cGVzLkZFQVRVUkUsXG4gICAgcHJvcGVydGllczoge1xuICAgICAgbWV0YTogQ29uc3RhbnRzLm1ldGEuVkVSVEVYLFxuICAgICAgcGFyZW50OiBwYXJlbnRJZCxcbiAgICAgIGNvb3JkX3BhdGg6IHBhdGgsXG4gICAgICBhY3RpdmU6IChzZWxlY3RlZCkgPyBDb25zdGFudHMuYWN0aXZlU3RhdGVzLkFDVElWRSA6IENvbnN0YW50cy5hY3RpdmVTdGF0ZXMuSU5BQ1RJVkVcbiAgICB9LFxuICAgIGdlb21ldHJ5OiB7XG4gICAgICB0eXBlOiBDb25zdGFudHMuZ2VvanNvblR5cGVzLlBPSU5ULFxuICAgICAgY29vcmRpbmF0ZXNcbiAgICB9XG4gIH07XG59XG4iLCJpbXBvcnQgKiBhcyBDb21tb25TZWxlY3RvcnMgZnJvbSAnLi4vbGliL2NvbW1vbl9zZWxlY3RvcnMnO1xuaW1wb3J0IGRvdWJsZUNsaWNrWm9vbSBmcm9tICcuLi9saWIvZG91YmxlX2NsaWNrX3pvb20nO1xuaW1wb3J0ICogYXMgQ29uc3RhbnRzIGZyb20gJy4uL2NvbnN0YW50cyc7XG5pbXBvcnQgaXNFdmVudEF0Q29vcmRpbmF0ZXMgZnJvbSAnLi4vbGliL2lzX2V2ZW50X2F0X2Nvb3JkaW5hdGVzJztcbmltcG9ydCBjcmVhdGVWZXJ0ZXggZnJvbSAnLi4vbGliL2NyZWF0ZV92ZXJ0ZXgnO1xuXG5jb25zdCBEcmF3UG9seWdvbiA9IHt9O1xuXG5EcmF3UG9seWdvbi5vblNldHVwID0gZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHBvbHlnb24gPSB0aGlzLm5ld0ZlYXR1cmUoe1xuICAgIHR5cGU6IENvbnN0YW50cy5nZW9qc29uVHlwZXMuRkVBVFVSRSxcbiAgICBwcm9wZXJ0aWVzOiB7fSxcbiAgICBnZW9tZXRyeToge1xuICAgICAgdHlwZTogQ29uc3RhbnRzLmdlb2pzb25UeXBlcy5QT0xZR09OLFxuICAgICAgY29vcmRpbmF0ZXM6IFtbXV1cbiAgICB9XG4gIH0pO1xuXG4gIHRoaXMuYWRkRmVhdHVyZShwb2x5Z29uKTtcblxuICB0aGlzLmNsZWFyU2VsZWN0ZWRGZWF0dXJlcygpO1xuICBkb3VibGVDbGlja1pvb20uZGlzYWJsZSh0aGlzKTtcbiAgdGhpcy51cGRhdGVVSUNsYXNzZXMoeyBtb3VzZTogQ29uc3RhbnRzLmN1cnNvcnMuQUREIH0pO1xuICB0aGlzLmFjdGl2YXRlVUlCdXR0b24oQ29uc3RhbnRzLnR5cGVzLlBPTFlHT04pO1xuICB0aGlzLnNldEFjdGlvbmFibGVTdGF0ZSh7XG4gICAgdHJhc2g6IHRydWVcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICBwb2x5Z29uLFxuICAgIGN1cnJlbnRWZXJ0ZXhQb3NpdGlvbjogMFxuICB9O1xufTtcblxuRHJhd1BvbHlnb24uY2xpY2tBbnl3aGVyZSA9IGZ1bmN0aW9uKHN0YXRlLCBlKSB7XG4gIGlmIChzdGF0ZS5jdXJyZW50VmVydGV4UG9zaXRpb24gPiAwICYmIGlzRXZlbnRBdENvb3JkaW5hdGVzKGUsIHN0YXRlLnBvbHlnb24uY29vcmRpbmF0ZXNbMF1bc3RhdGUuY3VycmVudFZlcnRleFBvc2l0aW9uIC0gMV0pKSB7XG4gICAgcmV0dXJuIHRoaXMuY2hhbmdlTW9kZShDb25zdGFudHMubW9kZXMuU0lNUExFX1NFTEVDVCwgeyBmZWF0dXJlSWRzOiBbc3RhdGUucG9seWdvbi5pZF0gfSk7XG4gIH1cbiAgdGhpcy51cGRhdGVVSUNsYXNzZXMoeyBtb3VzZTogQ29uc3RhbnRzLmN1cnNvcnMuQUREIH0pO1xuICBzdGF0ZS5wb2x5Z29uLnVwZGF0ZUNvb3JkaW5hdGUoYDAuJHtzdGF0ZS5jdXJyZW50VmVydGV4UG9zaXRpb259YCwgZS5sbmdMYXQubG5nLCBlLmxuZ0xhdC5sYXQpO1xuICBzdGF0ZS5jdXJyZW50VmVydGV4UG9zaXRpb24rKztcbiAgc3RhdGUucG9seWdvbi51cGRhdGVDb29yZGluYXRlKGAwLiR7c3RhdGUuY3VycmVudFZlcnRleFBvc2l0aW9ufWAsIGUubG5nTGF0LmxuZywgZS5sbmdMYXQubGF0KTtcbn07XG5cbkRyYXdQb2x5Z29uLmNsaWNrT25WZXJ0ZXggPSBmdW5jdGlvbihzdGF0ZSkge1xuICByZXR1cm4gdGhpcy5jaGFuZ2VNb2RlKENvbnN0YW50cy5tb2Rlcy5TSU1QTEVfU0VMRUNULCB7IGZlYXR1cmVJZHM6IFtzdGF0ZS5wb2x5Z29uLmlkXSB9KTtcbn07XG5cbkRyYXdQb2x5Z29uLm9uTW91c2VNb3ZlID0gZnVuY3Rpb24oc3RhdGUsIGUpIHtcbiAgc3RhdGUucG9seWdvbi51cGRhdGVDb29yZGluYXRlKGAwLiR7c3RhdGUuY3VycmVudFZlcnRleFBvc2l0aW9ufWAsIGUubG5nTGF0LmxuZywgZS5sbmdMYXQubGF0KTtcbiAgaWYgKENvbW1vblNlbGVjdG9ycy5pc1ZlcnRleChlKSkge1xuICAgIHRoaXMudXBkYXRlVUlDbGFzc2VzKHsgbW91c2U6IENvbnN0YW50cy5jdXJzb3JzLlBPSU5URVIgfSk7XG4gIH1cbn07XG5cbkRyYXdQb2x5Z29uLm9uVGFwID0gRHJhd1BvbHlnb24ub25DbGljayA9IGZ1bmN0aW9uKHN0YXRlLCBlKSB7XG4gIGlmIChDb21tb25TZWxlY3RvcnMuaXNWZXJ0ZXgoZSkpIHJldHVybiB0aGlzLmNsaWNrT25WZXJ0ZXgoc3RhdGUsIGUpO1xuICByZXR1cm4gdGhpcy5jbGlja0FueXdoZXJlKHN0YXRlLCBlKTtcbn07XG5cbkRyYXdQb2x5Z29uLm9uS2V5VXAgPSBmdW5jdGlvbihzdGF0ZSwgZSkge1xuICBpZiAoQ29tbW9uU2VsZWN0b3JzLmlzRXNjYXBlS2V5KGUpKSB7XG4gICAgdGhpcy5kZWxldGVGZWF0dXJlKFtzdGF0ZS5wb2x5Z29uLmlkXSwgeyBzaWxlbnQ6IHRydWUgfSk7XG4gICAgdGhpcy5jaGFuZ2VNb2RlKENvbnN0YW50cy5tb2Rlcy5TSU1QTEVfU0VMRUNUKTtcbiAgfSBlbHNlIGlmIChDb21tb25TZWxlY3RvcnMuaXNFbnRlcktleShlKSkge1xuICAgIHRoaXMuY2hhbmdlTW9kZShDb25zdGFudHMubW9kZXMuU0lNUExFX1NFTEVDVCwgeyBmZWF0dXJlSWRzOiBbc3RhdGUucG9seWdvbi5pZF0gfSk7XG4gIH1cbn07XG5cbkRyYXdQb2x5Z29uLm9uU3RvcCA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gIHRoaXMudXBkYXRlVUlDbGFzc2VzKHsgbW91c2U6IENvbnN0YW50cy5jdXJzb3JzLk5PTkUgfSk7XG4gIGRvdWJsZUNsaWNrWm9vbS5lbmFibGUodGhpcyk7XG4gIHRoaXMuYWN0aXZhdGVVSUJ1dHRvbigpO1xuXG4gIC8vIGNoZWNrIHRvIHNlZSBpZiB3ZSd2ZSBkZWxldGVkIHRoaXMgZmVhdHVyZVxuICBpZiAodGhpcy5nZXRGZWF0dXJlKHN0YXRlLnBvbHlnb24uaWQpID09PSB1bmRlZmluZWQpIHJldHVybjtcblxuICAvL3JlbW92ZSBsYXN0IGFkZGVkIGNvb3JkaW5hdGVcbiAgc3RhdGUucG9seWdvbi5yZW1vdmVDb29yZGluYXRlKGAwLiR7c3RhdGUuY3VycmVudFZlcnRleFBvc2l0aW9ufWApO1xuICBpZiAoc3RhdGUucG9seWdvbi5pc1ZhbGlkKCkpIHtcbiAgICB0aGlzLm1hcC5maXJlKENvbnN0YW50cy5ldmVudHMuQ1JFQVRFLCB7XG4gICAgICBmZWF0dXJlczogW3N0YXRlLnBvbHlnb24udG9HZW9KU09OKCldXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5kZWxldGVGZWF0dXJlKFtzdGF0ZS5wb2x5Z29uLmlkXSwgeyBzaWxlbnQ6IHRydWUgfSk7XG4gICAgdGhpcy5jaGFuZ2VNb2RlKENvbnN0YW50cy5tb2Rlcy5TSU1QTEVfU0VMRUNULCB7fSwgeyBzaWxlbnQ6IHRydWUgfSk7XG4gIH1cbn07XG5cbkRyYXdQb2x5Z29uLnRvRGlzcGxheUZlYXR1cmVzID0gZnVuY3Rpb24oc3RhdGUsIGdlb2pzb24sIGRpc3BsYXkpIHtcbiAgY29uc3QgaXNBY3RpdmVQb2x5Z29uID0gZ2VvanNvbi5wcm9wZXJ0aWVzLmlkID09PSBzdGF0ZS5wb2x5Z29uLmlkO1xuICBnZW9qc29uLnByb3BlcnRpZXMuYWN0aXZlID0gKGlzQWN0aXZlUG9seWdvbikgPyBDb25zdGFudHMuYWN0aXZlU3RhdGVzLkFDVElWRSA6IENvbnN0YW50cy5hY3RpdmVTdGF0ZXMuSU5BQ1RJVkU7XG4gIGlmICghaXNBY3RpdmVQb2x5Z29uKSByZXR1cm4gZGlzcGxheShnZW9qc29uKTtcblxuICAvLyBEb24ndCByZW5kZXIgYSBwb2x5Z29uIHVudGlsIGl0IGhhcyB0d28gcG9zaXRpb25zXG4gIC8vIChhbmQgYSAzcmQgd2hpY2ggaXMganVzdCB0aGUgZmlyc3QgcmVwZWF0ZWQpXG4gIGlmIChnZW9qc29uLmdlb21ldHJ5LmNvb3JkaW5hdGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gIGNvbnN0IGNvb3JkaW5hdGVDb3VudCA9IGdlb2pzb24uZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMF0ubGVuZ3RoO1xuICAvLyAyIGNvb3JkaW5hdGVzIGFmdGVyIHNlbGVjdGluZyBhIGRyYXcgdHlwZVxuICAvLyAzIGFmdGVyIGNyZWF0aW5nIHRoZSBmaXJzdCBwb2ludFxuICBpZiAoY29vcmRpbmF0ZUNvdW50IDwgMykge1xuICAgIHJldHVybjtcbiAgfVxuICBnZW9qc29uLnByb3BlcnRpZXMubWV0YSA9IENvbnN0YW50cy5tZXRhLkZFQVRVUkU7XG4gIGRpc3BsYXkoY3JlYXRlVmVydGV4KHN0YXRlLnBvbHlnb24uaWQsIGdlb2pzb24uZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMF1bMF0sICcwLjAnLCBmYWxzZSkpO1xuICBpZiAoY29vcmRpbmF0ZUNvdW50ID4gMykge1xuICAgIC8vIEFkZCBhIHN0YXJ0IHBvc2l0aW9uIG1hcmtlciB0byB0aGUgbWFwLCBjbGlja2luZyBvbiB0aGlzIHdpbGwgZmluaXNoIHRoZSBmZWF0dXJlXG4gICAgLy8gVGhpcyBzaG91bGQgb25seSBiZSBzaG93biB3aGVuIHdlJ3JlIGluIGEgdmFsaWQgc3BvdFxuICAgIGNvbnN0IGVuZFBvcyA9IGdlb2pzb24uZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMF0ubGVuZ3RoIC0gMztcbiAgICBkaXNwbGF5KGNyZWF0ZVZlcnRleChzdGF0ZS5wb2x5Z29uLmlkLCBnZW9qc29uLmdlb21ldHJ5LmNvb3JkaW5hdGVzWzBdW2VuZFBvc10sIGAwLiR7ZW5kUG9zfWAsIGZhbHNlKSk7XG4gIH1cbiAgaWYgKGNvb3JkaW5hdGVDb3VudCA8PSA0KSB7XG4gICAgLy8gSWYgd2UndmUgb25seSBkcmF3biB0d28gcG9zaXRpb25zIChwbHVzIHRoZSBjbG9zZXIpLFxuICAgIC8vIG1ha2UgYSBMaW5lU3RyaW5nIGluc3RlYWQgb2YgYSBQb2x5Z29uXG4gICAgY29uc3QgbGluZUNvb3JkaW5hdGVzID0gW1xuICAgICAgW2dlb2pzb24uZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMF1bMF1bMF0sIGdlb2pzb24uZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMF1bMF1bMV1dLCBbZ2VvanNvbi5nZW9tZXRyeS5jb29yZGluYXRlc1swXVsxXVswXSwgZ2VvanNvbi5nZW9tZXRyeS5jb29yZGluYXRlc1swXVsxXVsxXV1cbiAgICBdO1xuICAgIC8vIGNyZWF0ZSBhbiBpbml0aWFsIHZlcnRleCBzbyB0aGF0IHdlIGNhbiB0cmFjayB0aGUgZmlyc3QgcG9pbnQgb24gbW9iaWxlIGRldmljZXNcbiAgICBkaXNwbGF5KHtcbiAgICAgIHR5cGU6IENvbnN0YW50cy5nZW9qc29uVHlwZXMuRkVBVFVSRSxcbiAgICAgIHByb3BlcnRpZXM6IGdlb2pzb24ucHJvcGVydGllcyxcbiAgICAgIGdlb21ldHJ5OiB7XG4gICAgICAgIGNvb3JkaW5hdGVzOiBsaW5lQ29vcmRpbmF0ZXMsXG4gICAgICAgIHR5cGU6IENvbnN0YW50cy5nZW9qc29uVHlwZXMuTElORV9TVFJJTkdcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoY29vcmRpbmF0ZUNvdW50ID09PSAzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIC8vIHJlbmRlciB0aGUgUG9seWdvblxuICByZXR1cm4gZGlzcGxheShnZW9qc29uKTtcbn07XG5cbkRyYXdQb2x5Z29uLm9uVHJhc2ggPSBmdW5jdGlvbihzdGF0ZSkge1xuICB0aGlzLmRlbGV0ZUZlYXR1cmUoW3N0YXRlLnBvbHlnb24uaWRdLCB7IHNpbGVudDogdHJ1ZSB9KTtcbiAgdGhpcy5jaGFuZ2VNb2RlKENvbnN0YW50cy5tb2Rlcy5TSU1QTEVfU0VMRUNUKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IERyYXdQb2x5Z29uO1xuIiwiZnVuY3Rpb24gaXNFdmVudEF0Q29vcmRpbmF0ZXMoZXZlbnQsIGNvb3JkaW5hdGVzKSB7XG4gIGlmICghZXZlbnQubG5nTGF0KSByZXR1cm4gZmFsc2U7XG4gIHJldHVybiBldmVudC5sbmdMYXQubG5nID09PSBjb29yZGluYXRlc1swXSAmJiBldmVudC5sbmdMYXQubGF0ID09PSBjb29yZGluYXRlc1sxXTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgaXNFdmVudEF0Q29vcmRpbmF0ZXM7XG4iLCJpbXBvcnQgeyBpc051bWJlciwgfSBmcm9tIFwiQHR1cmYvaGVscGVyc1wiO1xuLyoqXG4gKiBVbndyYXAgYSBjb29yZGluYXRlIGZyb20gYSBQb2ludCBGZWF0dXJlLCBHZW9tZXRyeSBvciBhIHNpbmdsZSBjb29yZGluYXRlLlxuICpcbiAqIEBuYW1lIGdldENvb3JkXG4gKiBAcGFyYW0ge0FycmF5PG51bWJlcj58R2VvbWV0cnk8UG9pbnQ+fEZlYXR1cmU8UG9pbnQ+fSBjb29yZCBHZW9KU09OIFBvaW50IG9yIGFuIEFycmF5IG9mIG51bWJlcnNcbiAqIEByZXR1cm5zIHtBcnJheTxudW1iZXI+fSBjb29yZGluYXRlc1xuICogQGV4YW1wbGVcbiAqIHZhciBwdCA9IHR1cmYucG9pbnQoWzEwLCAxMF0pO1xuICpcbiAqIHZhciBjb29yZCA9IHR1cmYuZ2V0Q29vcmQocHQpO1xuICogLy89IFsxMCwgMTBdXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb29yZChjb29yZCkge1xuICAgIGlmICghY29vcmQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY29vcmQgaXMgcmVxdWlyZWRcIik7XG4gICAgfVxuICAgIGlmICghQXJyYXkuaXNBcnJheShjb29yZCkpIHtcbiAgICAgICAgaWYgKGNvb3JkLnR5cGUgPT09IFwiRmVhdHVyZVwiICYmXG4gICAgICAgICAgICBjb29yZC5nZW9tZXRyeSAhPT0gbnVsbCAmJlxuICAgICAgICAgICAgY29vcmQuZ2VvbWV0cnkudHlwZSA9PT0gXCJQb2ludFwiKSB7XG4gICAgICAgICAgICByZXR1cm4gY29vcmQuZ2VvbWV0cnkuY29vcmRpbmF0ZXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvb3JkLnR5cGUgPT09IFwiUG9pbnRcIikge1xuICAgICAgICAgICAgcmV0dXJuIGNvb3JkLmNvb3JkaW5hdGVzO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChBcnJheS5pc0FycmF5KGNvb3JkKSAmJlxuICAgICAgICBjb29yZC5sZW5ndGggPj0gMiAmJlxuICAgICAgICAhQXJyYXkuaXNBcnJheShjb29yZFswXSkgJiZcbiAgICAgICAgIUFycmF5LmlzQXJyYXkoY29vcmRbMV0pKSB7XG4gICAgICAgIHJldHVybiBjb29yZDtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiY29vcmQgbXVzdCBiZSBHZW9KU09OIFBvaW50IG9yIGFuIEFycmF5IG9mIG51bWJlcnNcIik7XG59XG4vKipcbiAqIFVud3JhcCBjb29yZGluYXRlcyBmcm9tIGEgRmVhdHVyZSwgR2VvbWV0cnkgT2JqZWN0IG9yIGFuIEFycmF5XG4gKlxuICogQG5hbWUgZ2V0Q29vcmRzXG4gKiBAcGFyYW0ge0FycmF5PGFueT58R2VvbWV0cnl8RmVhdHVyZX0gY29vcmRzIEZlYXR1cmUsIEdlb21ldHJ5IE9iamVjdCBvciBhbiBBcnJheVxuICogQHJldHVybnMge0FycmF5PGFueT59IGNvb3JkaW5hdGVzXG4gKiBAZXhhbXBsZVxuICogdmFyIHBvbHkgPSB0dXJmLnBvbHlnb24oW1tbMTE5LjMyLCAtOC43XSwgWzExOS41NSwgLTguNjldLCBbMTE5LjUxLCAtOC41NF0sIFsxMTkuMzIsIC04LjddXV0pO1xuICpcbiAqIHZhciBjb29yZHMgPSB0dXJmLmdldENvb3Jkcyhwb2x5KTtcbiAqIC8vPSBbW1sxMTkuMzIsIC04LjddLCBbMTE5LjU1LCAtOC42OV0sIFsxMTkuNTEsIC04LjU0XSwgWzExOS4zMiwgLTguN11dXVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29vcmRzKGNvb3Jkcykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KGNvb3JkcykpIHtcbiAgICAgICAgcmV0dXJuIGNvb3JkcztcbiAgICB9XG4gICAgLy8gRmVhdHVyZVxuICAgIGlmIChjb29yZHMudHlwZSA9PT0gXCJGZWF0dXJlXCIpIHtcbiAgICAgICAgaWYgKGNvb3Jkcy5nZW9tZXRyeSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGNvb3Jkcy5nZW9tZXRyeS5jb29yZGluYXRlcztcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gR2VvbWV0cnlcbiAgICAgICAgaWYgKGNvb3Jkcy5jb29yZGluYXRlcykge1xuICAgICAgICAgICAgcmV0dXJuIGNvb3Jkcy5jb29yZGluYXRlcztcbiAgICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJjb29yZHMgbXVzdCBiZSBHZW9KU09OIEZlYXR1cmUsIEdlb21ldHJ5IE9iamVjdCBvciBhbiBBcnJheVwiKTtcbn1cbi8qKlxuICogQ2hlY2tzIGlmIGNvb3JkaW5hdGVzIGNvbnRhaW5zIGEgbnVtYmVyXG4gKlxuICogQG5hbWUgY29udGFpbnNOdW1iZXJcbiAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gY29vcmRpbmF0ZXMgR2VvSlNPTiBDb29yZGluYXRlc1xuICogQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgQXJyYXkgY29udGFpbnMgYSBudW1iZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbnRhaW5zTnVtYmVyKGNvb3JkaW5hdGVzKSB7XG4gICAgaWYgKGNvb3JkaW5hdGVzLmxlbmd0aCA+IDEgJiZcbiAgICAgICAgaXNOdW1iZXIoY29vcmRpbmF0ZXNbMF0pICYmXG4gICAgICAgIGlzTnVtYmVyKGNvb3JkaW5hdGVzWzFdKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoY29vcmRpbmF0ZXNbMF0pICYmIGNvb3JkaW5hdGVzWzBdLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gY29udGFpbnNOdW1iZXIoY29vcmRpbmF0ZXNbMF0pO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJjb29yZGluYXRlcyBtdXN0IG9ubHkgY29udGFpbiBudW1iZXJzXCIpO1xufVxuLyoqXG4gKiBFbmZvcmNlIGV4cGVjdGF0aW9ucyBhYm91dCB0eXBlcyBvZiBHZW9KU09OIG9iamVjdHMgZm9yIFR1cmYuXG4gKlxuICogQG5hbWUgZ2VvanNvblR5cGVcbiAqIEBwYXJhbSB7R2VvSlNPTn0gdmFsdWUgYW55IEdlb0pTT04gb2JqZWN0XG4gKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBleHBlY3RlZCBHZW9KU09OIHR5cGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIG5hbWUgb2YgY2FsbGluZyBmdW5jdGlvblxuICogQHRocm93cyB7RXJyb3J9IGlmIHZhbHVlIGlzIG5vdCB0aGUgZXhwZWN0ZWQgdHlwZS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlb2pzb25UeXBlKHZhbHVlLCB0eXBlLCBuYW1lKSB7XG4gICAgaWYgKCF0eXBlIHx8ICFuYW1lKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcInR5cGUgYW5kIG5hbWUgcmVxdWlyZWRcIik7XG4gICAgfVxuICAgIGlmICghdmFsdWUgfHwgdmFsdWUudHlwZSAhPT0gdHlwZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGlucHV0IHRvIFwiICtcbiAgICAgICAgICAgIG5hbWUgK1xuICAgICAgICAgICAgXCI6IG11c3QgYmUgYSBcIiArXG4gICAgICAgICAgICB0eXBlICtcbiAgICAgICAgICAgIFwiLCBnaXZlbiBcIiArXG4gICAgICAgICAgICB2YWx1ZS50eXBlKTtcbiAgICB9XG59XG4vKipcbiAqIEVuZm9yY2UgZXhwZWN0YXRpb25zIGFib3V0IHR5cGVzIG9mIHtAbGluayBGZWF0dXJlfSBpbnB1dHMgZm9yIFR1cmYuXG4gKiBJbnRlcm5hbGx5IHRoaXMgdXNlcyB7QGxpbmsgZ2VvanNvblR5cGV9IHRvIGp1ZGdlIGdlb21ldHJ5IHR5cGVzLlxuICpcbiAqIEBuYW1lIGZlYXR1cmVPZlxuICogQHBhcmFtIHtGZWF0dXJlfSBmZWF0dXJlIGEgZmVhdHVyZSB3aXRoIGFuIGV4cGVjdGVkIGdlb21ldHJ5IHR5cGVcbiAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIGV4cGVjdGVkIEdlb0pTT04gdHlwZVxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgbmFtZSBvZiBjYWxsaW5nIGZ1bmN0aW9uXG4gKiBAdGhyb3dzIHtFcnJvcn0gZXJyb3IgaWYgdmFsdWUgaXMgbm90IHRoZSBleHBlY3RlZCB0eXBlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZmVhdHVyZU9mKGZlYXR1cmUsIHR5cGUsIG5hbWUpIHtcbiAgICBpZiAoIWZlYXR1cmUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gZmVhdHVyZSBwYXNzZWRcIik7XG4gICAgfVxuICAgIGlmICghbmFtZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCIuZmVhdHVyZU9mKCkgcmVxdWlyZXMgYSBuYW1lXCIpO1xuICAgIH1cbiAgICBpZiAoIWZlYXR1cmUgfHwgZmVhdHVyZS50eXBlICE9PSBcIkZlYXR1cmVcIiB8fCAhZmVhdHVyZS5nZW9tZXRyeSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGlucHV0IHRvIFwiICsgbmFtZSArIFwiLCBGZWF0dXJlIHdpdGggZ2VvbWV0cnkgcmVxdWlyZWRcIik7XG4gICAgfVxuICAgIGlmICghZmVhdHVyZS5nZW9tZXRyeSB8fCBmZWF0dXJlLmdlb21ldHJ5LnR5cGUgIT09IHR5cGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBpbnB1dCB0byBcIiArXG4gICAgICAgICAgICBuYW1lICtcbiAgICAgICAgICAgIFwiOiBtdXN0IGJlIGEgXCIgK1xuICAgICAgICAgICAgdHlwZSArXG4gICAgICAgICAgICBcIiwgZ2l2ZW4gXCIgK1xuICAgICAgICAgICAgZmVhdHVyZS5nZW9tZXRyeS50eXBlKTtcbiAgICB9XG59XG4vKipcbiAqIEVuZm9yY2UgZXhwZWN0YXRpb25zIGFib3V0IHR5cGVzIG9mIHtAbGluayBGZWF0dXJlQ29sbGVjdGlvbn0gaW5wdXRzIGZvciBUdXJmLlxuICogSW50ZXJuYWxseSB0aGlzIHVzZXMge0BsaW5rIGdlb2pzb25UeXBlfSB0byBqdWRnZSBnZW9tZXRyeSB0eXBlcy5cbiAqXG4gKiBAbmFtZSBjb2xsZWN0aW9uT2ZcbiAqIEBwYXJhbSB7RmVhdHVyZUNvbGxlY3Rpb259IGZlYXR1cmVDb2xsZWN0aW9uIGEgRmVhdHVyZUNvbGxlY3Rpb24gZm9yIHdoaWNoIGZlYXR1cmVzIHdpbGwgYmUganVkZ2VkXG4gKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBleHBlY3RlZCBHZW9KU09OIHR5cGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIG5hbWUgb2YgY2FsbGluZyBmdW5jdGlvblxuICogQHRocm93cyB7RXJyb3J9IGlmIHZhbHVlIGlzIG5vdCB0aGUgZXhwZWN0ZWQgdHlwZS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbGxlY3Rpb25PZihmZWF0dXJlQ29sbGVjdGlvbiwgdHlwZSwgbmFtZSkge1xuICAgIGlmICghZmVhdHVyZUNvbGxlY3Rpb24pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gZmVhdHVyZUNvbGxlY3Rpb24gcGFzc2VkXCIpO1xuICAgIH1cbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiLmNvbGxlY3Rpb25PZigpIHJlcXVpcmVzIGEgbmFtZVwiKTtcbiAgICB9XG4gICAgaWYgKCFmZWF0dXJlQ29sbGVjdGlvbiB8fCBmZWF0dXJlQ29sbGVjdGlvbi50eXBlICE9PSBcIkZlYXR1cmVDb2xsZWN0aW9uXCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBpbnB1dCB0byBcIiArIG5hbWUgKyBcIiwgRmVhdHVyZUNvbGxlY3Rpb24gcmVxdWlyZWRcIik7XG4gICAgfVxuICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBmZWF0dXJlQ29sbGVjdGlvbi5mZWF0dXJlczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgdmFyIGZlYXR1cmUgPSBfYVtfaV07XG4gICAgICAgIGlmICghZmVhdHVyZSB8fCBmZWF0dXJlLnR5cGUgIT09IFwiRmVhdHVyZVwiIHx8ICFmZWF0dXJlLmdlb21ldHJ5KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGlucHV0IHRvIFwiICsgbmFtZSArIFwiLCBGZWF0dXJlIHdpdGggZ2VvbWV0cnkgcmVxdWlyZWRcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFmZWF0dXJlLmdlb21ldHJ5IHx8IGZlYXR1cmUuZ2VvbWV0cnkudHlwZSAhPT0gdHlwZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBpbnB1dCB0byBcIiArXG4gICAgICAgICAgICAgICAgbmFtZSArXG4gICAgICAgICAgICAgICAgXCI6IG11c3QgYmUgYSBcIiArXG4gICAgICAgICAgICAgICAgdHlwZSArXG4gICAgICAgICAgICAgICAgXCIsIGdpdmVuIFwiICtcbiAgICAgICAgICAgICAgICBmZWF0dXJlLmdlb21ldHJ5LnR5cGUpO1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBHZXQgR2VvbWV0cnkgZnJvbSBGZWF0dXJlIG9yIEdlb21ldHJ5IE9iamVjdFxuICpcbiAqIEBwYXJhbSB7RmVhdHVyZXxHZW9tZXRyeX0gZ2VvanNvbiBHZW9KU09OIEZlYXR1cmUgb3IgR2VvbWV0cnkgT2JqZWN0XG4gKiBAcmV0dXJucyB7R2VvbWV0cnl8bnVsbH0gR2VvSlNPTiBHZW9tZXRyeSBPYmplY3RcbiAqIEB0aHJvd3Mge0Vycm9yfSBpZiBnZW9qc29uIGlzIG5vdCBhIEZlYXR1cmUgb3IgR2VvbWV0cnkgT2JqZWN0XG4gKiBAZXhhbXBsZVxuICogdmFyIHBvaW50ID0ge1xuICogICBcInR5cGVcIjogXCJGZWF0dXJlXCIsXG4gKiAgIFwicHJvcGVydGllc1wiOiB7fSxcbiAqICAgXCJnZW9tZXRyeVwiOiB7XG4gKiAgICAgXCJ0eXBlXCI6IFwiUG9pbnRcIixcbiAqICAgICBcImNvb3JkaW5hdGVzXCI6IFsxMTAsIDQwXVxuICogICB9XG4gKiB9XG4gKiB2YXIgZ2VvbSA9IHR1cmYuZ2V0R2VvbShwb2ludClcbiAqIC8vPXtcInR5cGVcIjogXCJQb2ludFwiLCBcImNvb3JkaW5hdGVzXCI6IFsxMTAsIDQwXX1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEdlb20oZ2VvanNvbikge1xuICAgIGlmIChnZW9qc29uLnR5cGUgPT09IFwiRmVhdHVyZVwiKSB7XG4gICAgICAgIHJldHVybiBnZW9qc29uLmdlb21ldHJ5O1xuICAgIH1cbiAgICByZXR1cm4gZ2VvanNvbjtcbn1cbi8qKlxuICogR2V0IEdlb0pTT04gb2JqZWN0J3MgdHlwZSwgR2VvbWV0cnkgdHlwZSBpcyBwcmlvcml0aXplLlxuICpcbiAqIEBwYXJhbSB7R2VvSlNPTn0gZ2VvanNvbiBHZW9KU09OIG9iamVjdFxuICogQHBhcmFtIHtzdHJpbmd9IFtuYW1lPVwiZ2VvanNvblwiXSBuYW1lIG9mIHRoZSB2YXJpYWJsZSB0byBkaXNwbGF5IGluIGVycm9yIG1lc3NhZ2UgKHVudXNlZClcbiAqIEByZXR1cm5zIHtzdHJpbmd9IEdlb0pTT04gdHlwZVxuICogQGV4YW1wbGVcbiAqIHZhciBwb2ludCA9IHtcbiAqICAgXCJ0eXBlXCI6IFwiRmVhdHVyZVwiLFxuICogICBcInByb3BlcnRpZXNcIjoge30sXG4gKiAgIFwiZ2VvbWV0cnlcIjoge1xuICogICAgIFwidHlwZVwiOiBcIlBvaW50XCIsXG4gKiAgICAgXCJjb29yZGluYXRlc1wiOiBbMTEwLCA0MF1cbiAqICAgfVxuICogfVxuICogdmFyIGdlb20gPSB0dXJmLmdldFR5cGUocG9pbnQpXG4gKiAvLz1cIlBvaW50XCJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFR5cGUoZ2VvanNvbiwgX25hbWUpIHtcbiAgICBpZiAoZ2VvanNvbi50eXBlID09PSBcIkZlYXR1cmVDb2xsZWN0aW9uXCIpIHtcbiAgICAgICAgcmV0dXJuIFwiRmVhdHVyZUNvbGxlY3Rpb25cIjtcbiAgICB9XG4gICAgaWYgKGdlb2pzb24udHlwZSA9PT0gXCJHZW9tZXRyeUNvbGxlY3Rpb25cIikge1xuICAgICAgICByZXR1cm4gXCJHZW9tZXRyeUNvbGxlY3Rpb25cIjtcbiAgICB9XG4gICAgaWYgKGdlb2pzb24udHlwZSA9PT0gXCJGZWF0dXJlXCIgJiYgZ2VvanNvbi5nZW9tZXRyeSAhPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gZ2VvanNvbi5nZW9tZXRyeS50eXBlO1xuICAgIH1cbiAgICByZXR1cm4gZ2VvanNvbi50eXBlO1xufVxuIiwiaW1wb3J0IHsgZmVhdHVyZSB9IGZyb20gXCJAdHVyZi9oZWxwZXJzXCI7XG5pbXBvcnQgeyBnZXRDb29yZHMsIGdldFR5cGUgfSBmcm9tIFwiQHR1cmYvaW52YXJpYW50XCI7XG4vLyBUby1EbyA9PiBJbXByb3ZlIFR5cGVzY3JpcHQgR2VvSlNPTiBoYW5kbGluZ1xuLyoqXG4gKiBSZW1vdmVzIHJlZHVuZGFudCBjb29yZGluYXRlcyBmcm9tIGFueSBHZW9KU09OIEdlb21ldHJ5LlxuICpcbiAqIEBuYW1lIGNsZWFuQ29vcmRzXG4gKiBAcGFyYW0ge0dlb21ldHJ5fEZlYXR1cmV9IGdlb2pzb24gRmVhdHVyZSBvciBHZW9tZXRyeVxuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zPXt9XSBPcHRpb25hbCBwYXJhbWV0ZXJzXG4gKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLm11dGF0ZT1mYWxzZV0gYWxsb3dzIEdlb0pTT04gaW5wdXQgdG8gYmUgbXV0YXRlZFxuICogQHJldHVybnMge0dlb21ldHJ5fEZlYXR1cmV9IHRoZSBjbGVhbmVkIGlucHV0IEZlYXR1cmUvR2VvbWV0cnlcbiAqIEBleGFtcGxlXG4gKiB2YXIgbGluZSA9IHR1cmYubGluZVN0cmluZyhbWzAsIDBdLCBbMCwgMl0sIFswLCA1XSwgWzAsIDhdLCBbMCwgOF0sIFswLCAxMF1dKTtcbiAqIHZhciBtdWx0aVBvaW50ID0gdHVyZi5tdWx0aVBvaW50KFtbMCwgMF0sIFswLCAwXSwgWzIsIDJdXSk7XG4gKlxuICogdHVyZi5jbGVhbkNvb3JkcyhsaW5lKS5nZW9tZXRyeS5jb29yZGluYXRlcztcbiAqIC8vPSBbWzAsIDBdLCBbMCwgMTBdXVxuICpcbiAqIHR1cmYuY2xlYW5Db29yZHMobXVsdGlQb2ludCkuZ2VvbWV0cnkuY29vcmRpbmF0ZXM7XG4gKiAvLz0gW1swLCAwXSwgWzIsIDJdXVxuICovXG5mdW5jdGlvbiBjbGVhbkNvb3JkcyhnZW9qc29uLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH1cbiAgICAvLyBCYWNrd2FyZHMgY29tcGF0aWJsZSB3aXRoIHY0LjBcbiAgICB2YXIgbXV0YXRlID0gdHlwZW9mIG9wdGlvbnMgPT09IFwib2JqZWN0XCIgPyBvcHRpb25zLm11dGF0ZSA6IG9wdGlvbnM7XG4gICAgaWYgKCFnZW9qc29uKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJnZW9qc29uIGlzIHJlcXVpcmVkXCIpO1xuICAgIHZhciB0eXBlID0gZ2V0VHlwZShnZW9qc29uKTtcbiAgICAvLyBTdG9yZSBuZXcgXCJjbGVhblwiIHBvaW50cyBpbiB0aGlzIEFycmF5XG4gICAgdmFyIG5ld0Nvb3JkcyA9IFtdO1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlIFwiTGluZVN0cmluZ1wiOlxuICAgICAgICAgICAgbmV3Q29vcmRzID0gY2xlYW5MaW5lKGdlb2pzb24pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJNdWx0aUxpbmVTdHJpbmdcIjpcbiAgICAgICAgY2FzZSBcIlBvbHlnb25cIjpcbiAgICAgICAgICAgIGdldENvb3JkcyhnZW9qc29uKS5mb3JFYWNoKGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgICAgICAgICAgICAgbmV3Q29vcmRzLnB1c2goY2xlYW5MaW5lKGxpbmUpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJNdWx0aVBvbHlnb25cIjpcbiAgICAgICAgICAgIGdldENvb3JkcyhnZW9qc29uKS5mb3JFYWNoKGZ1bmN0aW9uIChwb2x5Z29ucykge1xuICAgICAgICAgICAgICAgIHZhciBwb2x5UG9pbnRzID0gW107XG4gICAgICAgICAgICAgICAgcG9seWdvbnMuZm9yRWFjaChmdW5jdGlvbiAocmluZykge1xuICAgICAgICAgICAgICAgICAgICBwb2x5UG9pbnRzLnB1c2goY2xlYW5MaW5lKHJpbmcpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBuZXdDb29yZHMucHVzaChwb2x5UG9pbnRzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJQb2ludFwiOlxuICAgICAgICAgICAgcmV0dXJuIGdlb2pzb247XG4gICAgICAgIGNhc2UgXCJNdWx0aVBvaW50XCI6XG4gICAgICAgICAgICB2YXIgZXhpc3RpbmcgPSB7fTtcbiAgICAgICAgICAgIGdldENvb3JkcyhnZW9qc29uKS5mb3JFYWNoKGZ1bmN0aW9uIChjb29yZCkge1xuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBjb29yZC5qb2luKFwiLVwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIWV4aXN0aW5nLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3Q29vcmRzLnB1c2goY29vcmQpO1xuICAgICAgICAgICAgICAgICAgICBleGlzdGluZ1trZXldID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHR5cGUgKyBcIiBnZW9tZXRyeSBub3Qgc3VwcG9ydGVkXCIpO1xuICAgIH1cbiAgICAvLyBTdXBwb3J0IGlucHV0IG11dGF0aW9uXG4gICAgaWYgKGdlb2pzb24uY29vcmRpbmF0ZXMpIHtcbiAgICAgICAgaWYgKG11dGF0ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgZ2VvanNvbi5jb29yZGluYXRlcyA9IG5ld0Nvb3JkcztcbiAgICAgICAgICAgIHJldHVybiBnZW9qc29uO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHR5cGU6IHR5cGUsIGNvb3JkaW5hdGVzOiBuZXdDb29yZHMgfTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChtdXRhdGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgIGdlb2pzb24uZ2VvbWV0cnkuY29vcmRpbmF0ZXMgPSBuZXdDb29yZHM7XG4gICAgICAgICAgICByZXR1cm4gZ2VvanNvbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmVhdHVyZSh7IHR5cGU6IHR5cGUsIGNvb3JkaW5hdGVzOiBuZXdDb29yZHMgfSwgZ2VvanNvbi5wcm9wZXJ0aWVzLCB7XG4gICAgICAgICAgICBiYm94OiBnZW9qc29uLmJib3gsXG4gICAgICAgICAgICBpZDogZ2VvanNvbi5pZCxcbiAgICAgICAgfSk7XG4gICAgfVxufVxuLyoqXG4gKiBDbGVhbiBDb29yZHNcbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtBcnJheTxudW1iZXI+fExpbmVTdHJpbmd9IGxpbmUgTGluZVxuICogQHJldHVybnMge0FycmF5PG51bWJlcj59IENsZWFuZWQgY29vcmRpbmF0ZXNcbiAqL1xuZnVuY3Rpb24gY2xlYW5MaW5lKGxpbmUpIHtcbiAgICB2YXIgcG9pbnRzID0gZ2V0Q29vcmRzKGxpbmUpO1xuICAgIC8vIGhhbmRsZSBcImNsZWFuXCIgc2VnbWVudFxuICAgIGlmIChwb2ludHMubGVuZ3RoID09PSAyICYmICFlcXVhbHMocG9pbnRzWzBdLCBwb2ludHNbMV0pKVxuICAgICAgICByZXR1cm4gcG9pbnRzO1xuICAgIHZhciBuZXdQb2ludHMgPSBbXTtcbiAgICB2YXIgc2Vjb25kVG9MYXN0ID0gcG9pbnRzLmxlbmd0aCAtIDE7XG4gICAgdmFyIG5ld1BvaW50c0xlbmd0aCA9IG5ld1BvaW50cy5sZW5ndGg7XG4gICAgbmV3UG9pbnRzLnB1c2gocG9pbnRzWzBdKTtcbiAgICBmb3IgKHZhciBpID0gMTsgaSA8IHNlY29uZFRvTGFzdDsgaSsrKSB7XG4gICAgICAgIHZhciBwcmV2QWRkZWRQb2ludCA9IG5ld1BvaW50c1tuZXdQb2ludHMubGVuZ3RoIC0gMV07XG4gICAgICAgIGlmIChwb2ludHNbaV1bMF0gPT09IHByZXZBZGRlZFBvaW50WzBdICYmXG4gICAgICAgICAgICBwb2ludHNbaV1bMV0gPT09IHByZXZBZGRlZFBvaW50WzFdKVxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbmV3UG9pbnRzLnB1c2gocG9pbnRzW2ldKTtcbiAgICAgICAgICAgIG5ld1BvaW50c0xlbmd0aCA9IG5ld1BvaW50cy5sZW5ndGg7XG4gICAgICAgICAgICBpZiAobmV3UG9pbnRzTGVuZ3RoID4gMikge1xuICAgICAgICAgICAgICAgIGlmIChpc1BvaW50T25MaW5lU2VnbWVudChuZXdQb2ludHNbbmV3UG9pbnRzTGVuZ3RoIC0gM10sIG5ld1BvaW50c1tuZXdQb2ludHNMZW5ndGggLSAxXSwgbmV3UG9pbnRzW25ld1BvaW50c0xlbmd0aCAtIDJdKSlcbiAgICAgICAgICAgICAgICAgICAgbmV3UG9pbnRzLnNwbGljZShuZXdQb2ludHMubGVuZ3RoIC0gMiwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgbmV3UG9pbnRzLnB1c2gocG9pbnRzW3BvaW50cy5sZW5ndGggLSAxXSk7XG4gICAgbmV3UG9pbnRzTGVuZ3RoID0gbmV3UG9pbnRzLmxlbmd0aDtcbiAgICBpZiAoZXF1YWxzKHBvaW50c1swXSwgcG9pbnRzW3BvaW50cy5sZW5ndGggLSAxXSkgJiYgbmV3UG9pbnRzTGVuZ3RoIDwgNClcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaW52YWxpZCBwb2x5Z29uXCIpO1xuICAgIGlmIChpc1BvaW50T25MaW5lU2VnbWVudChuZXdQb2ludHNbbmV3UG9pbnRzTGVuZ3RoIC0gM10sIG5ld1BvaW50c1tuZXdQb2ludHNMZW5ndGggLSAxXSwgbmV3UG9pbnRzW25ld1BvaW50c0xlbmd0aCAtIDJdKSlcbiAgICAgICAgbmV3UG9pbnRzLnNwbGljZShuZXdQb2ludHMubGVuZ3RoIC0gMiwgMSk7XG4gICAgcmV0dXJuIG5ld1BvaW50cztcbn1cbi8qKlxuICogQ29tcGFyZXMgdHdvIHBvaW50cyBhbmQgcmV0dXJucyBpZiB0aGV5IGFyZSBlcXVhbHNcbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtQb3NpdGlvbn0gcHQxIHBvaW50XG4gKiBAcGFyYW0ge1Bvc2l0aW9ufSBwdDIgcG9pbnRcbiAqIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoZXkgYXJlIGVxdWFsc1xuICovXG5mdW5jdGlvbiBlcXVhbHMocHQxLCBwdDIpIHtcbiAgICByZXR1cm4gcHQxWzBdID09PSBwdDJbMF0gJiYgcHQxWzFdID09PSBwdDJbMV07XG59XG4vKipcbiAqIFJldHVybnMgaWYgYHBvaW50YCBpcyBvbiB0aGUgc2VnbWVudCBiZXR3ZWVuIGBzdGFydGAgYW5kIGBlbmRgLlxuICogQm9ycm93ZWQgZnJvbSBgQHR1cmYvYm9vbGVhbi1wb2ludC1vbi1saW5lYCB0byBzcGVlZCB1cCB0aGUgZXZhbHVhdGlvbiAoaW5zdGVhZCBvZiB1c2luZyB0aGUgbW9kdWxlIGFzIGRlcGVuZGVuY3kpXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7UG9zaXRpb259IHN0YXJ0IGNvb3JkIHBhaXIgb2Ygc3RhcnQgb2YgbGluZVxuICogQHBhcmFtIHtQb3NpdGlvbn0gZW5kIGNvb3JkIHBhaXIgb2YgZW5kIG9mIGxpbmVcbiAqIEBwYXJhbSB7UG9zaXRpb259IHBvaW50IGNvb3JkIHBhaXIgb2YgcG9pbnQgdG8gY2hlY2tcbiAqIEByZXR1cm5zIHtib29sZWFufSB0cnVlL2ZhbHNlXG4gKi9cbmZ1bmN0aW9uIGlzUG9pbnRPbkxpbmVTZWdtZW50KHN0YXJ0LCBlbmQsIHBvaW50KSB7XG4gICAgdmFyIHggPSBwb2ludFswXSwgeSA9IHBvaW50WzFdO1xuICAgIHZhciBzdGFydFggPSBzdGFydFswXSwgc3RhcnRZID0gc3RhcnRbMV07XG4gICAgdmFyIGVuZFggPSBlbmRbMF0sIGVuZFkgPSBlbmRbMV07XG4gICAgdmFyIGR4YyA9IHggLSBzdGFydFg7XG4gICAgdmFyIGR5YyA9IHkgLSBzdGFydFk7XG4gICAgdmFyIGR4bCA9IGVuZFggLSBzdGFydFg7XG4gICAgdmFyIGR5bCA9IGVuZFkgLSBzdGFydFk7XG4gICAgdmFyIGNyb3NzID0gZHhjICogZHlsIC0gZHljICogZHhsO1xuICAgIGlmIChjcm9zcyAhPT0gMClcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGVsc2UgaWYgKE1hdGguYWJzKGR4bCkgPj0gTWF0aC5hYnMoZHlsKSlcbiAgICAgICAgcmV0dXJuIGR4bCA+IDAgPyBzdGFydFggPD0geCAmJiB4IDw9IGVuZFggOiBlbmRYIDw9IHggJiYgeCA8PSBzdGFydFg7XG4gICAgZWxzZVxuICAgICAgICByZXR1cm4gZHlsID4gMCA/IHN0YXJ0WSA8PSB5ICYmIHkgPD0gZW5kWSA6IGVuZFkgPD0geSAmJiB5IDw9IHN0YXJ0WTtcbn1cbmV4cG9ydCBkZWZhdWx0IGNsZWFuQ29vcmRzO1xuIiwiLyoqXG4gKiBSZXR1cm5zIGEgY2xvbmVkIGNvcHkgb2YgdGhlIHBhc3NlZCBHZW9KU09OIE9iamVjdCwgaW5jbHVkaW5nIHBvc3NpYmxlICdGb3JlaWduIE1lbWJlcnMnLlxuICogfjMtNXggZmFzdGVyIHRoYW4gdGhlIGNvbW1vbiBKU09OLnBhcnNlICsgSlNPTi5zdHJpbmdpZnkgY29tYm8gbWV0aG9kLlxuICpcbiAqIEBuYW1lIGNsb25lXG4gKiBAcGFyYW0ge0dlb0pTT059IGdlb2pzb24gR2VvSlNPTiBPYmplY3RcbiAqIEByZXR1cm5zIHtHZW9KU09OfSBjbG9uZWQgR2VvSlNPTiBPYmplY3RcbiAqIEBleGFtcGxlXG4gKiB2YXIgbGluZSA9IHR1cmYubGluZVN0cmluZyhbWy03NCwgNDBdLCBbLTc4LCA0Ml0sIFstODIsIDM1XV0sIHtjb2xvcjogJ3JlZCd9KTtcbiAqXG4gKiB2YXIgbGluZUNsb25lZCA9IHR1cmYuY2xvbmUobGluZSk7XG4gKi9cbmZ1bmN0aW9uIGNsb25lKGdlb2pzb24pIHtcbiAgICBpZiAoIWdlb2pzb24pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZ2VvanNvbiBpcyByZXF1aXJlZFwiKTtcbiAgICB9XG4gICAgc3dpdGNoIChnZW9qc29uLnR5cGUpIHtcbiAgICAgICAgY2FzZSBcIkZlYXR1cmVcIjpcbiAgICAgICAgICAgIHJldHVybiBjbG9uZUZlYXR1cmUoZ2VvanNvbik7XG4gICAgICAgIGNhc2UgXCJGZWF0dXJlQ29sbGVjdGlvblwiOlxuICAgICAgICAgICAgcmV0dXJuIGNsb25lRmVhdHVyZUNvbGxlY3Rpb24oZ2VvanNvbik7XG4gICAgICAgIGNhc2UgXCJQb2ludFwiOlxuICAgICAgICBjYXNlIFwiTGluZVN0cmluZ1wiOlxuICAgICAgICBjYXNlIFwiUG9seWdvblwiOlxuICAgICAgICBjYXNlIFwiTXVsdGlQb2ludFwiOlxuICAgICAgICBjYXNlIFwiTXVsdGlMaW5lU3RyaW5nXCI6XG4gICAgICAgIGNhc2UgXCJNdWx0aVBvbHlnb25cIjpcbiAgICAgICAgY2FzZSBcIkdlb21ldHJ5Q29sbGVjdGlvblwiOlxuICAgICAgICAgICAgcmV0dXJuIGNsb25lR2VvbWV0cnkoZ2VvanNvbik7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1bmtub3duIEdlb0pTT04gdHlwZVwiKTtcbiAgICB9XG59XG4vKipcbiAqIENsb25lIEZlYXR1cmVcbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtGZWF0dXJlPGFueT59IGdlb2pzb24gR2VvSlNPTiBGZWF0dXJlXG4gKiBAcmV0dXJucyB7RmVhdHVyZTxhbnk+fSBjbG9uZWQgRmVhdHVyZVxuICovXG5mdW5jdGlvbiBjbG9uZUZlYXR1cmUoZ2VvanNvbikge1xuICAgIHZhciBjbG9uZWQgPSB7IHR5cGU6IFwiRmVhdHVyZVwiIH07XG4gICAgLy8gUHJlc2VydmUgRm9yZWlnbiBNZW1iZXJzXG4gICAgT2JqZWN0LmtleXMoZ2VvanNvbikuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgICAgICBjYXNlIFwidHlwZVwiOlxuICAgICAgICAgICAgY2FzZSBcInByb3BlcnRpZXNcIjpcbiAgICAgICAgICAgIGNhc2UgXCJnZW9tZXRyeVwiOlxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY2xvbmVkW2tleV0gPSBnZW9qc29uW2tleV07XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBBZGQgcHJvcGVydGllcyAmIGdlb21ldHJ5IGxhc3RcbiAgICBjbG9uZWQucHJvcGVydGllcyA9IGNsb25lUHJvcGVydGllcyhnZW9qc29uLnByb3BlcnRpZXMpO1xuICAgIGNsb25lZC5nZW9tZXRyeSA9IGNsb25lR2VvbWV0cnkoZ2VvanNvbi5nZW9tZXRyeSk7XG4gICAgcmV0dXJuIGNsb25lZDtcbn1cbi8qKlxuICogQ2xvbmUgUHJvcGVydGllc1xuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gcHJvcGVydGllcyBHZW9KU09OIFByb3BlcnRpZXNcbiAqIEByZXR1cm5zIHtPYmplY3R9IGNsb25lZCBQcm9wZXJ0aWVzXG4gKi9cbmZ1bmN0aW9uIGNsb25lUHJvcGVydGllcyhwcm9wZXJ0aWVzKSB7XG4gICAgdmFyIGNsb25lZCA9IHt9O1xuICAgIGlmICghcHJvcGVydGllcykge1xuICAgICAgICByZXR1cm4gY2xvbmVkO1xuICAgIH1cbiAgICBPYmplY3Qua2V5cyhwcm9wZXJ0aWVzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gcHJvcGVydGllc1trZXldO1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAvLyBoYW5kbGUgbnVsbFxuICAgICAgICAgICAgICAgIGNsb25lZFtrZXldID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlIEFycmF5XG4gICAgICAgICAgICAgICAgY2xvbmVkW2tleV0gPSB2YWx1ZS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBoYW5kbGUgZ2VuZXJpYyBPYmplY3RcbiAgICAgICAgICAgICAgICBjbG9uZWRba2V5XSA9IGNsb25lUHJvcGVydGllcyh2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjbG9uZWRba2V5XSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGNsb25lZDtcbn1cbi8qKlxuICogQ2xvbmUgRmVhdHVyZSBDb2xsZWN0aW9uXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7RmVhdHVyZUNvbGxlY3Rpb248YW55Pn0gZ2VvanNvbiBHZW9KU09OIEZlYXR1cmUgQ29sbGVjdGlvblxuICogQHJldHVybnMge0ZlYXR1cmVDb2xsZWN0aW9uPGFueT59IGNsb25lZCBGZWF0dXJlIENvbGxlY3Rpb25cbiAqL1xuZnVuY3Rpb24gY2xvbmVGZWF0dXJlQ29sbGVjdGlvbihnZW9qc29uKSB7XG4gICAgdmFyIGNsb25lZCA9IHsgdHlwZTogXCJGZWF0dXJlQ29sbGVjdGlvblwiIH07XG4gICAgLy8gUHJlc2VydmUgRm9yZWlnbiBNZW1iZXJzXG4gICAgT2JqZWN0LmtleXMoZ2VvanNvbikuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgICAgICBjYXNlIFwidHlwZVwiOlxuICAgICAgICAgICAgY2FzZSBcImZlYXR1cmVzXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjbG9uZWRba2V5XSA9IGdlb2pzb25ba2V5XTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIC8vIEFkZCBmZWF0dXJlc1xuICAgIGNsb25lZC5mZWF0dXJlcyA9IGdlb2pzb24uZmVhdHVyZXMubWFwKGZ1bmN0aW9uIChmZWF0dXJlKSB7XG4gICAgICAgIHJldHVybiBjbG9uZUZlYXR1cmUoZmVhdHVyZSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGNsb25lZDtcbn1cbi8qKlxuICogQ2xvbmUgR2VvbWV0cnlcbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtHZW9tZXRyeTxhbnk+fSBnZW9tZXRyeSBHZW9KU09OIEdlb21ldHJ5XG4gKiBAcmV0dXJucyB7R2VvbWV0cnk8YW55Pn0gY2xvbmVkIEdlb21ldHJ5XG4gKi9cbmZ1bmN0aW9uIGNsb25lR2VvbWV0cnkoZ2VvbWV0cnkpIHtcbiAgICB2YXIgZ2VvbSA9IHsgdHlwZTogZ2VvbWV0cnkudHlwZSB9O1xuICAgIGlmIChnZW9tZXRyeS5iYm94KSB7XG4gICAgICAgIGdlb20uYmJveCA9IGdlb21ldHJ5LmJib3g7XG4gICAgfVxuICAgIGlmIChnZW9tZXRyeS50eXBlID09PSBcIkdlb21ldHJ5Q29sbGVjdGlvblwiKSB7XG4gICAgICAgIGdlb20uZ2VvbWV0cmllcyA9IGdlb21ldHJ5Lmdlb21ldHJpZXMubWFwKGZ1bmN0aW9uIChnKSB7XG4gICAgICAgICAgICByZXR1cm4gY2xvbmVHZW9tZXRyeShnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBnZW9tO1xuICAgIH1cbiAgICBnZW9tLmNvb3JkaW5hdGVzID0gZGVlcFNsaWNlKGdlb21ldHJ5LmNvb3JkaW5hdGVzKTtcbiAgICByZXR1cm4gZ2VvbTtcbn1cbi8qKlxuICogRGVlcCBTbGljZSBjb29yZGluYXRlc1xuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge0Nvb3JkaW5hdGVzfSBjb29yZHMgQ29vcmRpbmF0ZXNcbiAqIEByZXR1cm5zIHtDb29yZGluYXRlc30gYWxsIGNvb3JkaW5hdGVzIHNsaWNlZFxuICovXG5mdW5jdGlvbiBkZWVwU2xpY2UoY29vcmRzKSB7XG4gICAgdmFyIGNsb25lZCA9IGNvb3JkcztcbiAgICBpZiAodHlwZW9mIGNsb25lZFswXSAhPT0gXCJvYmplY3RcIikge1xuICAgICAgICByZXR1cm4gY2xvbmVkLnNsaWNlKCk7XG4gICAgfVxuICAgIHJldHVybiBjbG9uZWQubWFwKGZ1bmN0aW9uIChjb29yZCkge1xuICAgICAgICByZXR1cm4gZGVlcFNsaWNlKGNvb3JkKTtcbiAgICB9KTtcbn1cbmV4cG9ydCBkZWZhdWx0IGNsb25lO1xuIiwiaW1wb3J0IGNsZWFuQ29vcmRzIGZyb20gJ0B0dXJmL2NsZWFuLWNvb3Jkcyc7XG5pbXBvcnQgY2xvbmUgZnJvbSAnQHR1cmYvY2xvbmUnO1xuaW1wb3J0IHsgZ2VvbUVhY2ggfSBmcm9tICdAdHVyZi9tZXRhJztcbmltcG9ydCB7IGlzT2JqZWN0IH0gZnJvbSAnQHR1cmYvaGVscGVycyc7XG5cbi8qXG4gKGMpIDIwMTMsIFZsYWRpbWlyIEFnYWZvbmtpblxuIFNpbXBsaWZ5LmpzLCBhIGhpZ2gtcGVyZm9ybWFuY2UgSlMgcG9seWxpbmUgc2ltcGxpZmljYXRpb24gbGlicmFyeVxuIG1vdXJuZXIuZ2l0aHViLmlvL3NpbXBsaWZ5LWpzXG4qL1xuXG4vLyB0byBzdWl0IHlvdXIgcG9pbnQgZm9ybWF0LCBydW4gc2VhcmNoL3JlcGxhY2UgZm9yICcueCcgYW5kICcueSc7XG4vLyBmb3IgM0QgdmVyc2lvbiwgc2VlIDNkIGJyYW5jaCAoY29uZmlndXJhYmlsaXR5IHdvdWxkIGRyYXcgc2lnbmlmaWNhbnQgcGVyZm9ybWFuY2Ugb3ZlcmhlYWQpXG5cbi8vIHNxdWFyZSBkaXN0YW5jZSBiZXR3ZWVuIDIgcG9pbnRzXG5mdW5jdGlvbiBnZXRTcURpc3QocDEsIHAyKSB7XG4gIHZhciBkeCA9IHAxLnggLSBwMi54LFxuICAgIGR5ID0gcDEueSAtIHAyLnk7XG5cbiAgcmV0dXJuIGR4ICogZHggKyBkeSAqIGR5O1xufVxuXG4vLyBzcXVhcmUgZGlzdGFuY2UgZnJvbSBhIHBvaW50IHRvIGEgc2VnbWVudFxuZnVuY3Rpb24gZ2V0U3FTZWdEaXN0KHAsIHAxLCBwMikge1xuICB2YXIgeCA9IHAxLngsXG4gICAgeSA9IHAxLnksXG4gICAgZHggPSBwMi54IC0geCxcbiAgICBkeSA9IHAyLnkgLSB5O1xuXG4gIGlmIChkeCAhPT0gMCB8fCBkeSAhPT0gMCkge1xuICAgIHZhciB0ID0gKChwLnggLSB4KSAqIGR4ICsgKHAueSAtIHkpICogZHkpIC8gKGR4ICogZHggKyBkeSAqIGR5KTtcblxuICAgIGlmICh0ID4gMSkge1xuICAgICAgeCA9IHAyLng7XG4gICAgICB5ID0gcDIueTtcbiAgICB9IGVsc2UgaWYgKHQgPiAwKSB7XG4gICAgICB4ICs9IGR4ICogdDtcbiAgICAgIHkgKz0gZHkgKiB0O1xuICAgIH1cbiAgfVxuXG4gIGR4ID0gcC54IC0geDtcbiAgZHkgPSBwLnkgLSB5O1xuXG4gIHJldHVybiBkeCAqIGR4ICsgZHkgKiBkeTtcbn1cbi8vIHJlc3Qgb2YgdGhlIGNvZGUgZG9lc24ndCBjYXJlIGFib3V0IHBvaW50IGZvcm1hdFxuXG4vLyBiYXNpYyBkaXN0YW5jZS1iYXNlZCBzaW1wbGlmaWNhdGlvblxuZnVuY3Rpb24gc2ltcGxpZnlSYWRpYWxEaXN0KHBvaW50cywgc3FUb2xlcmFuY2UpIHtcbiAgdmFyIHByZXZQb2ludCA9IHBvaW50c1swXSxcbiAgICBuZXdQb2ludHMgPSBbcHJldlBvaW50XSxcbiAgICBwb2ludDtcblxuICBmb3IgKHZhciBpID0gMSwgbGVuID0gcG9pbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgcG9pbnQgPSBwb2ludHNbaV07XG5cbiAgICBpZiAoZ2V0U3FEaXN0KHBvaW50LCBwcmV2UG9pbnQpID4gc3FUb2xlcmFuY2UpIHtcbiAgICAgIG5ld1BvaW50cy5wdXNoKHBvaW50KTtcbiAgICAgIHByZXZQb2ludCA9IHBvaW50O1xuICAgIH1cbiAgfVxuXG4gIGlmIChwcmV2UG9pbnQgIT09IHBvaW50KSBuZXdQb2ludHMucHVzaChwb2ludCk7XG5cbiAgcmV0dXJuIG5ld1BvaW50cztcbn1cblxuZnVuY3Rpb24gc2ltcGxpZnlEUFN0ZXAocG9pbnRzLCBmaXJzdCwgbGFzdCwgc3FUb2xlcmFuY2UsIHNpbXBsaWZpZWQpIHtcbiAgdmFyIG1heFNxRGlzdCA9IHNxVG9sZXJhbmNlLFxuICAgIGluZGV4O1xuXG4gIGZvciAodmFyIGkgPSBmaXJzdCArIDE7IGkgPCBsYXN0OyBpKyspIHtcbiAgICB2YXIgc3FEaXN0ID0gZ2V0U3FTZWdEaXN0KHBvaW50c1tpXSwgcG9pbnRzW2ZpcnN0XSwgcG9pbnRzW2xhc3RdKTtcblxuICAgIGlmIChzcURpc3QgPiBtYXhTcURpc3QpIHtcbiAgICAgIGluZGV4ID0gaTtcbiAgICAgIG1heFNxRGlzdCA9IHNxRGlzdDtcbiAgICB9XG4gIH1cblxuICBpZiAobWF4U3FEaXN0ID4gc3FUb2xlcmFuY2UpIHtcbiAgICBpZiAoaW5kZXggLSBmaXJzdCA+IDEpXG4gICAgICBzaW1wbGlmeURQU3RlcChwb2ludHMsIGZpcnN0LCBpbmRleCwgc3FUb2xlcmFuY2UsIHNpbXBsaWZpZWQpO1xuICAgIHNpbXBsaWZpZWQucHVzaChwb2ludHNbaW5kZXhdKTtcbiAgICBpZiAobGFzdCAtIGluZGV4ID4gMSlcbiAgICAgIHNpbXBsaWZ5RFBTdGVwKHBvaW50cywgaW5kZXgsIGxhc3QsIHNxVG9sZXJhbmNlLCBzaW1wbGlmaWVkKTtcbiAgfVxufVxuXG4vLyBzaW1wbGlmaWNhdGlvbiB1c2luZyBSYW1lci1Eb3VnbGFzLVBldWNrZXIgYWxnb3JpdGhtXG5mdW5jdGlvbiBzaW1wbGlmeURvdWdsYXNQZXVja2VyKHBvaW50cywgc3FUb2xlcmFuY2UpIHtcbiAgdmFyIGxhc3QgPSBwb2ludHMubGVuZ3RoIC0gMTtcblxuICB2YXIgc2ltcGxpZmllZCA9IFtwb2ludHNbMF1dO1xuICBzaW1wbGlmeURQU3RlcChwb2ludHMsIDAsIGxhc3QsIHNxVG9sZXJhbmNlLCBzaW1wbGlmaWVkKTtcbiAgc2ltcGxpZmllZC5wdXNoKHBvaW50c1tsYXN0XSk7XG5cbiAgcmV0dXJuIHNpbXBsaWZpZWQ7XG59XG5cbi8vIGJvdGggYWxnb3JpdGhtcyBjb21iaW5lZCBmb3IgYXdlc29tZSBwZXJmb3JtYW5jZVxuZnVuY3Rpb24gc2ltcGxpZnkocG9pbnRzLCB0b2xlcmFuY2UsIGhpZ2hlc3RRdWFsaXR5KSB7XG4gIGlmIChwb2ludHMubGVuZ3RoIDw9IDIpIHJldHVybiBwb2ludHM7XG5cbiAgdmFyIHNxVG9sZXJhbmNlID0gdG9sZXJhbmNlICE9PSB1bmRlZmluZWQgPyB0b2xlcmFuY2UgKiB0b2xlcmFuY2UgOiAxO1xuXG4gIHBvaW50cyA9IGhpZ2hlc3RRdWFsaXR5ID8gcG9pbnRzIDogc2ltcGxpZnlSYWRpYWxEaXN0KHBvaW50cywgc3FUb2xlcmFuY2UpO1xuICBwb2ludHMgPSBzaW1wbGlmeURvdWdsYXNQZXVja2VyKHBvaW50cywgc3FUb2xlcmFuY2UpO1xuXG4gIHJldHVybiBwb2ludHM7XG59XG5cbi8qKlxuICogVGFrZXMgYSB7QGxpbmsgR2VvSlNPTn0gb2JqZWN0IGFuZCByZXR1cm5zIGEgc2ltcGxpZmllZCB2ZXJzaW9uLiBJbnRlcm5hbGx5IHVzZXNcbiAqIFtzaW1wbGlmeS1qc10oaHR0cDovL21vdXJuZXIuZ2l0aHViLmlvL3NpbXBsaWZ5LWpzLykgdG8gcGVyZm9ybSBzaW1wbGlmaWNhdGlvbiB1c2luZyB0aGUgUmFtZXItRG91Z2xhcy1QZXVja2VyIGFsZ29yaXRobS5cbiAqXG4gKiBAbmFtZSBzaW1wbGlmeVxuICogQHBhcmFtIHtHZW9KU09OfSBnZW9qc29uIG9iamVjdCB0byBiZSBzaW1wbGlmaWVkXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnM9e31dIE9wdGlvbmFsIHBhcmFtZXRlcnNcbiAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy50b2xlcmFuY2U9MV0gc2ltcGxpZmljYXRpb24gdG9sZXJhbmNlXG4gKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLmhpZ2hRdWFsaXR5PWZhbHNlXSB3aGV0aGVyIG9yIG5vdCB0byBzcGVuZCBtb3JlIHRpbWUgdG8gY3JlYXRlIGEgaGlnaGVyLXF1YWxpdHkgc2ltcGxpZmljYXRpb24gd2l0aCBhIGRpZmZlcmVudCBhbGdvcml0aG1cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdGlvbnMubXV0YXRlPWZhbHNlXSBhbGxvd3MgR2VvSlNPTiBpbnB1dCB0byBiZSBtdXRhdGVkIChzaWduaWZpY2FudCBwZXJmb3JtYW5jZSBpbmNyZWFzZSBpZiB0cnVlKVxuICogQHJldHVybnMge0dlb0pTT059IGEgc2ltcGxpZmllZCBHZW9KU09OXG4gKiBAZXhhbXBsZVxuICogdmFyIGdlb2pzb24gPSB0dXJmLnBvbHlnb24oW1tcbiAqICAgWy03MC42MDM2MzcsIC0zMy4zOTk5MThdLFxuICogICBbLTcwLjYxNDYyNCwgLTMzLjM5NTMzMl0sXG4gKiAgIFstNzAuNjM5MzQzLCAtMzMuMzkyNDY2XSxcbiAqICAgWy03MC42NTk5NDIsIC0zMy4zOTQ3NTldLFxuICogICBbLTcwLjY4Mzk3NSwgLTMzLjQwNDUwNF0sXG4gKiAgIFstNzAuNjk3MDIxLCAtMzMuNDE5NDA2XSxcbiAqICAgWy03MC43MDExNDEsIC0zMy40MzQzMDZdLFxuICogICBbLTcwLjcwMDQ1NCwgLTMzLjQ0NjMzOV0sXG4gKiAgIFstNzAuNjk0Mjc0LCAtMzMuNDU4MzY5XSxcbiAqICAgWy03MC42ODI2MDEsIC0zMy40NjU4MTZdLFxuICogICBbLTcwLjY2ODg2OSwgLTMzLjQ3MjExN10sXG4gKiAgIFstNzAuNjQ2MjA5LCAtMzMuNDczODM1XSxcbiAqICAgWy03MC42MjQ5MjMsIC0zMy40NzIxMTddLFxuICogICBbLTcwLjYwOTgxNywgLTMzLjQ2ODEwN10sXG4gKiAgIFstNzAuNTk1Mzk3LCAtMzMuNDU4MzY5XSxcbiAqICAgWy03MC41ODcxNTgsIC0zMy40NDI5MDFdLFxuICogICBbLTcwLjU4NzE1OCwgLTMzLjQyNjI4M10sXG4gKiAgIFstNzAuNTkwNTkxLCAtMzMuNDE0MjQ4XSxcbiAqICAgWy03MC41OTQ3MTEsIC0zMy40MDYyMjRdLFxuICogICBbLTcwLjYwMzYzNywgLTMzLjM5OTkxOF1cbiAqIF1dKTtcbiAqIHZhciBvcHRpb25zID0ge3RvbGVyYW5jZTogMC4wMSwgaGlnaFF1YWxpdHk6IGZhbHNlfTtcbiAqIHZhciBzaW1wbGlmaWVkID0gdHVyZi5zaW1wbGlmeShnZW9qc29uLCBvcHRpb25zKTtcbiAqXG4gKiAvL2FkZFRvTWFwXG4gKiB2YXIgYWRkVG9NYXAgPSBbZ2VvanNvbiwgc2ltcGxpZmllZF1cbiAqL1xuZnVuY3Rpb24gc2ltcGxpZnkkMShnZW9qc29uLCBvcHRpb25zKSB7XG4gIC8vIE9wdGlvbmFsIHBhcmFtZXRlcnNcbiAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gIGlmICghaXNPYmplY3Qob3B0aW9ucykpIHRocm93IG5ldyBFcnJvcihcIm9wdGlvbnMgaXMgaW52YWxpZFwiKTtcbiAgdmFyIHRvbGVyYW5jZSA9IG9wdGlvbnMudG9sZXJhbmNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnRvbGVyYW5jZSA6IDE7XG4gIHZhciBoaWdoUXVhbGl0eSA9IG9wdGlvbnMuaGlnaFF1YWxpdHkgfHwgZmFsc2U7XG4gIHZhciBtdXRhdGUgPSBvcHRpb25zLm11dGF0ZSB8fCBmYWxzZTtcblxuICBpZiAoIWdlb2pzb24pIHRocm93IG5ldyBFcnJvcihcImdlb2pzb24gaXMgcmVxdWlyZWRcIik7XG4gIGlmICh0b2xlcmFuY2UgJiYgdG9sZXJhbmNlIDwgMCkgdGhyb3cgbmV3IEVycm9yKFwiaW52YWxpZCB0b2xlcmFuY2VcIik7XG5cbiAgLy8gQ2xvbmUgZ2VvanNvbiB0byBhdm9pZCBzaWRlIGVmZmVjdHNcbiAgaWYgKG11dGF0ZSAhPT0gdHJ1ZSkgZ2VvanNvbiA9IGNsb25lKGdlb2pzb24pO1xuXG4gIGdlb21FYWNoKGdlb2pzb24sIGZ1bmN0aW9uIChnZW9tKSB7XG4gICAgc2ltcGxpZnlHZW9tKGdlb20sIHRvbGVyYW5jZSwgaGlnaFF1YWxpdHkpO1xuICB9KTtcbiAgcmV0dXJuIGdlb2pzb247XG59XG5cbi8qKlxuICogU2ltcGxpZmllcyBhIGZlYXR1cmUncyBjb29yZGluYXRlc1xuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge0dlb21ldHJ5fSBnZW9tZXRyeSB0byBiZSBzaW1wbGlmaWVkXG4gKiBAcGFyYW0ge251bWJlcn0gW3RvbGVyYW5jZT0xXSBzaW1wbGlmaWNhdGlvbiB0b2xlcmFuY2VcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gW2hpZ2hRdWFsaXR5PWZhbHNlXSB3aGV0aGVyIG9yIG5vdCB0byBzcGVuZCBtb3JlIHRpbWUgdG8gY3JlYXRlIGEgaGlnaGVyLXF1YWxpdHkgc2ltcGxpZmljYXRpb24gd2l0aCBhIGRpZmZlcmVudCBhbGdvcml0aG1cbiAqIEByZXR1cm5zIHtHZW9tZXRyeX0gb3V0cHV0XG4gKi9cbmZ1bmN0aW9uIHNpbXBsaWZ5R2VvbShnZW9tZXRyeSwgdG9sZXJhbmNlLCBoaWdoUXVhbGl0eSkge1xuICB2YXIgdHlwZSA9IGdlb21ldHJ5LnR5cGU7XG5cbiAgLy8gXCJ1bnNpbXBseWZpYWJsZVwiIGdlb21ldHJ5IHR5cGVzXG4gIGlmICh0eXBlID09PSBcIlBvaW50XCIgfHwgdHlwZSA9PT0gXCJNdWx0aVBvaW50XCIpIHJldHVybiBnZW9tZXRyeTtcblxuICAvLyBSZW1vdmUgYW55IGV4dHJhIGNvb3JkaW5hdGVzXG4gIGNsZWFuQ29vcmRzKGdlb21ldHJ5LCB0cnVlKTtcblxuICB2YXIgY29vcmRpbmF0ZXMgPSBnZW9tZXRyeS5jb29yZGluYXRlcztcbiAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSBcIkxpbmVTdHJpbmdcIjpcbiAgICAgIGdlb21ldHJ5W1wiY29vcmRpbmF0ZXNcIl0gPSBzaW1wbGlmeUxpbmUoXG4gICAgICAgIGNvb3JkaW5hdGVzLFxuICAgICAgICB0b2xlcmFuY2UsXG4gICAgICAgIGhpZ2hRdWFsaXR5XG4gICAgICApO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBcIk11bHRpTGluZVN0cmluZ1wiOlxuICAgICAgZ2VvbWV0cnlbXCJjb29yZGluYXRlc1wiXSA9IGNvb3JkaW5hdGVzLm1hcChmdW5jdGlvbiAobGluZXMpIHtcbiAgICAgICAgcmV0dXJuIHNpbXBsaWZ5TGluZShsaW5lcywgdG9sZXJhbmNlLCBoaWdoUXVhbGl0eSk7XG4gICAgICB9KTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgXCJQb2x5Z29uXCI6XG4gICAgICBnZW9tZXRyeVtcImNvb3JkaW5hdGVzXCJdID0gc2ltcGxpZnlQb2x5Z29uKFxuICAgICAgICBjb29yZGluYXRlcyxcbiAgICAgICAgdG9sZXJhbmNlLFxuICAgICAgICBoaWdoUXVhbGl0eVxuICAgICAgKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgXCJNdWx0aVBvbHlnb25cIjpcbiAgICAgIGdlb21ldHJ5W1wiY29vcmRpbmF0ZXNcIl0gPSBjb29yZGluYXRlcy5tYXAoZnVuY3Rpb24gKHJpbmdzKSB7XG4gICAgICAgIHJldHVybiBzaW1wbGlmeVBvbHlnb24ocmluZ3MsIHRvbGVyYW5jZSwgaGlnaFF1YWxpdHkpO1xuICAgICAgfSk7XG4gIH1cbiAgcmV0dXJuIGdlb21ldHJ5O1xufVxuXG4vKipcbiAqIFNpbXBsaWZpZXMgdGhlIGNvb3JkaW5hdGVzIG9mIGEgTGluZVN0cmluZyB3aXRoIHNpbXBsaWZ5LWpzXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gY29vcmRpbmF0ZXMgdG8gYmUgcHJvY2Vzc2VkXG4gKiBAcGFyYW0ge251bWJlcn0gdG9sZXJhbmNlIHNpbXBsaWZpY2F0aW9uIHRvbGVyYW5jZVxuICogQHBhcmFtIHtib29sZWFufSBoaWdoUXVhbGl0eSB3aGV0aGVyIG9yIG5vdCB0byBzcGVuZCBtb3JlIHRpbWUgdG8gY3JlYXRlIGEgaGlnaGVyLXF1YWxpdHlcbiAqIEByZXR1cm5zIHtBcnJheTxBcnJheTxudW1iZXI+Pn0gc2ltcGxpZmllZCBjb29yZHNcbiAqL1xuZnVuY3Rpb24gc2ltcGxpZnlMaW5lKGNvb3JkaW5hdGVzLCB0b2xlcmFuY2UsIGhpZ2hRdWFsaXR5KSB7XG4gIHJldHVybiBzaW1wbGlmeShcbiAgICBjb29yZGluYXRlcy5tYXAoZnVuY3Rpb24gKGNvb3JkKSB7XG4gICAgICByZXR1cm4geyB4OiBjb29yZFswXSwgeTogY29vcmRbMV0sIHo6IGNvb3JkWzJdIH07XG4gICAgfSksXG4gICAgdG9sZXJhbmNlLFxuICAgIGhpZ2hRdWFsaXR5XG4gICkubWFwKGZ1bmN0aW9uIChjb29yZHMpIHtcbiAgICByZXR1cm4gY29vcmRzLnogPyBbY29vcmRzLngsIGNvb3Jkcy55LCBjb29yZHMuel0gOiBbY29vcmRzLngsIGNvb3Jkcy55XTtcbiAgfSk7XG59XG5cbi8qKlxuICogU2ltcGxpZmllcyB0aGUgY29vcmRpbmF0ZXMgb2YgYSBQb2x5Z29uIHdpdGggc2ltcGxpZnktanNcbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBjb29yZGluYXRlcyB0byBiZSBwcm9jZXNzZWRcbiAqIEBwYXJhbSB7bnVtYmVyfSB0b2xlcmFuY2Ugc2ltcGxpZmljYXRpb24gdG9sZXJhbmNlXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGhpZ2hRdWFsaXR5IHdoZXRoZXIgb3Igbm90IHRvIHNwZW5kIG1vcmUgdGltZSB0byBjcmVhdGUgYSBoaWdoZXItcXVhbGl0eVxuICogQHJldHVybnMge0FycmF5PEFycmF5PEFycmF5PG51bWJlcj4+Pn0gc2ltcGxpZmllZCBjb29yZHNcbiAqL1xuZnVuY3Rpb24gc2ltcGxpZnlQb2x5Z29uKGNvb3JkaW5hdGVzLCB0b2xlcmFuY2UsIGhpZ2hRdWFsaXR5KSB7XG4gIHJldHVybiBjb29yZGluYXRlcy5tYXAoZnVuY3Rpb24gKHJpbmcpIHtcbiAgICB2YXIgcHRzID0gcmluZy5tYXAoZnVuY3Rpb24gKGNvb3JkKSB7XG4gICAgICByZXR1cm4geyB4OiBjb29yZFswXSwgeTogY29vcmRbMV0gfTtcbiAgICB9KTtcbiAgICBpZiAocHRzLmxlbmd0aCA8IDQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcImludmFsaWQgcG9seWdvblwiKTtcbiAgICB9XG4gICAgdmFyIHNpbXBsZVJpbmcgPSBzaW1wbGlmeShwdHMsIHRvbGVyYW5jZSwgaGlnaFF1YWxpdHkpLm1hcChmdW5jdGlvbiAoXG4gICAgICBjb29yZHNcbiAgICApIHtcbiAgICAgIHJldHVybiBbY29vcmRzLngsIGNvb3Jkcy55XTtcbiAgICB9KTtcbiAgICAvL3JlbW92ZSAxIHBlcmNlbnQgb2YgdG9sZXJhbmNlIHVudGlsIGVub3VnaCBwb2ludHMgdG8gbWFrZSBhIHRyaWFuZ2xlXG4gICAgd2hpbGUgKCFjaGVja1ZhbGlkaXR5KHNpbXBsZVJpbmcpKSB7XG4gICAgICB0b2xlcmFuY2UgLT0gdG9sZXJhbmNlICogMC4wMTtcbiAgICAgIHNpbXBsZVJpbmcgPSBzaW1wbGlmeShwdHMsIHRvbGVyYW5jZSwgaGlnaFF1YWxpdHkpLm1hcChmdW5jdGlvbiAoXG4gICAgICAgIGNvb3Jkc1xuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBbY29vcmRzLngsIGNvb3Jkcy55XTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoXG4gICAgICBzaW1wbGVSaW5nW3NpbXBsZVJpbmcubGVuZ3RoIC0gMV1bMF0gIT09IHNpbXBsZVJpbmdbMF1bMF0gfHxcbiAgICAgIHNpbXBsZVJpbmdbc2ltcGxlUmluZy5sZW5ndGggLSAxXVsxXSAhPT0gc2ltcGxlUmluZ1swXVsxXVxuICAgICkge1xuICAgICAgc2ltcGxlUmluZy5wdXNoKHNpbXBsZVJpbmdbMF0pO1xuICAgIH1cbiAgICByZXR1cm4gc2ltcGxlUmluZztcbiAgfSk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHJpbmcgaGFzIGF0IGxlYXN0IDMgY29vcmRpbmF0ZXMgYW5kIGl0cyBmaXJzdCBjb29yZGluYXRlIGlzIHRoZSBzYW1lIGFzIGl0cyBsYXN0XG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gcmluZyBjb29yZGluYXRlcyB0byBiZSBjaGVja2VkXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiB2YWxpZFxuICovXG5mdW5jdGlvbiBjaGVja1ZhbGlkaXR5KHJpbmcpIHtcbiAgaWYgKHJpbmcubGVuZ3RoIDwgMykgcmV0dXJuIGZhbHNlO1xuICAvL2lmIHRoZSBsYXN0IHBvaW50IGlzIHRoZSBzYW1lIGFzIHRoZSBmaXJzdCwgaXQncyBub3QgYSB0cmlhbmdsZVxuICByZXR1cm4gIShcbiAgICByaW5nLmxlbmd0aCA9PT0gMyAmJlxuICAgIHJpbmdbMl1bMF0gPT09IHJpbmdbMF1bMF0gJiZcbiAgICByaW5nWzJdWzFdID09PSByaW5nWzBdWzFdXG4gICk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHNpbXBsaWZ5JDE7XG4iLCIvKipcbiAqIEBtb2R1bGUgaGVscGVyc1xuICovXG4vKipcbiAqIEVhcnRoIFJhZGl1cyB1c2VkIHdpdGggdGhlIEhhcnZlc2luZSBmb3JtdWxhIGFuZCBhcHByb3hpbWF0ZXMgdXNpbmcgYSBzcGhlcmljYWwgKG5vbi1lbGxpcHNvaWQpIEVhcnRoLlxuICpcbiAqIEBtZW1iZXJvZiBoZWxwZXJzXG4gKiBAdHlwZSB7bnVtYmVyfVxuICovXG5leHBvcnQgdmFyIGVhcnRoUmFkaXVzID0gNjM3MTAwOC44O1xuLyoqXG4gKiBVbml0IG9mIG1lYXN1cmVtZW50IGZhY3RvcnMgdXNpbmcgYSBzcGhlcmljYWwgKG5vbi1lbGxpcHNvaWQpIGVhcnRoIHJhZGl1cy5cbiAqXG4gKiBAbWVtYmVyb2YgaGVscGVyc1xuICogQHR5cGUge09iamVjdH1cbiAqL1xuZXhwb3J0IHZhciBmYWN0b3JzID0ge1xuICAgIGNlbnRpbWV0ZXJzOiBlYXJ0aFJhZGl1cyAqIDEwMCxcbiAgICBjZW50aW1ldHJlczogZWFydGhSYWRpdXMgKiAxMDAsXG4gICAgZGVncmVlczogZWFydGhSYWRpdXMgLyAxMTEzMjUsXG4gICAgZmVldDogZWFydGhSYWRpdXMgKiAzLjI4MDg0LFxuICAgIGluY2hlczogZWFydGhSYWRpdXMgKiAzOS4zNyxcbiAgICBraWxvbWV0ZXJzOiBlYXJ0aFJhZGl1cyAvIDEwMDAsXG4gICAga2lsb21ldHJlczogZWFydGhSYWRpdXMgLyAxMDAwLFxuICAgIG1ldGVyczogZWFydGhSYWRpdXMsXG4gICAgbWV0cmVzOiBlYXJ0aFJhZGl1cyxcbiAgICBtaWxlczogZWFydGhSYWRpdXMgLyAxNjA5LjM0NCxcbiAgICBtaWxsaW1ldGVyczogZWFydGhSYWRpdXMgKiAxMDAwLFxuICAgIG1pbGxpbWV0cmVzOiBlYXJ0aFJhZGl1cyAqIDEwMDAsXG4gICAgbmF1dGljYWxtaWxlczogZWFydGhSYWRpdXMgLyAxODUyLFxuICAgIHJhZGlhbnM6IDEsXG4gICAgeWFyZHM6IGVhcnRoUmFkaXVzIC8gMS4wOTM2LFxufTtcbi8qKlxuICogVW5pdHMgb2YgbWVhc3VyZW1lbnQgZmFjdG9ycyBiYXNlZCBvbiAxIG1ldGVyLlxuICpcbiAqIEBtZW1iZXJvZiBoZWxwZXJzXG4gKiBAdHlwZSB7T2JqZWN0fVxuICovXG5leHBvcnQgdmFyIHVuaXRzRmFjdG9ycyA9IHtcbiAgICBjZW50aW1ldGVyczogMTAwLFxuICAgIGNlbnRpbWV0cmVzOiAxMDAsXG4gICAgZGVncmVlczogMSAvIDExMTMyNSxcbiAgICBmZWV0OiAzLjI4MDg0LFxuICAgIGluY2hlczogMzkuMzcsXG4gICAga2lsb21ldGVyczogMSAvIDEwMDAsXG4gICAga2lsb21ldHJlczogMSAvIDEwMDAsXG4gICAgbWV0ZXJzOiAxLFxuICAgIG1ldHJlczogMSxcbiAgICBtaWxlczogMSAvIDE2MDkuMzQ0LFxuICAgIG1pbGxpbWV0ZXJzOiAxMDAwLFxuICAgIG1pbGxpbWV0cmVzOiAxMDAwLFxuICAgIG5hdXRpY2FsbWlsZXM6IDEgLyAxODUyLFxuICAgIHJhZGlhbnM6IDEgLyBlYXJ0aFJhZGl1cyxcbiAgICB5YXJkczogMSAvIDEuMDkzNixcbn07XG4vKipcbiAqIEFyZWEgb2YgbWVhc3VyZW1lbnQgZmFjdG9ycyBiYXNlZCBvbiAxIHNxdWFyZSBtZXRlci5cbiAqXG4gKiBAbWVtYmVyb2YgaGVscGVyc1xuICogQHR5cGUge09iamVjdH1cbiAqL1xuZXhwb3J0IHZhciBhcmVhRmFjdG9ycyA9IHtcbiAgICBhY3JlczogMC4wMDAyNDcxMDUsXG4gICAgY2VudGltZXRlcnM6IDEwMDAwLFxuICAgIGNlbnRpbWV0cmVzOiAxMDAwMCxcbiAgICBmZWV0OiAxMC43NjM5MTA0MTcsXG4gICAgaGVjdGFyZXM6IDAuMDAwMSxcbiAgICBpbmNoZXM6IDE1NTAuMDAzMTAwMDA2LFxuICAgIGtpbG9tZXRlcnM6IDAuMDAwMDAxLFxuICAgIGtpbG9tZXRyZXM6IDAuMDAwMDAxLFxuICAgIG1ldGVyczogMSxcbiAgICBtZXRyZXM6IDEsXG4gICAgbWlsZXM6IDMuODZlLTcsXG4gICAgbWlsbGltZXRlcnM6IDEwMDAwMDAsXG4gICAgbWlsbGltZXRyZXM6IDEwMDAwMDAsXG4gICAgeWFyZHM6IDEuMTk1OTkwMDQ2LFxufTtcbi8qKlxuICogV3JhcHMgYSBHZW9KU09OIHtAbGluayBHZW9tZXRyeX0gaW4gYSBHZW9KU09OIHtAbGluayBGZWF0dXJlfS5cbiAqXG4gKiBAbmFtZSBmZWF0dXJlXG4gKiBAcGFyYW0ge0dlb21ldHJ5fSBnZW9tZXRyeSBpbnB1dCBnZW9tZXRyeVxuICogQHBhcmFtIHtPYmplY3R9IFtwcm9wZXJ0aWVzPXt9XSBhbiBPYmplY3Qgb2Yga2V5LXZhbHVlIHBhaXJzIHRvIGFkZCBhcyBwcm9wZXJ0aWVzXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnM9e31dIE9wdGlvbmFsIFBhcmFtZXRlcnNcbiAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW29wdGlvbnMuYmJveF0gQm91bmRpbmcgQm94IEFycmF5IFt3ZXN0LCBzb3V0aCwgZWFzdCwgbm9ydGhdIGFzc29jaWF0ZWQgd2l0aCB0aGUgRmVhdHVyZVxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBbb3B0aW9ucy5pZF0gSWRlbnRpZmllciBhc3NvY2lhdGVkIHdpdGggdGhlIEZlYXR1cmVcbiAqIEByZXR1cm5zIHtGZWF0dXJlfSBhIEdlb0pTT04gRmVhdHVyZVxuICogQGV4YW1wbGVcbiAqIHZhciBnZW9tZXRyeSA9IHtcbiAqICAgXCJ0eXBlXCI6IFwiUG9pbnRcIixcbiAqICAgXCJjb29yZGluYXRlc1wiOiBbMTEwLCA1MF1cbiAqIH07XG4gKlxuICogdmFyIGZlYXR1cmUgPSB0dXJmLmZlYXR1cmUoZ2VvbWV0cnkpO1xuICpcbiAqIC8vPWZlYXR1cmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZlYXR1cmUoZ2VvbSwgcHJvcGVydGllcywgb3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XG4gICAgdmFyIGZlYXQgPSB7IHR5cGU6IFwiRmVhdHVyZVwiIH07XG4gICAgaWYgKG9wdGlvbnMuaWQgPT09IDAgfHwgb3B0aW9ucy5pZCkge1xuICAgICAgICBmZWF0LmlkID0gb3B0aW9ucy5pZDtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuYmJveCkge1xuICAgICAgICBmZWF0LmJib3ggPSBvcHRpb25zLmJib3g7XG4gICAgfVxuICAgIGZlYXQucHJvcGVydGllcyA9IHByb3BlcnRpZXMgfHwge307XG4gICAgZmVhdC5nZW9tZXRyeSA9IGdlb207XG4gICAgcmV0dXJuIGZlYXQ7XG59XG4vKipcbiAqIENyZWF0ZXMgYSBHZW9KU09OIHtAbGluayBHZW9tZXRyeX0gZnJvbSBhIEdlb21ldHJ5IHN0cmluZyB0eXBlICYgY29vcmRpbmF0ZXMuXG4gKiBGb3IgR2VvbWV0cnlDb2xsZWN0aW9uIHR5cGUgdXNlIGBoZWxwZXJzLmdlb21ldHJ5Q29sbGVjdGlvbmBcbiAqXG4gKiBAbmFtZSBnZW9tZXRyeVxuICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgR2VvbWV0cnkgVHlwZVxuICogQHBhcmFtIHtBcnJheTxhbnk+fSBjb29yZGluYXRlcyBDb29yZGluYXRlc1xuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zPXt9XSBPcHRpb25hbCBQYXJhbWV0ZXJzXG4gKiBAcmV0dXJucyB7R2VvbWV0cnl9IGEgR2VvSlNPTiBHZW9tZXRyeVxuICogQGV4YW1wbGVcbiAqIHZhciB0eXBlID0gXCJQb2ludFwiO1xuICogdmFyIGNvb3JkaW5hdGVzID0gWzExMCwgNTBdO1xuICogdmFyIGdlb21ldHJ5ID0gdHVyZi5nZW9tZXRyeSh0eXBlLCBjb29yZGluYXRlcyk7XG4gKiAvLyA9PiBnZW9tZXRyeVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VvbWV0cnkodHlwZSwgY29vcmRpbmF0ZXMsIF9vcHRpb25zKSB7XG4gICAgaWYgKF9vcHRpb25zID09PSB2b2lkIDApIHsgX29wdGlvbnMgPSB7fTsgfVxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlIFwiUG9pbnRcIjpcbiAgICAgICAgICAgIHJldHVybiBwb2ludChjb29yZGluYXRlcykuZ2VvbWV0cnk7XG4gICAgICAgIGNhc2UgXCJMaW5lU3RyaW5nXCI6XG4gICAgICAgICAgICByZXR1cm4gbGluZVN0cmluZyhjb29yZGluYXRlcykuZ2VvbWV0cnk7XG4gICAgICAgIGNhc2UgXCJQb2x5Z29uXCI6XG4gICAgICAgICAgICByZXR1cm4gcG9seWdvbihjb29yZGluYXRlcykuZ2VvbWV0cnk7XG4gICAgICAgIGNhc2UgXCJNdWx0aVBvaW50XCI6XG4gICAgICAgICAgICByZXR1cm4gbXVsdGlQb2ludChjb29yZGluYXRlcykuZ2VvbWV0cnk7XG4gICAgICAgIGNhc2UgXCJNdWx0aUxpbmVTdHJpbmdcIjpcbiAgICAgICAgICAgIHJldHVybiBtdWx0aUxpbmVTdHJpbmcoY29vcmRpbmF0ZXMpLmdlb21ldHJ5O1xuICAgICAgICBjYXNlIFwiTXVsdGlQb2x5Z29uXCI6XG4gICAgICAgICAgICByZXR1cm4gbXVsdGlQb2x5Z29uKGNvb3JkaW5hdGVzKS5nZW9tZXRyeTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcih0eXBlICsgXCIgaXMgaW52YWxpZFwiKTtcbiAgICB9XG59XG4vKipcbiAqIENyZWF0ZXMgYSB7QGxpbmsgUG9pbnR9IHtAbGluayBGZWF0dXJlfSBmcm9tIGEgUG9zaXRpb24uXG4gKlxuICogQG5hbWUgcG9pbnRcbiAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gY29vcmRpbmF0ZXMgbG9uZ2l0dWRlLCBsYXRpdHVkZSBwb3NpdGlvbiAoZWFjaCBpbiBkZWNpbWFsIGRlZ3JlZXMpXG4gKiBAcGFyYW0ge09iamVjdH0gW3Byb3BlcnRpZXM9e31dIGFuIE9iamVjdCBvZiBrZXktdmFsdWUgcGFpcnMgdG8gYWRkIGFzIHByb3BlcnRpZXNcbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz17fV0gT3B0aW9uYWwgUGFyYW1ldGVyc1xuICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbb3B0aW9ucy5iYm94XSBCb3VuZGluZyBCb3ggQXJyYXkgW3dlc3QsIHNvdXRoLCBlYXN0LCBub3J0aF0gYXNzb2NpYXRlZCB3aXRoIHRoZSBGZWF0dXJlXG4gKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IFtvcHRpb25zLmlkXSBJZGVudGlmaWVyIGFzc29jaWF0ZWQgd2l0aCB0aGUgRmVhdHVyZVxuICogQHJldHVybnMge0ZlYXR1cmU8UG9pbnQ+fSBhIFBvaW50IGZlYXR1cmVcbiAqIEBleGFtcGxlXG4gKiB2YXIgcG9pbnQgPSB0dXJmLnBvaW50KFstNzUuMzQzLCAzOS45ODRdKTtcbiAqXG4gKiAvLz1wb2ludFxuICovXG5leHBvcnQgZnVuY3Rpb24gcG9pbnQoY29vcmRpbmF0ZXMsIHByb3BlcnRpZXMsIG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxuICAgIGlmICghY29vcmRpbmF0ZXMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY29vcmRpbmF0ZXMgaXMgcmVxdWlyZWRcIik7XG4gICAgfVxuICAgIGlmICghQXJyYXkuaXNBcnJheShjb29yZGluYXRlcykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY29vcmRpbmF0ZXMgbXVzdCBiZSBhbiBBcnJheVwiKTtcbiAgICB9XG4gICAgaWYgKGNvb3JkaW5hdGVzLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY29vcmRpbmF0ZXMgbXVzdCBiZSBhdCBsZWFzdCAyIG51bWJlcnMgbG9uZ1wiKTtcbiAgICB9XG4gICAgaWYgKCFpc051bWJlcihjb29yZGluYXRlc1swXSkgfHwgIWlzTnVtYmVyKGNvb3JkaW5hdGVzWzFdKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjb29yZGluYXRlcyBtdXN0IGNvbnRhaW4gbnVtYmVyc1wiKTtcbiAgICB9XG4gICAgdmFyIGdlb20gPSB7XG4gICAgICAgIHR5cGU6IFwiUG9pbnRcIixcbiAgICAgICAgY29vcmRpbmF0ZXM6IGNvb3JkaW5hdGVzLFxuICAgIH07XG4gICAgcmV0dXJuIGZlYXR1cmUoZ2VvbSwgcHJvcGVydGllcywgb3B0aW9ucyk7XG59XG4vKipcbiAqIENyZWF0ZXMgYSB7QGxpbmsgUG9pbnR9IHtAbGluayBGZWF0dXJlQ29sbGVjdGlvbn0gZnJvbSBhbiBBcnJheSBvZiBQb2ludCBjb29yZGluYXRlcy5cbiAqXG4gKiBAbmFtZSBwb2ludHNcbiAqIEBwYXJhbSB7QXJyYXk8QXJyYXk8bnVtYmVyPj59IGNvb3JkaW5hdGVzIGFuIGFycmF5IG9mIFBvaW50c1xuICogQHBhcmFtIHtPYmplY3R9IFtwcm9wZXJ0aWVzPXt9XSBUcmFuc2xhdGUgdGhlc2UgcHJvcGVydGllcyB0byBlYWNoIEZlYXR1cmVcbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz17fV0gT3B0aW9uYWwgUGFyYW1ldGVyc1xuICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbb3B0aW9ucy5iYm94XSBCb3VuZGluZyBCb3ggQXJyYXkgW3dlc3QsIHNvdXRoLCBlYXN0LCBub3J0aF1cbiAqIGFzc29jaWF0ZWQgd2l0aCB0aGUgRmVhdHVyZUNvbGxlY3Rpb25cbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gW29wdGlvbnMuaWRdIElkZW50aWZpZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBGZWF0dXJlQ29sbGVjdGlvblxuICogQHJldHVybnMge0ZlYXR1cmVDb2xsZWN0aW9uPFBvaW50Pn0gUG9pbnQgRmVhdHVyZVxuICogQGV4YW1wbGVcbiAqIHZhciBwb2ludHMgPSB0dXJmLnBvaW50cyhbXG4gKiAgIFstNzUsIDM5XSxcbiAqICAgWy04MCwgNDVdLFxuICogICBbLTc4LCA1MF1cbiAqIF0pO1xuICpcbiAqIC8vPXBvaW50c1xuICovXG5leHBvcnQgZnVuY3Rpb24gcG9pbnRzKGNvb3JkaW5hdGVzLCBwcm9wZXJ0aWVzLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH1cbiAgICByZXR1cm4gZmVhdHVyZUNvbGxlY3Rpb24oY29vcmRpbmF0ZXMubWFwKGZ1bmN0aW9uIChjb29yZHMpIHtcbiAgICAgICAgcmV0dXJuIHBvaW50KGNvb3JkcywgcHJvcGVydGllcyk7XG4gICAgfSksIG9wdGlvbnMpO1xufVxuLyoqXG4gKiBDcmVhdGVzIGEge0BsaW5rIFBvbHlnb259IHtAbGluayBGZWF0dXJlfSBmcm9tIGFuIEFycmF5IG9mIExpbmVhclJpbmdzLlxuICpcbiAqIEBuYW1lIHBvbHlnb25cbiAqIEBwYXJhbSB7QXJyYXk8QXJyYXk8QXJyYXk8bnVtYmVyPj4+fSBjb29yZGluYXRlcyBhbiBhcnJheSBvZiBMaW5lYXJSaW5nc1xuICogQHBhcmFtIHtPYmplY3R9IFtwcm9wZXJ0aWVzPXt9XSBhbiBPYmplY3Qgb2Yga2V5LXZhbHVlIHBhaXJzIHRvIGFkZCBhcyBwcm9wZXJ0aWVzXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnM9e31dIE9wdGlvbmFsIFBhcmFtZXRlcnNcbiAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW29wdGlvbnMuYmJveF0gQm91bmRpbmcgQm94IEFycmF5IFt3ZXN0LCBzb3V0aCwgZWFzdCwgbm9ydGhdIGFzc29jaWF0ZWQgd2l0aCB0aGUgRmVhdHVyZVxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBbb3B0aW9ucy5pZF0gSWRlbnRpZmllciBhc3NvY2lhdGVkIHdpdGggdGhlIEZlYXR1cmVcbiAqIEByZXR1cm5zIHtGZWF0dXJlPFBvbHlnb24+fSBQb2x5Z29uIEZlYXR1cmVcbiAqIEBleGFtcGxlXG4gKiB2YXIgcG9seWdvbiA9IHR1cmYucG9seWdvbihbW1stNSwgNTJdLCBbLTQsIDU2XSwgWy0yLCA1MV0sIFstNywgNTRdLCBbLTUsIDUyXV1dLCB7IG5hbWU6ICdwb2x5MScgfSk7XG4gKlxuICogLy89cG9seWdvblxuICovXG5leHBvcnQgZnVuY3Rpb24gcG9seWdvbihjb29yZGluYXRlcywgcHJvcGVydGllcywgb3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XG4gICAgZm9yICh2YXIgX2kgPSAwLCBjb29yZGluYXRlc18xID0gY29vcmRpbmF0ZXM7IF9pIDwgY29vcmRpbmF0ZXNfMS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgdmFyIHJpbmcgPSBjb29yZGluYXRlc18xW19pXTtcbiAgICAgICAgaWYgKHJpbmcubGVuZ3RoIDwgNCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRWFjaCBMaW5lYXJSaW5nIG9mIGEgUG9seWdvbiBtdXN0IGhhdmUgNCBvciBtb3JlIFBvc2l0aW9ucy5cIik7XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCByaW5nW3JpbmcubGVuZ3RoIC0gMV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGZpcnN0IHBvaW50IG9mIFBvbHlnb24gY29udGFpbnMgdHdvIG51bWJlcnNcbiAgICAgICAgICAgIGlmIChyaW5nW3JpbmcubGVuZ3RoIC0gMV1bal0gIT09IHJpbmdbMF1bal0pIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGaXJzdCBhbmQgbGFzdCBQb3NpdGlvbiBhcmUgbm90IGVxdWl2YWxlbnQuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHZhciBnZW9tID0ge1xuICAgICAgICB0eXBlOiBcIlBvbHlnb25cIixcbiAgICAgICAgY29vcmRpbmF0ZXM6IGNvb3JkaW5hdGVzLFxuICAgIH07XG4gICAgcmV0dXJuIGZlYXR1cmUoZ2VvbSwgcHJvcGVydGllcywgb3B0aW9ucyk7XG59XG4vKipcbiAqIENyZWF0ZXMgYSB7QGxpbmsgUG9seWdvbn0ge0BsaW5rIEZlYXR1cmVDb2xsZWN0aW9ufSBmcm9tIGFuIEFycmF5IG9mIFBvbHlnb24gY29vcmRpbmF0ZXMuXG4gKlxuICogQG5hbWUgcG9seWdvbnNcbiAqIEBwYXJhbSB7QXJyYXk8QXJyYXk8QXJyYXk8QXJyYXk8bnVtYmVyPj4+Pn0gY29vcmRpbmF0ZXMgYW4gYXJyYXkgb2YgUG9seWdvbiBjb29yZGluYXRlc1xuICogQHBhcmFtIHtPYmplY3R9IFtwcm9wZXJ0aWVzPXt9XSBhbiBPYmplY3Qgb2Yga2V5LXZhbHVlIHBhaXJzIHRvIGFkZCBhcyBwcm9wZXJ0aWVzXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnM9e31dIE9wdGlvbmFsIFBhcmFtZXRlcnNcbiAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW29wdGlvbnMuYmJveF0gQm91bmRpbmcgQm94IEFycmF5IFt3ZXN0LCBzb3V0aCwgZWFzdCwgbm9ydGhdIGFzc29jaWF0ZWQgd2l0aCB0aGUgRmVhdHVyZVxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBbb3B0aW9ucy5pZF0gSWRlbnRpZmllciBhc3NvY2lhdGVkIHdpdGggdGhlIEZlYXR1cmVDb2xsZWN0aW9uXG4gKiBAcmV0dXJucyB7RmVhdHVyZUNvbGxlY3Rpb248UG9seWdvbj59IFBvbHlnb24gRmVhdHVyZUNvbGxlY3Rpb25cbiAqIEBleGFtcGxlXG4gKiB2YXIgcG9seWdvbnMgPSB0dXJmLnBvbHlnb25zKFtcbiAqICAgW1tbLTUsIDUyXSwgWy00LCA1Nl0sIFstMiwgNTFdLCBbLTcsIDU0XSwgWy01LCA1Ml1dXSxcbiAqICAgW1tbLTE1LCA0Ml0sIFstMTQsIDQ2XSwgWy0xMiwgNDFdLCBbLTE3LCA0NF0sIFstMTUsIDQyXV1dLFxuICogXSk7XG4gKlxuICogLy89cG9seWdvbnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBvbHlnb25zKGNvb3JkaW5hdGVzLCBwcm9wZXJ0aWVzLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH1cbiAgICByZXR1cm4gZmVhdHVyZUNvbGxlY3Rpb24oY29vcmRpbmF0ZXMubWFwKGZ1bmN0aW9uIChjb29yZHMpIHtcbiAgICAgICAgcmV0dXJuIHBvbHlnb24oY29vcmRzLCBwcm9wZXJ0aWVzKTtcbiAgICB9KSwgb3B0aW9ucyk7XG59XG4vKipcbiAqIENyZWF0ZXMgYSB7QGxpbmsgTGluZVN0cmluZ30ge0BsaW5rIEZlYXR1cmV9IGZyb20gYW4gQXJyYXkgb2YgUG9zaXRpb25zLlxuICpcbiAqIEBuYW1lIGxpbmVTdHJpbmdcbiAqIEBwYXJhbSB7QXJyYXk8QXJyYXk8bnVtYmVyPj59IGNvb3JkaW5hdGVzIGFuIGFycmF5IG9mIFBvc2l0aW9uc1xuICogQHBhcmFtIHtPYmplY3R9IFtwcm9wZXJ0aWVzPXt9XSBhbiBPYmplY3Qgb2Yga2V5LXZhbHVlIHBhaXJzIHRvIGFkZCBhcyBwcm9wZXJ0aWVzXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnM9e31dIE9wdGlvbmFsIFBhcmFtZXRlcnNcbiAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW29wdGlvbnMuYmJveF0gQm91bmRpbmcgQm94IEFycmF5IFt3ZXN0LCBzb3V0aCwgZWFzdCwgbm9ydGhdIGFzc29jaWF0ZWQgd2l0aCB0aGUgRmVhdHVyZVxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBbb3B0aW9ucy5pZF0gSWRlbnRpZmllciBhc3NvY2lhdGVkIHdpdGggdGhlIEZlYXR1cmVcbiAqIEByZXR1cm5zIHtGZWF0dXJlPExpbmVTdHJpbmc+fSBMaW5lU3RyaW5nIEZlYXR1cmVcbiAqIEBleGFtcGxlXG4gKiB2YXIgbGluZXN0cmluZzEgPSB0dXJmLmxpbmVTdHJpbmcoW1stMjQsIDYzXSwgWy0yMywgNjBdLCBbLTI1LCA2NV0sIFstMjAsIDY5XV0sIHtuYW1lOiAnbGluZSAxJ30pO1xuICogdmFyIGxpbmVzdHJpbmcyID0gdHVyZi5saW5lU3RyaW5nKFtbLTE0LCA0M10sIFstMTMsIDQwXSwgWy0xNSwgNDVdLCBbLTEwLCA0OV1dLCB7bmFtZTogJ2xpbmUgMid9KTtcbiAqXG4gKiAvLz1saW5lc3RyaW5nMVxuICogLy89bGluZXN0cmluZzJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxpbmVTdHJpbmcoY29vcmRpbmF0ZXMsIHByb3BlcnRpZXMsIG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxuICAgIGlmIChjb29yZGluYXRlcy5sZW5ndGggPCAyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImNvb3JkaW5hdGVzIG11c3QgYmUgYW4gYXJyYXkgb2YgdHdvIG9yIG1vcmUgcG9zaXRpb25zXCIpO1xuICAgIH1cbiAgICB2YXIgZ2VvbSA9IHtcbiAgICAgICAgdHlwZTogXCJMaW5lU3RyaW5nXCIsXG4gICAgICAgIGNvb3JkaW5hdGVzOiBjb29yZGluYXRlcyxcbiAgICB9O1xuICAgIHJldHVybiBmZWF0dXJlKGdlb20sIHByb3BlcnRpZXMsIG9wdGlvbnMpO1xufVxuLyoqXG4gKiBDcmVhdGVzIGEge0BsaW5rIExpbmVTdHJpbmd9IHtAbGluayBGZWF0dXJlQ29sbGVjdGlvbn0gZnJvbSBhbiBBcnJheSBvZiBMaW5lU3RyaW5nIGNvb3JkaW5hdGVzLlxuICpcbiAqIEBuYW1lIGxpbmVTdHJpbmdzXG4gKiBAcGFyYW0ge0FycmF5PEFycmF5PEFycmF5PG51bWJlcj4+Pn0gY29vcmRpbmF0ZXMgYW4gYXJyYXkgb2YgTGluZWFyUmluZ3NcbiAqIEBwYXJhbSB7T2JqZWN0fSBbcHJvcGVydGllcz17fV0gYW4gT2JqZWN0IG9mIGtleS12YWx1ZSBwYWlycyB0byBhZGQgYXMgcHJvcGVydGllc1xuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zPXt9XSBPcHRpb25hbCBQYXJhbWV0ZXJzXG4gKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IFtvcHRpb25zLmJib3hdIEJvdW5kaW5nIEJveCBBcnJheSBbd2VzdCwgc291dGgsIGVhc3QsIG5vcnRoXVxuICogYXNzb2NpYXRlZCB3aXRoIHRoZSBGZWF0dXJlQ29sbGVjdGlvblxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBbb3B0aW9ucy5pZF0gSWRlbnRpZmllciBhc3NvY2lhdGVkIHdpdGggdGhlIEZlYXR1cmVDb2xsZWN0aW9uXG4gKiBAcmV0dXJucyB7RmVhdHVyZUNvbGxlY3Rpb248TGluZVN0cmluZz59IExpbmVTdHJpbmcgRmVhdHVyZUNvbGxlY3Rpb25cbiAqIEBleGFtcGxlXG4gKiB2YXIgbGluZXN0cmluZ3MgPSB0dXJmLmxpbmVTdHJpbmdzKFtcbiAqICAgW1stMjQsIDYzXSwgWy0yMywgNjBdLCBbLTI1LCA2NV0sIFstMjAsIDY5XV0sXG4gKiAgIFtbLTE0LCA0M10sIFstMTMsIDQwXSwgWy0xNSwgNDVdLCBbLTEwLCA0OV1dXG4gKiBdKTtcbiAqXG4gKiAvLz1saW5lc3RyaW5nc1xuICovXG5leHBvcnQgZnVuY3Rpb24gbGluZVN0cmluZ3MoY29vcmRpbmF0ZXMsIHByb3BlcnRpZXMsIG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxuICAgIHJldHVybiBmZWF0dXJlQ29sbGVjdGlvbihjb29yZGluYXRlcy5tYXAoZnVuY3Rpb24gKGNvb3Jkcykge1xuICAgICAgICByZXR1cm4gbGluZVN0cmluZyhjb29yZHMsIHByb3BlcnRpZXMpO1xuICAgIH0pLCBvcHRpb25zKTtcbn1cbi8qKlxuICogVGFrZXMgb25lIG9yIG1vcmUge0BsaW5rIEZlYXR1cmV8RmVhdHVyZXN9IGFuZCBjcmVhdGVzIGEge0BsaW5rIEZlYXR1cmVDb2xsZWN0aW9ufS5cbiAqXG4gKiBAbmFtZSBmZWF0dXJlQ29sbGVjdGlvblxuICogQHBhcmFtIHtGZWF0dXJlW119IGZlYXR1cmVzIGlucHV0IGZlYXR1cmVzXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnM9e31dIE9wdGlvbmFsIFBhcmFtZXRlcnNcbiAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW29wdGlvbnMuYmJveF0gQm91bmRpbmcgQm94IEFycmF5IFt3ZXN0LCBzb3V0aCwgZWFzdCwgbm9ydGhdIGFzc29jaWF0ZWQgd2l0aCB0aGUgRmVhdHVyZVxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBbb3B0aW9ucy5pZF0gSWRlbnRpZmllciBhc3NvY2lhdGVkIHdpdGggdGhlIEZlYXR1cmVcbiAqIEByZXR1cm5zIHtGZWF0dXJlQ29sbGVjdGlvbn0gRmVhdHVyZUNvbGxlY3Rpb24gb2YgRmVhdHVyZXNcbiAqIEBleGFtcGxlXG4gKiB2YXIgbG9jYXRpb25BID0gdHVyZi5wb2ludChbLTc1LjM0MywgMzkuOTg0XSwge25hbWU6ICdMb2NhdGlvbiBBJ30pO1xuICogdmFyIGxvY2F0aW9uQiA9IHR1cmYucG9pbnQoWy03NS44MzMsIDM5LjI4NF0sIHtuYW1lOiAnTG9jYXRpb24gQid9KTtcbiAqIHZhciBsb2NhdGlvbkMgPSB0dXJmLnBvaW50KFstNzUuNTM0LCAzOS4xMjNdLCB7bmFtZTogJ0xvY2F0aW9uIEMnfSk7XG4gKlxuICogdmFyIGNvbGxlY3Rpb24gPSB0dXJmLmZlYXR1cmVDb2xsZWN0aW9uKFtcbiAqICAgbG9jYXRpb25BLFxuICogICBsb2NhdGlvbkIsXG4gKiAgIGxvY2F0aW9uQ1xuICogXSk7XG4gKlxuICogLy89Y29sbGVjdGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gZmVhdHVyZUNvbGxlY3Rpb24oZmVhdHVyZXMsIG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxuICAgIHZhciBmYyA9IHsgdHlwZTogXCJGZWF0dXJlQ29sbGVjdGlvblwiIH07XG4gICAgaWYgKG9wdGlvbnMuaWQpIHtcbiAgICAgICAgZmMuaWQgPSBvcHRpb25zLmlkO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5iYm94KSB7XG4gICAgICAgIGZjLmJib3ggPSBvcHRpb25zLmJib3g7XG4gICAgfVxuICAgIGZjLmZlYXR1cmVzID0gZmVhdHVyZXM7XG4gICAgcmV0dXJuIGZjO1xufVxuLyoqXG4gKiBDcmVhdGVzIGEge0BsaW5rIEZlYXR1cmU8TXVsdGlMaW5lU3RyaW5nPn0gYmFzZWQgb24gYVxuICogY29vcmRpbmF0ZSBhcnJheS4gUHJvcGVydGllcyBjYW4gYmUgYWRkZWQgb3B0aW9uYWxseS5cbiAqXG4gKiBAbmFtZSBtdWx0aUxpbmVTdHJpbmdcbiAqIEBwYXJhbSB7QXJyYXk8QXJyYXk8QXJyYXk8bnVtYmVyPj4+fSBjb29yZGluYXRlcyBhbiBhcnJheSBvZiBMaW5lU3RyaW5nc1xuICogQHBhcmFtIHtPYmplY3R9IFtwcm9wZXJ0aWVzPXt9XSBhbiBPYmplY3Qgb2Yga2V5LXZhbHVlIHBhaXJzIHRvIGFkZCBhcyBwcm9wZXJ0aWVzXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnM9e31dIE9wdGlvbmFsIFBhcmFtZXRlcnNcbiAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW29wdGlvbnMuYmJveF0gQm91bmRpbmcgQm94IEFycmF5IFt3ZXN0LCBzb3V0aCwgZWFzdCwgbm9ydGhdIGFzc29jaWF0ZWQgd2l0aCB0aGUgRmVhdHVyZVxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBbb3B0aW9ucy5pZF0gSWRlbnRpZmllciBhc3NvY2lhdGVkIHdpdGggdGhlIEZlYXR1cmVcbiAqIEByZXR1cm5zIHtGZWF0dXJlPE11bHRpTGluZVN0cmluZz59IGEgTXVsdGlMaW5lU3RyaW5nIGZlYXR1cmVcbiAqIEB0aHJvd3Mge0Vycm9yfSBpZiBubyBjb29yZGluYXRlcyBhcmUgcGFzc2VkXG4gKiBAZXhhbXBsZVxuICogdmFyIG11bHRpTGluZSA9IHR1cmYubXVsdGlMaW5lU3RyaW5nKFtbWzAsMF0sWzEwLDEwXV1dKTtcbiAqXG4gKiAvLz1tdWx0aUxpbmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG11bHRpTGluZVN0cmluZyhjb29yZGluYXRlcywgcHJvcGVydGllcywgb3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XG4gICAgdmFyIGdlb20gPSB7XG4gICAgICAgIHR5cGU6IFwiTXVsdGlMaW5lU3RyaW5nXCIsXG4gICAgICAgIGNvb3JkaW5hdGVzOiBjb29yZGluYXRlcyxcbiAgICB9O1xuICAgIHJldHVybiBmZWF0dXJlKGdlb20sIHByb3BlcnRpZXMsIG9wdGlvbnMpO1xufVxuLyoqXG4gKiBDcmVhdGVzIGEge0BsaW5rIEZlYXR1cmU8TXVsdGlQb2ludD59IGJhc2VkIG9uIGFcbiAqIGNvb3JkaW5hdGUgYXJyYXkuIFByb3BlcnRpZXMgY2FuIGJlIGFkZGVkIG9wdGlvbmFsbHkuXG4gKlxuICogQG5hbWUgbXVsdGlQb2ludFxuICogQHBhcmFtIHtBcnJheTxBcnJheTxudW1iZXI+Pn0gY29vcmRpbmF0ZXMgYW4gYXJyYXkgb2YgUG9zaXRpb25zXG4gKiBAcGFyYW0ge09iamVjdH0gW3Byb3BlcnRpZXM9e31dIGFuIE9iamVjdCBvZiBrZXktdmFsdWUgcGFpcnMgdG8gYWRkIGFzIHByb3BlcnRpZXNcbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz17fV0gT3B0aW9uYWwgUGFyYW1ldGVyc1xuICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbb3B0aW9ucy5iYm94XSBCb3VuZGluZyBCb3ggQXJyYXkgW3dlc3QsIHNvdXRoLCBlYXN0LCBub3J0aF0gYXNzb2NpYXRlZCB3aXRoIHRoZSBGZWF0dXJlXG4gKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IFtvcHRpb25zLmlkXSBJZGVudGlmaWVyIGFzc29jaWF0ZWQgd2l0aCB0aGUgRmVhdHVyZVxuICogQHJldHVybnMge0ZlYXR1cmU8TXVsdGlQb2ludD59IGEgTXVsdGlQb2ludCBmZWF0dXJlXG4gKiBAdGhyb3dzIHtFcnJvcn0gaWYgbm8gY29vcmRpbmF0ZXMgYXJlIHBhc3NlZFxuICogQGV4YW1wbGVcbiAqIHZhciBtdWx0aVB0ID0gdHVyZi5tdWx0aVBvaW50KFtbMCwwXSxbMTAsMTBdXSk7XG4gKlxuICogLy89bXVsdGlQdFxuICovXG5leHBvcnQgZnVuY3Rpb24gbXVsdGlQb2ludChjb29yZGluYXRlcywgcHJvcGVydGllcywgb3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XG4gICAgdmFyIGdlb20gPSB7XG4gICAgICAgIHR5cGU6IFwiTXVsdGlQb2ludFwiLFxuICAgICAgICBjb29yZGluYXRlczogY29vcmRpbmF0ZXMsXG4gICAgfTtcbiAgICByZXR1cm4gZmVhdHVyZShnZW9tLCBwcm9wZXJ0aWVzLCBvcHRpb25zKTtcbn1cbi8qKlxuICogQ3JlYXRlcyBhIHtAbGluayBGZWF0dXJlPE11bHRpUG9seWdvbj59IGJhc2VkIG9uIGFcbiAqIGNvb3JkaW5hdGUgYXJyYXkuIFByb3BlcnRpZXMgY2FuIGJlIGFkZGVkIG9wdGlvbmFsbHkuXG4gKlxuICogQG5hbWUgbXVsdGlQb2x5Z29uXG4gKiBAcGFyYW0ge0FycmF5PEFycmF5PEFycmF5PEFycmF5PG51bWJlcj4+Pj59IGNvb3JkaW5hdGVzIGFuIGFycmF5IG9mIFBvbHlnb25zXG4gKiBAcGFyYW0ge09iamVjdH0gW3Byb3BlcnRpZXM9e31dIGFuIE9iamVjdCBvZiBrZXktdmFsdWUgcGFpcnMgdG8gYWRkIGFzIHByb3BlcnRpZXNcbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz17fV0gT3B0aW9uYWwgUGFyYW1ldGVyc1xuICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbb3B0aW9ucy5iYm94XSBCb3VuZGluZyBCb3ggQXJyYXkgW3dlc3QsIHNvdXRoLCBlYXN0LCBub3J0aF0gYXNzb2NpYXRlZCB3aXRoIHRoZSBGZWF0dXJlXG4gKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IFtvcHRpb25zLmlkXSBJZGVudGlmaWVyIGFzc29jaWF0ZWQgd2l0aCB0aGUgRmVhdHVyZVxuICogQHJldHVybnMge0ZlYXR1cmU8TXVsdGlQb2x5Z29uPn0gYSBtdWx0aXBvbHlnb24gZmVhdHVyZVxuICogQHRocm93cyB7RXJyb3J9IGlmIG5vIGNvb3JkaW5hdGVzIGFyZSBwYXNzZWRcbiAqIEBleGFtcGxlXG4gKiB2YXIgbXVsdGlQb2x5ID0gdHVyZi5tdWx0aVBvbHlnb24oW1tbWzAsMF0sWzAsMTBdLFsxMCwxMF0sWzEwLDBdLFswLDBdXV1dKTtcbiAqXG4gKiAvLz1tdWx0aVBvbHlcbiAqXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtdWx0aVBvbHlnb24oY29vcmRpbmF0ZXMsIHByb3BlcnRpZXMsIG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxuICAgIHZhciBnZW9tID0ge1xuICAgICAgICB0eXBlOiBcIk11bHRpUG9seWdvblwiLFxuICAgICAgICBjb29yZGluYXRlczogY29vcmRpbmF0ZXMsXG4gICAgfTtcbiAgICByZXR1cm4gZmVhdHVyZShnZW9tLCBwcm9wZXJ0aWVzLCBvcHRpb25zKTtcbn1cbi8qKlxuICogQ3JlYXRlcyBhIHtAbGluayBGZWF0dXJlPEdlb21ldHJ5Q29sbGVjdGlvbj59IGJhc2VkIG9uIGFcbiAqIGNvb3JkaW5hdGUgYXJyYXkuIFByb3BlcnRpZXMgY2FuIGJlIGFkZGVkIG9wdGlvbmFsbHkuXG4gKlxuICogQG5hbWUgZ2VvbWV0cnlDb2xsZWN0aW9uXG4gKiBAcGFyYW0ge0FycmF5PEdlb21ldHJ5Pn0gZ2VvbWV0cmllcyBhbiBhcnJheSBvZiBHZW9KU09OIEdlb21ldHJpZXNcbiAqIEBwYXJhbSB7T2JqZWN0fSBbcHJvcGVydGllcz17fV0gYW4gT2JqZWN0IG9mIGtleS12YWx1ZSBwYWlycyB0byBhZGQgYXMgcHJvcGVydGllc1xuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zPXt9XSBPcHRpb25hbCBQYXJhbWV0ZXJzXG4gKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IFtvcHRpb25zLmJib3hdIEJvdW5kaW5nIEJveCBBcnJheSBbd2VzdCwgc291dGgsIGVhc3QsIG5vcnRoXSBhc3NvY2lhdGVkIHdpdGggdGhlIEZlYXR1cmVcbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gW29wdGlvbnMuaWRdIElkZW50aWZpZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBGZWF0dXJlXG4gKiBAcmV0dXJucyB7RmVhdHVyZTxHZW9tZXRyeUNvbGxlY3Rpb24+fSBhIEdlb0pTT04gR2VvbWV0cnlDb2xsZWN0aW9uIEZlYXR1cmVcbiAqIEBleGFtcGxlXG4gKiB2YXIgcHQgPSB0dXJmLmdlb21ldHJ5KFwiUG9pbnRcIiwgWzEwMCwgMF0pO1xuICogdmFyIGxpbmUgPSB0dXJmLmdlb21ldHJ5KFwiTGluZVN0cmluZ1wiLCBbWzEwMSwgMF0sIFsxMDIsIDFdXSk7XG4gKiB2YXIgY29sbGVjdGlvbiA9IHR1cmYuZ2VvbWV0cnlDb2xsZWN0aW9uKFtwdCwgbGluZV0pO1xuICpcbiAqIC8vID0+IGNvbGxlY3Rpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlb21ldHJ5Q29sbGVjdGlvbihnZW9tZXRyaWVzLCBwcm9wZXJ0aWVzLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH1cbiAgICB2YXIgZ2VvbSA9IHtcbiAgICAgICAgdHlwZTogXCJHZW9tZXRyeUNvbGxlY3Rpb25cIixcbiAgICAgICAgZ2VvbWV0cmllczogZ2VvbWV0cmllcyxcbiAgICB9O1xuICAgIHJldHVybiBmZWF0dXJlKGdlb20sIHByb3BlcnRpZXMsIG9wdGlvbnMpO1xufVxuLyoqXG4gKiBSb3VuZCBudW1iZXIgdG8gcHJlY2lzaW9uXG4gKlxuICogQHBhcmFtIHtudW1iZXJ9IG51bSBOdW1iZXJcbiAqIEBwYXJhbSB7bnVtYmVyfSBbcHJlY2lzaW9uPTBdIFByZWNpc2lvblxuICogQHJldHVybnMge251bWJlcn0gcm91bmRlZCBudW1iZXJcbiAqIEBleGFtcGxlXG4gKiB0dXJmLnJvdW5kKDEyMC40MzIxKVxuICogLy89MTIwXG4gKlxuICogdHVyZi5yb3VuZCgxMjAuNDMyMSwgMilcbiAqIC8vPTEyMC40M1xuICovXG5leHBvcnQgZnVuY3Rpb24gcm91bmQobnVtLCBwcmVjaXNpb24pIHtcbiAgICBpZiAocHJlY2lzaW9uID09PSB2b2lkIDApIHsgcHJlY2lzaW9uID0gMDsgfVxuICAgIGlmIChwcmVjaXNpb24gJiYgIShwcmVjaXNpb24gPj0gMCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicHJlY2lzaW9uIG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXJcIik7XG4gICAgfVxuICAgIHZhciBtdWx0aXBsaWVyID0gTWF0aC5wb3coMTAsIHByZWNpc2lvbiB8fCAwKTtcbiAgICByZXR1cm4gTWF0aC5yb3VuZChudW0gKiBtdWx0aXBsaWVyKSAvIG11bHRpcGxpZXI7XG59XG4vKipcbiAqIENvbnZlcnQgYSBkaXN0YW5jZSBtZWFzdXJlbWVudCAoYXNzdW1pbmcgYSBzcGhlcmljYWwgRWFydGgpIGZyb20gcmFkaWFucyB0byBhIG1vcmUgZnJpZW5kbHkgdW5pdC5cbiAqIFZhbGlkIHVuaXRzOiBtaWxlcywgbmF1dGljYWxtaWxlcywgaW5jaGVzLCB5YXJkcywgbWV0ZXJzLCBtZXRyZXMsIGtpbG9tZXRlcnMsIGNlbnRpbWV0ZXJzLCBmZWV0XG4gKlxuICogQG5hbWUgcmFkaWFuc1RvTGVuZ3RoXG4gKiBAcGFyYW0ge251bWJlcn0gcmFkaWFucyBpbiByYWRpYW5zIGFjcm9zcyB0aGUgc3BoZXJlXG4gKiBAcGFyYW0ge3N0cmluZ30gW3VuaXRzPVwia2lsb21ldGVyc1wiXSBjYW4gYmUgZGVncmVlcywgcmFkaWFucywgbWlsZXMsIGluY2hlcywgeWFyZHMsIG1ldHJlcyxcbiAqIG1ldGVycywga2lsb21ldHJlcywga2lsb21ldGVycy5cbiAqIEByZXR1cm5zIHtudW1iZXJ9IGRpc3RhbmNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByYWRpYW5zVG9MZW5ndGgocmFkaWFucywgdW5pdHMpIHtcbiAgICBpZiAodW5pdHMgPT09IHZvaWQgMCkgeyB1bml0cyA9IFwia2lsb21ldGVyc1wiOyB9XG4gICAgdmFyIGZhY3RvciA9IGZhY3RvcnNbdW5pdHNdO1xuICAgIGlmICghZmFjdG9yKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcih1bml0cyArIFwiIHVuaXRzIGlzIGludmFsaWRcIik7XG4gICAgfVxuICAgIHJldHVybiByYWRpYW5zICogZmFjdG9yO1xufVxuLyoqXG4gKiBDb252ZXJ0IGEgZGlzdGFuY2UgbWVhc3VyZW1lbnQgKGFzc3VtaW5nIGEgc3BoZXJpY2FsIEVhcnRoKSBmcm9tIGEgcmVhbC13b3JsZCB1bml0IGludG8gcmFkaWFuc1xuICogVmFsaWQgdW5pdHM6IG1pbGVzLCBuYXV0aWNhbG1pbGVzLCBpbmNoZXMsIHlhcmRzLCBtZXRlcnMsIG1ldHJlcywga2lsb21ldGVycywgY2VudGltZXRlcnMsIGZlZXRcbiAqXG4gKiBAbmFtZSBsZW5ndGhUb1JhZGlhbnNcbiAqIEBwYXJhbSB7bnVtYmVyfSBkaXN0YW5jZSBpbiByZWFsIHVuaXRzXG4gKiBAcGFyYW0ge3N0cmluZ30gW3VuaXRzPVwia2lsb21ldGVyc1wiXSBjYW4gYmUgZGVncmVlcywgcmFkaWFucywgbWlsZXMsIGluY2hlcywgeWFyZHMsIG1ldHJlcyxcbiAqIG1ldGVycywga2lsb21ldHJlcywga2lsb21ldGVycy5cbiAqIEByZXR1cm5zIHtudW1iZXJ9IHJhZGlhbnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxlbmd0aFRvUmFkaWFucyhkaXN0YW5jZSwgdW5pdHMpIHtcbiAgICBpZiAodW5pdHMgPT09IHZvaWQgMCkgeyB1bml0cyA9IFwia2lsb21ldGVyc1wiOyB9XG4gICAgdmFyIGZhY3RvciA9IGZhY3RvcnNbdW5pdHNdO1xuICAgIGlmICghZmFjdG9yKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcih1bml0cyArIFwiIHVuaXRzIGlzIGludmFsaWRcIik7XG4gICAgfVxuICAgIHJldHVybiBkaXN0YW5jZSAvIGZhY3Rvcjtcbn1cbi8qKlxuICogQ29udmVydCBhIGRpc3RhbmNlIG1lYXN1cmVtZW50IChhc3N1bWluZyBhIHNwaGVyaWNhbCBFYXJ0aCkgZnJvbSBhIHJlYWwtd29ybGQgdW5pdCBpbnRvIGRlZ3JlZXNcbiAqIFZhbGlkIHVuaXRzOiBtaWxlcywgbmF1dGljYWxtaWxlcywgaW5jaGVzLCB5YXJkcywgbWV0ZXJzLCBtZXRyZXMsIGNlbnRpbWV0ZXJzLCBraWxvbWV0cmVzLCBmZWV0XG4gKlxuICogQG5hbWUgbGVuZ3RoVG9EZWdyZWVzXG4gKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgaW4gcmVhbCB1bml0c1xuICogQHBhcmFtIHtzdHJpbmd9IFt1bml0cz1cImtpbG9tZXRlcnNcIl0gY2FuIGJlIGRlZ3JlZXMsIHJhZGlhbnMsIG1pbGVzLCBpbmNoZXMsIHlhcmRzLCBtZXRyZXMsXG4gKiBtZXRlcnMsIGtpbG9tZXRyZXMsIGtpbG9tZXRlcnMuXG4gKiBAcmV0dXJucyB7bnVtYmVyfSBkZWdyZWVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBsZW5ndGhUb0RlZ3JlZXMoZGlzdGFuY2UsIHVuaXRzKSB7XG4gICAgcmV0dXJuIHJhZGlhbnNUb0RlZ3JlZXMobGVuZ3RoVG9SYWRpYW5zKGRpc3RhbmNlLCB1bml0cykpO1xufVxuLyoqXG4gKiBDb252ZXJ0cyBhbnkgYmVhcmluZyBhbmdsZSBmcm9tIHRoZSBub3J0aCBsaW5lIGRpcmVjdGlvbiAocG9zaXRpdmUgY2xvY2t3aXNlKVxuICogYW5kIHJldHVybnMgYW4gYW5nbGUgYmV0d2VlbiAwLTM2MCBkZWdyZWVzIChwb3NpdGl2ZSBjbG9ja3dpc2UpLCAwIGJlaW5nIHRoZSBub3J0aCBsaW5lXG4gKlxuICogQG5hbWUgYmVhcmluZ1RvQXppbXV0aFxuICogQHBhcmFtIHtudW1iZXJ9IGJlYXJpbmcgYW5nbGUsIGJldHdlZW4gLTE4MCBhbmQgKzE4MCBkZWdyZWVzXG4gKiBAcmV0dXJucyB7bnVtYmVyfSBhbmdsZSBiZXR3ZWVuIDAgYW5kIDM2MCBkZWdyZWVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBiZWFyaW5nVG9BemltdXRoKGJlYXJpbmcpIHtcbiAgICB2YXIgYW5nbGUgPSBiZWFyaW5nICUgMzYwO1xuICAgIGlmIChhbmdsZSA8IDApIHtcbiAgICAgICAgYW5nbGUgKz0gMzYwO1xuICAgIH1cbiAgICByZXR1cm4gYW5nbGU7XG59XG4vKipcbiAqIENvbnZlcnRzIGFuIGFuZ2xlIGluIHJhZGlhbnMgdG8gZGVncmVlc1xuICpcbiAqIEBuYW1lIHJhZGlhbnNUb0RlZ3JlZXNcbiAqIEBwYXJhbSB7bnVtYmVyfSByYWRpYW5zIGFuZ2xlIGluIHJhZGlhbnNcbiAqIEByZXR1cm5zIHtudW1iZXJ9IGRlZ3JlZXMgYmV0d2VlbiAwIGFuZCAzNjAgZGVncmVlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gcmFkaWFuc1RvRGVncmVlcyhyYWRpYW5zKSB7XG4gICAgdmFyIGRlZ3JlZXMgPSByYWRpYW5zICUgKDIgKiBNYXRoLlBJKTtcbiAgICByZXR1cm4gKGRlZ3JlZXMgKiAxODApIC8gTWF0aC5QSTtcbn1cbi8qKlxuICogQ29udmVydHMgYW4gYW5nbGUgaW4gZGVncmVlcyB0byByYWRpYW5zXG4gKlxuICogQG5hbWUgZGVncmVlc1RvUmFkaWFuc1xuICogQHBhcmFtIHtudW1iZXJ9IGRlZ3JlZXMgYW5nbGUgYmV0d2VlbiAwIGFuZCAzNjAgZGVncmVlc1xuICogQHJldHVybnMge251bWJlcn0gYW5nbGUgaW4gcmFkaWFuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZGVncmVlc1RvUmFkaWFucyhkZWdyZWVzKSB7XG4gICAgdmFyIHJhZGlhbnMgPSBkZWdyZWVzICUgMzYwO1xuICAgIHJldHVybiAocmFkaWFucyAqIE1hdGguUEkpIC8gMTgwO1xufVxuLyoqXG4gKiBDb252ZXJ0cyBhIGxlbmd0aCB0byB0aGUgcmVxdWVzdGVkIHVuaXQuXG4gKiBWYWxpZCB1bml0czogbWlsZXMsIG5hdXRpY2FsbWlsZXMsIGluY2hlcywgeWFyZHMsIG1ldGVycywgbWV0cmVzLCBraWxvbWV0ZXJzLCBjZW50aW1ldGVycywgZmVldFxuICpcbiAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggdG8gYmUgY29udmVydGVkXG4gKiBAcGFyYW0ge1VuaXRzfSBbb3JpZ2luYWxVbml0PVwia2lsb21ldGVyc1wiXSBvZiB0aGUgbGVuZ3RoXG4gKiBAcGFyYW0ge1VuaXRzfSBbZmluYWxVbml0PVwia2lsb21ldGVyc1wiXSByZXR1cm5lZCB1bml0XG4gKiBAcmV0dXJucyB7bnVtYmVyfSB0aGUgY29udmVydGVkIGxlbmd0aFxuICovXG5leHBvcnQgZnVuY3Rpb24gY29udmVydExlbmd0aChsZW5ndGgsIG9yaWdpbmFsVW5pdCwgZmluYWxVbml0KSB7XG4gICAgaWYgKG9yaWdpbmFsVW5pdCA9PT0gdm9pZCAwKSB7IG9yaWdpbmFsVW5pdCA9IFwia2lsb21ldGVyc1wiOyB9XG4gICAgaWYgKGZpbmFsVW5pdCA9PT0gdm9pZCAwKSB7IGZpbmFsVW5pdCA9IFwia2lsb21ldGVyc1wiOyB9XG4gICAgaWYgKCEobGVuZ3RoID49IDApKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImxlbmd0aCBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyXCIpO1xuICAgIH1cbiAgICByZXR1cm4gcmFkaWFuc1RvTGVuZ3RoKGxlbmd0aFRvUmFkaWFucyhsZW5ndGgsIG9yaWdpbmFsVW5pdCksIGZpbmFsVW5pdCk7XG59XG4vKipcbiAqIENvbnZlcnRzIGEgYXJlYSB0byB0aGUgcmVxdWVzdGVkIHVuaXQuXG4gKiBWYWxpZCB1bml0czoga2lsb21ldGVycywga2lsb21ldHJlcywgbWV0ZXJzLCBtZXRyZXMsIGNlbnRpbWV0cmVzLCBtaWxsaW1ldGVycywgYWNyZXMsIG1pbGVzLCB5YXJkcywgZmVldCwgaW5jaGVzLCBoZWN0YXJlc1xuICogQHBhcmFtIHtudW1iZXJ9IGFyZWEgdG8gYmUgY29udmVydGVkXG4gKiBAcGFyYW0ge1VuaXRzfSBbb3JpZ2luYWxVbml0PVwibWV0ZXJzXCJdIG9mIHRoZSBkaXN0YW5jZVxuICogQHBhcmFtIHtVbml0c30gW2ZpbmFsVW5pdD1cImtpbG9tZXRlcnNcIl0gcmV0dXJuZWQgdW5pdFxuICogQHJldHVybnMge251bWJlcn0gdGhlIGNvbnZlcnRlZCBhcmVhXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0QXJlYShhcmVhLCBvcmlnaW5hbFVuaXQsIGZpbmFsVW5pdCkge1xuICAgIGlmIChvcmlnaW5hbFVuaXQgPT09IHZvaWQgMCkgeyBvcmlnaW5hbFVuaXQgPSBcIm1ldGVyc1wiOyB9XG4gICAgaWYgKGZpbmFsVW5pdCA9PT0gdm9pZCAwKSB7IGZpbmFsVW5pdCA9IFwia2lsb21ldGVyc1wiOyB9XG4gICAgaWYgKCEoYXJlYSA+PSAwKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJhcmVhIG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXJcIik7XG4gICAgfVxuICAgIHZhciBzdGFydEZhY3RvciA9IGFyZWFGYWN0b3JzW29yaWdpbmFsVW5pdF07XG4gICAgaWYgKCFzdGFydEZhY3Rvcikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbnZhbGlkIG9yaWdpbmFsIHVuaXRzXCIpO1xuICAgIH1cbiAgICB2YXIgZmluYWxGYWN0b3IgPSBhcmVhRmFjdG9yc1tmaW5hbFVuaXRdO1xuICAgIGlmICghZmluYWxGYWN0b3IpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaW52YWxpZCBmaW5hbCB1bml0c1wiKTtcbiAgICB9XG4gICAgcmV0dXJuIChhcmVhIC8gc3RhcnRGYWN0b3IpICogZmluYWxGYWN0b3I7XG59XG4vKipcbiAqIGlzTnVtYmVyXG4gKlxuICogQHBhcmFtIHsqfSBudW0gTnVtYmVyIHRvIHZhbGlkYXRlXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZS9mYWxzZVxuICogQGV4YW1wbGVcbiAqIHR1cmYuaXNOdW1iZXIoMTIzKVxuICogLy89dHJ1ZVxuICogdHVyZi5pc051bWJlcignZm9vJylcbiAqIC8vPWZhbHNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc051bWJlcihudW0pIHtcbiAgICByZXR1cm4gIWlzTmFOKG51bSkgJiYgbnVtICE9PSBudWxsICYmICFBcnJheS5pc0FycmF5KG51bSk7XG59XG4vKipcbiAqIGlzT2JqZWN0XG4gKlxuICogQHBhcmFtIHsqfSBpbnB1dCB2YXJpYWJsZSB0byB2YWxpZGF0ZVxuICogQHJldHVybnMge2Jvb2xlYW59IHRydWUvZmFsc2VcbiAqIEBleGFtcGxlXG4gKiB0dXJmLmlzT2JqZWN0KHtlbGV2YXRpb246IDEwfSlcbiAqIC8vPXRydWVcbiAqIHR1cmYuaXNPYmplY3QoJ2ZvbycpXG4gKiAvLz1mYWxzZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNPYmplY3QoaW5wdXQpIHtcbiAgICByZXR1cm4gISFpbnB1dCAmJiBpbnB1dC5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0O1xufVxuLyoqXG4gKiBWYWxpZGF0ZSBCQm94XG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYmJveCBCQm94IHRvIHZhbGlkYXRlXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqIEB0aHJvd3MgRXJyb3IgaWYgQkJveCBpcyBub3QgdmFsaWRcbiAqIEBleGFtcGxlXG4gKiB2YWxpZGF0ZUJCb3goWy0xODAsIC00MCwgMTEwLCA1MF0pXG4gKiAvLz1PS1xuICogdmFsaWRhdGVCQm94KFstMTgwLCAtNDBdKVxuICogLy89RXJyb3JcbiAqIHZhbGlkYXRlQkJveCgnRm9vJylcbiAqIC8vPUVycm9yXG4gKiB2YWxpZGF0ZUJCb3goNSlcbiAqIC8vPUVycm9yXG4gKiB2YWxpZGF0ZUJCb3gobnVsbClcbiAqIC8vPUVycm9yXG4gKiB2YWxpZGF0ZUJCb3godW5kZWZpbmVkKVxuICogLy89RXJyb3JcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQkJveChiYm94KSB7XG4gICAgaWYgKCFiYm94KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImJib3ggaXMgcmVxdWlyZWRcIik7XG4gICAgfVxuICAgIGlmICghQXJyYXkuaXNBcnJheShiYm94KSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJiYm94IG11c3QgYmUgYW4gQXJyYXlcIik7XG4gICAgfVxuICAgIGlmIChiYm94Lmxlbmd0aCAhPT0gNCAmJiBiYm94Lmxlbmd0aCAhPT0gNikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJiYm94IG11c3QgYmUgYW4gQXJyYXkgb2YgNCBvciA2IG51bWJlcnNcIik7XG4gICAgfVxuICAgIGJib3guZm9yRWFjaChmdW5jdGlvbiAobnVtKSB7XG4gICAgICAgIGlmICghaXNOdW1iZXIobnVtKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiYmJveCBtdXN0IG9ubHkgY29udGFpbiBudW1iZXJzXCIpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG4vKipcbiAqIFZhbGlkYXRlIElkXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gaWQgSWQgdG8gdmFsaWRhdGVcbiAqIEByZXR1cm5zIHt2b2lkfVxuICogQHRocm93cyBFcnJvciBpZiBJZCBpcyBub3QgdmFsaWRcbiAqIEBleGFtcGxlXG4gKiB2YWxpZGF0ZUlkKFstMTgwLCAtNDAsIDExMCwgNTBdKVxuICogLy89RXJyb3JcbiAqIHZhbGlkYXRlSWQoWy0xODAsIC00MF0pXG4gKiAvLz1FcnJvclxuICogdmFsaWRhdGVJZCgnRm9vJylcbiAqIC8vPU9LXG4gKiB2YWxpZGF0ZUlkKDUpXG4gKiAvLz1PS1xuICogdmFsaWRhdGVJZChudWxsKVxuICogLy89RXJyb3JcbiAqIHZhbGlkYXRlSWQodW5kZWZpbmVkKVxuICogLy89RXJyb3JcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlSWQoaWQpIHtcbiAgICBpZiAoIWlkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImlkIGlzIHJlcXVpcmVkXCIpO1xuICAgIH1cbiAgICBpZiAoW1wic3RyaW5nXCIsIFwibnVtYmVyXCJdLmluZGV4T2YodHlwZW9mIGlkKSA9PT0gLTEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaWQgbXVzdCBiZSBhIG51bWJlciBvciBhIHN0cmluZ1wiKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBmZWF0dXJlLCBwb2ludCwgbGluZVN0cmluZywgaXNPYmplY3QgfSBmcm9tICdAdHVyZi9oZWxwZXJzJztcblxuLyoqXG4gKiBDYWxsYmFjayBmb3IgY29vcmRFYWNoXG4gKlxuICogQGNhbGxiYWNrIGNvb3JkRWFjaENhbGxiYWNrXG4gKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IGN1cnJlbnRDb29yZCBUaGUgY3VycmVudCBjb29yZGluYXRlIGJlaW5nIHByb2Nlc3NlZC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBjb29yZEluZGV4IFRoZSBjdXJyZW50IGluZGV4IG9mIHRoZSBjb29yZGluYXRlIGJlaW5nIHByb2Nlc3NlZC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBmZWF0dXJlSW5kZXggVGhlIGN1cnJlbnQgaW5kZXggb2YgdGhlIEZlYXR1cmUgYmVpbmcgcHJvY2Vzc2VkLlxuICogQHBhcmFtIHtudW1iZXJ9IG11bHRpRmVhdHVyZUluZGV4IFRoZSBjdXJyZW50IGluZGV4IG9mIHRoZSBNdWx0aS1GZWF0dXJlIGJlaW5nIHByb2Nlc3NlZC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBnZW9tZXRyeUluZGV4IFRoZSBjdXJyZW50IGluZGV4IG9mIHRoZSBHZW9tZXRyeSBiZWluZyBwcm9jZXNzZWQuXG4gKi9cblxuLyoqXG4gKiBJdGVyYXRlIG92ZXIgY29vcmRpbmF0ZXMgaW4gYW55IEdlb0pTT04gb2JqZWN0LCBzaW1pbGFyIHRvIEFycmF5LmZvckVhY2goKVxuICpcbiAqIEBuYW1lIGNvb3JkRWFjaFxuICogQHBhcmFtIHtGZWF0dXJlQ29sbGVjdGlvbnxGZWF0dXJlfEdlb21ldHJ5fSBnZW9qc29uIGFueSBHZW9KU09OIG9iamVjdFxuICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgYSBtZXRob2QgdGhhdCB0YWtlcyAoY3VycmVudENvb3JkLCBjb29yZEluZGV4LCBmZWF0dXJlSW5kZXgsIG11bHRpRmVhdHVyZUluZGV4KVxuICogQHBhcmFtIHtib29sZWFufSBbZXhjbHVkZVdyYXBDb29yZD1mYWxzZV0gd2hldGhlciBvciBub3QgdG8gaW5jbHVkZSB0aGUgZmluYWwgY29vcmRpbmF0ZSBvZiBMaW5lYXJSaW5ncyB0aGF0IHdyYXBzIHRoZSByaW5nIGluIGl0cyBpdGVyYXRpb24uXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqIEBleGFtcGxlXG4gKiB2YXIgZmVhdHVyZXMgPSB0dXJmLmZlYXR1cmVDb2xsZWN0aW9uKFtcbiAqICAgdHVyZi5wb2ludChbMjYsIDM3XSwge1wiZm9vXCI6IFwiYmFyXCJ9KSxcbiAqICAgdHVyZi5wb2ludChbMzYsIDUzXSwge1wiaGVsbG9cIjogXCJ3b3JsZFwifSlcbiAqIF0pO1xuICpcbiAqIHR1cmYuY29vcmRFYWNoKGZlYXR1cmVzLCBmdW5jdGlvbiAoY3VycmVudENvb3JkLCBjb29yZEluZGV4LCBmZWF0dXJlSW5kZXgsIG11bHRpRmVhdHVyZUluZGV4LCBnZW9tZXRyeUluZGV4KSB7XG4gKiAgIC8vPWN1cnJlbnRDb29yZFxuICogICAvLz1jb29yZEluZGV4XG4gKiAgIC8vPWZlYXR1cmVJbmRleFxuICogICAvLz1tdWx0aUZlYXR1cmVJbmRleFxuICogICAvLz1nZW9tZXRyeUluZGV4XG4gKiB9KTtcbiAqL1xuZnVuY3Rpb24gY29vcmRFYWNoKGdlb2pzb24sIGNhbGxiYWNrLCBleGNsdWRlV3JhcENvb3JkKSB7XG4gIC8vIEhhbmRsZXMgbnVsbCBHZW9tZXRyeSAtLSBTa2lwcyB0aGlzIEdlb0pTT05cbiAgaWYgKGdlb2pzb24gPT09IG51bGwpIHJldHVybjtcbiAgdmFyIGosXG4gICAgayxcbiAgICBsLFxuICAgIGdlb21ldHJ5LFxuICAgIHN0b3BHLFxuICAgIGNvb3JkcyxcbiAgICBnZW9tZXRyeU1heWJlQ29sbGVjdGlvbixcbiAgICB3cmFwU2hyaW5rID0gMCxcbiAgICBjb29yZEluZGV4ID0gMCxcbiAgICBpc0dlb21ldHJ5Q29sbGVjdGlvbixcbiAgICB0eXBlID0gZ2VvanNvbi50eXBlLFxuICAgIGlzRmVhdHVyZUNvbGxlY3Rpb24gPSB0eXBlID09PSBcIkZlYXR1cmVDb2xsZWN0aW9uXCIsXG4gICAgaXNGZWF0dXJlID0gdHlwZSA9PT0gXCJGZWF0dXJlXCIsXG4gICAgc3RvcCA9IGlzRmVhdHVyZUNvbGxlY3Rpb24gPyBnZW9qc29uLmZlYXR1cmVzLmxlbmd0aCA6IDE7XG5cbiAgLy8gVGhpcyBsb2dpYyBtYXkgbG9vayBhIGxpdHRsZSB3ZWlyZC4gVGhlIHJlYXNvbiB3aHkgaXQgaXMgdGhhdCB3YXlcbiAgLy8gaXMgYmVjYXVzZSBpdCdzIHRyeWluZyB0byBiZSBmYXN0LiBHZW9KU09OIHN1cHBvcnRzIG11bHRpcGxlIGtpbmRzXG4gIC8vIG9mIG9iamVjdHMgYXQgaXRzIHJvb3Q6IEZlYXR1cmVDb2xsZWN0aW9uLCBGZWF0dXJlcywgR2VvbWV0cmllcy5cbiAgLy8gVGhpcyBmdW5jdGlvbiBoYXMgdGhlIHJlc3BvbnNpYmlsaXR5IG9mIGhhbmRsaW5nIGFsbCBvZiB0aGVtLCBhbmQgdGhhdFxuICAvLyBtZWFucyB0aGF0IHNvbWUgb2YgdGhlIGBmb3JgIGxvb3BzIHlvdSBzZWUgYmVsb3cgYWN0dWFsbHkganVzdCBkb24ndCBhcHBseVxuICAvLyB0byBjZXJ0YWluIGlucHV0cy4gRm9yIGluc3RhbmNlLCBpZiB5b3UgZ2l2ZSB0aGlzIGp1c3QgYVxuICAvLyBQb2ludCBnZW9tZXRyeSwgdGhlbiBib3RoIGxvb3BzIGFyZSBzaG9ydC1jaXJjdWl0ZWQgYW5kIGFsbCB3ZSBkb1xuICAvLyBpcyBncmFkdWFsbHkgcmVuYW1lIHRoZSBpbnB1dCB1bnRpbCBpdCdzIGNhbGxlZCAnZ2VvbWV0cnknLlxuICAvL1xuICAvLyBUaGlzIGFsc28gYWltcyB0byBhbGxvY2F0ZSBhcyBmZXcgcmVzb3VyY2VzIGFzIHBvc3NpYmxlOiBqdXN0IGFcbiAgLy8gZmV3IG51bWJlcnMgYW5kIGJvb2xlYW5zLCByYXRoZXIgdGhhbiBhbnkgdGVtcG9yYXJ5IGFycmF5cyBhcyB3b3VsZFxuICAvLyBiZSByZXF1aXJlZCB3aXRoIHRoZSBub3JtYWxpemF0aW9uIGFwcHJvYWNoLlxuICBmb3IgKHZhciBmZWF0dXJlSW5kZXggPSAwOyBmZWF0dXJlSW5kZXggPCBzdG9wOyBmZWF0dXJlSW5kZXgrKykge1xuICAgIGdlb21ldHJ5TWF5YmVDb2xsZWN0aW9uID0gaXNGZWF0dXJlQ29sbGVjdGlvblxuICAgICAgPyBnZW9qc29uLmZlYXR1cmVzW2ZlYXR1cmVJbmRleF0uZ2VvbWV0cnlcbiAgICAgIDogaXNGZWF0dXJlXG4gICAgICA/IGdlb2pzb24uZ2VvbWV0cnlcbiAgICAgIDogZ2VvanNvbjtcbiAgICBpc0dlb21ldHJ5Q29sbGVjdGlvbiA9IGdlb21ldHJ5TWF5YmVDb2xsZWN0aW9uXG4gICAgICA/IGdlb21ldHJ5TWF5YmVDb2xsZWN0aW9uLnR5cGUgPT09IFwiR2VvbWV0cnlDb2xsZWN0aW9uXCJcbiAgICAgIDogZmFsc2U7XG4gICAgc3RvcEcgPSBpc0dlb21ldHJ5Q29sbGVjdGlvblxuICAgICAgPyBnZW9tZXRyeU1heWJlQ29sbGVjdGlvbi5nZW9tZXRyaWVzLmxlbmd0aFxuICAgICAgOiAxO1xuXG4gICAgZm9yICh2YXIgZ2VvbUluZGV4ID0gMDsgZ2VvbUluZGV4IDwgc3RvcEc7IGdlb21JbmRleCsrKSB7XG4gICAgICB2YXIgbXVsdGlGZWF0dXJlSW5kZXggPSAwO1xuICAgICAgdmFyIGdlb21ldHJ5SW5kZXggPSAwO1xuICAgICAgZ2VvbWV0cnkgPSBpc0dlb21ldHJ5Q29sbGVjdGlvblxuICAgICAgICA/IGdlb21ldHJ5TWF5YmVDb2xsZWN0aW9uLmdlb21ldHJpZXNbZ2VvbUluZGV4XVxuICAgICAgICA6IGdlb21ldHJ5TWF5YmVDb2xsZWN0aW9uO1xuXG4gICAgICAvLyBIYW5kbGVzIG51bGwgR2VvbWV0cnkgLS0gU2tpcHMgdGhpcyBnZW9tZXRyeVxuICAgICAgaWYgKGdlb21ldHJ5ID09PSBudWxsKSBjb250aW51ZTtcbiAgICAgIGNvb3JkcyA9IGdlb21ldHJ5LmNvb3JkaW5hdGVzO1xuICAgICAgdmFyIGdlb21UeXBlID0gZ2VvbWV0cnkudHlwZTtcblxuICAgICAgd3JhcFNocmluayA9XG4gICAgICAgIGV4Y2x1ZGVXcmFwQ29vcmQgJiZcbiAgICAgICAgKGdlb21UeXBlID09PSBcIlBvbHlnb25cIiB8fCBnZW9tVHlwZSA9PT0gXCJNdWx0aVBvbHlnb25cIilcbiAgICAgICAgICA/IDFcbiAgICAgICAgICA6IDA7XG5cbiAgICAgIHN3aXRjaCAoZ2VvbVR5cGUpIHtcbiAgICAgICAgY2FzZSBudWxsOlxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiUG9pbnRcIjpcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBjYWxsYmFjayhcbiAgICAgICAgICAgICAgY29vcmRzLFxuICAgICAgICAgICAgICBjb29yZEluZGV4LFxuICAgICAgICAgICAgICBmZWF0dXJlSW5kZXgsXG4gICAgICAgICAgICAgIG11bHRpRmVhdHVyZUluZGV4LFxuICAgICAgICAgICAgICBnZW9tZXRyeUluZGV4XG4gICAgICAgICAgICApID09PSBmYWxzZVxuICAgICAgICAgIClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICBjb29yZEluZGV4Kys7XG4gICAgICAgICAgbXVsdGlGZWF0dXJlSW5kZXgrKztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIkxpbmVTdHJpbmdcIjpcbiAgICAgICAgY2FzZSBcIk11bHRpUG9pbnRcIjpcbiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgY29vcmRzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIGNhbGxiYWNrKFxuICAgICAgICAgICAgICAgIGNvb3Jkc1tqXSxcbiAgICAgICAgICAgICAgICBjb29yZEluZGV4LFxuICAgICAgICAgICAgICAgIGZlYXR1cmVJbmRleCxcbiAgICAgICAgICAgICAgICBtdWx0aUZlYXR1cmVJbmRleCxcbiAgICAgICAgICAgICAgICBnZW9tZXRyeUluZGV4XG4gICAgICAgICAgICAgICkgPT09IGZhbHNlXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIGNvb3JkSW5kZXgrKztcbiAgICAgICAgICAgIGlmIChnZW9tVHlwZSA9PT0gXCJNdWx0aVBvaW50XCIpIG11bHRpRmVhdHVyZUluZGV4Kys7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChnZW9tVHlwZSA9PT0gXCJMaW5lU3RyaW5nXCIpIG11bHRpRmVhdHVyZUluZGV4Kys7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJQb2x5Z29uXCI6XG4gICAgICAgIGNhc2UgXCJNdWx0aUxpbmVTdHJpbmdcIjpcbiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgY29vcmRzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgY29vcmRzW2pdLmxlbmd0aCAtIHdyYXBTaHJpbms7IGsrKykge1xuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soXG4gICAgICAgICAgICAgICAgICBjb29yZHNbal1ba10sXG4gICAgICAgICAgICAgICAgICBjb29yZEluZGV4LFxuICAgICAgICAgICAgICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgICAgICAgICAgICAgbXVsdGlGZWF0dXJlSW5kZXgsXG4gICAgICAgICAgICAgICAgICBnZW9tZXRyeUluZGV4XG4gICAgICAgICAgICAgICAgKSA9PT0gZmFsc2VcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgY29vcmRJbmRleCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdlb21UeXBlID09PSBcIk11bHRpTGluZVN0cmluZ1wiKSBtdWx0aUZlYXR1cmVJbmRleCsrO1xuICAgICAgICAgICAgaWYgKGdlb21UeXBlID09PSBcIlBvbHlnb25cIikgZ2VvbWV0cnlJbmRleCsrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZ2VvbVR5cGUgPT09IFwiUG9seWdvblwiKSBtdWx0aUZlYXR1cmVJbmRleCsrO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiTXVsdGlQb2x5Z29uXCI6XG4gICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNvb3Jkcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgZ2VvbWV0cnlJbmRleCA9IDA7XG4gICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgY29vcmRzW2pdLmxlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICAgIGZvciAobCA9IDA7IGwgPCBjb29yZHNbal1ba10ubGVuZ3RoIC0gd3JhcFNocmluazsgbCsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgY2FsbGJhY2soXG4gICAgICAgICAgICAgICAgICAgIGNvb3Jkc1tqXVtrXVtsXSxcbiAgICAgICAgICAgICAgICAgICAgY29vcmRJbmRleCxcbiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgICAgICAgICAgICAgICBtdWx0aUZlYXR1cmVJbmRleCxcbiAgICAgICAgICAgICAgICAgICAgZ2VvbWV0cnlJbmRleFxuICAgICAgICAgICAgICAgICAgKSA9PT0gZmFsc2VcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgY29vcmRJbmRleCsrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGdlb21ldHJ5SW5kZXgrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG11bHRpRmVhdHVyZUluZGV4Kys7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiR2VvbWV0cnlDb2xsZWN0aW9uXCI6XG4gICAgICAgICAgZm9yIChqID0gMDsgaiA8IGdlb21ldHJ5Lmdlb21ldHJpZXMubGVuZ3RoOyBqKyspXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIGNvb3JkRWFjaChnZW9tZXRyeS5nZW9tZXRyaWVzW2pdLCBjYWxsYmFjaywgZXhjbHVkZVdyYXBDb29yZCkgPT09XG4gICAgICAgICAgICAgIGZhbHNlXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIEdlb21ldHJ5IFR5cGVcIik7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogQ2FsbGJhY2sgZm9yIGNvb3JkUmVkdWNlXG4gKlxuICogVGhlIGZpcnN0IHRpbWUgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIGlzIGNhbGxlZCwgdGhlIHZhbHVlcyBwcm92aWRlZCBhcyBhcmd1bWVudHMgZGVwZW5kXG4gKiBvbiB3aGV0aGVyIHRoZSByZWR1Y2UgbWV0aG9kIGhhcyBhbiBpbml0aWFsVmFsdWUgYXJndW1lbnQuXG4gKlxuICogSWYgYW4gaW5pdGlhbFZhbHVlIGlzIHByb3ZpZGVkIHRvIHRoZSByZWR1Y2UgbWV0aG9kOlxuICogIC0gVGhlIHByZXZpb3VzVmFsdWUgYXJndW1lbnQgaXMgaW5pdGlhbFZhbHVlLlxuICogIC0gVGhlIGN1cnJlbnRWYWx1ZSBhcmd1bWVudCBpcyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IGVsZW1lbnQgcHJlc2VudCBpbiB0aGUgYXJyYXkuXG4gKlxuICogSWYgYW4gaW5pdGlhbFZhbHVlIGlzIG5vdCBwcm92aWRlZDpcbiAqICAtIFRoZSBwcmV2aW91c1ZhbHVlIGFyZ3VtZW50IGlzIHRoZSB2YWx1ZSBvZiB0aGUgZmlyc3QgZWxlbWVudCBwcmVzZW50IGluIHRoZSBhcnJheS5cbiAqICAtIFRoZSBjdXJyZW50VmFsdWUgYXJndW1lbnQgaXMgdGhlIHZhbHVlIG9mIHRoZSBzZWNvbmQgZWxlbWVudCBwcmVzZW50IGluIHRoZSBhcnJheS5cbiAqXG4gKiBAY2FsbGJhY2sgY29vcmRSZWR1Y2VDYWxsYmFja1xuICogQHBhcmFtIHsqfSBwcmV2aW91c1ZhbHVlIFRoZSBhY2N1bXVsYXRlZCB2YWx1ZSBwcmV2aW91c2x5IHJldHVybmVkIGluIHRoZSBsYXN0IGludm9jYXRpb25cbiAqIG9mIHRoZSBjYWxsYmFjaywgb3IgaW5pdGlhbFZhbHVlLCBpZiBzdXBwbGllZC5cbiAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gY3VycmVudENvb3JkIFRoZSBjdXJyZW50IGNvb3JkaW5hdGUgYmVpbmcgcHJvY2Vzc2VkLlxuICogQHBhcmFtIHtudW1iZXJ9IGNvb3JkSW5kZXggVGhlIGN1cnJlbnQgaW5kZXggb2YgdGhlIGNvb3JkaW5hdGUgYmVpbmcgcHJvY2Vzc2VkLlxuICogU3RhcnRzIGF0IGluZGV4IDAsIGlmIGFuIGluaXRpYWxWYWx1ZSBpcyBwcm92aWRlZCwgYW5kIGF0IGluZGV4IDEgb3RoZXJ3aXNlLlxuICogQHBhcmFtIHtudW1iZXJ9IGZlYXR1cmVJbmRleCBUaGUgY3VycmVudCBpbmRleCBvZiB0aGUgRmVhdHVyZSBiZWluZyBwcm9jZXNzZWQuXG4gKiBAcGFyYW0ge251bWJlcn0gbXVsdGlGZWF0dXJlSW5kZXggVGhlIGN1cnJlbnQgaW5kZXggb2YgdGhlIE11bHRpLUZlYXR1cmUgYmVpbmcgcHJvY2Vzc2VkLlxuICogQHBhcmFtIHtudW1iZXJ9IGdlb21ldHJ5SW5kZXggVGhlIGN1cnJlbnQgaW5kZXggb2YgdGhlIEdlb21ldHJ5IGJlaW5nIHByb2Nlc3NlZC5cbiAqL1xuXG4vKipcbiAqIFJlZHVjZSBjb29yZGluYXRlcyBpbiBhbnkgR2VvSlNPTiBvYmplY3QsIHNpbWlsYXIgdG8gQXJyYXkucmVkdWNlKClcbiAqXG4gKiBAbmFtZSBjb29yZFJlZHVjZVxuICogQHBhcmFtIHtGZWF0dXJlQ29sbGVjdGlvbnxHZW9tZXRyeXxGZWF0dXJlfSBnZW9qc29uIGFueSBHZW9KU09OIG9iamVjdFxuICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgYSBtZXRob2QgdGhhdCB0YWtlcyAocHJldmlvdXNWYWx1ZSwgY3VycmVudENvb3JkLCBjb29yZEluZGV4KVxuICogQHBhcmFtIHsqfSBbaW5pdGlhbFZhbHVlXSBWYWx1ZSB0byB1c2UgYXMgdGhlIGZpcnN0IGFyZ3VtZW50IHRvIHRoZSBmaXJzdCBjYWxsIG9mIHRoZSBjYWxsYmFjay5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gW2V4Y2x1ZGVXcmFwQ29vcmQ9ZmFsc2VdIHdoZXRoZXIgb3Igbm90IHRvIGluY2x1ZGUgdGhlIGZpbmFsIGNvb3JkaW5hdGUgb2YgTGluZWFyUmluZ3MgdGhhdCB3cmFwcyB0aGUgcmluZyBpbiBpdHMgaXRlcmF0aW9uLlxuICogQHJldHVybnMgeyp9IFRoZSB2YWx1ZSB0aGF0IHJlc3VsdHMgZnJvbSB0aGUgcmVkdWN0aW9uLlxuICogQGV4YW1wbGVcbiAqIHZhciBmZWF0dXJlcyA9IHR1cmYuZmVhdHVyZUNvbGxlY3Rpb24oW1xuICogICB0dXJmLnBvaW50KFsyNiwgMzddLCB7XCJmb29cIjogXCJiYXJcIn0pLFxuICogICB0dXJmLnBvaW50KFszNiwgNTNdLCB7XCJoZWxsb1wiOiBcIndvcmxkXCJ9KVxuICogXSk7XG4gKlxuICogdHVyZi5jb29yZFJlZHVjZShmZWF0dXJlcywgZnVuY3Rpb24gKHByZXZpb3VzVmFsdWUsIGN1cnJlbnRDb29yZCwgY29vcmRJbmRleCwgZmVhdHVyZUluZGV4LCBtdWx0aUZlYXR1cmVJbmRleCwgZ2VvbWV0cnlJbmRleCkge1xuICogICAvLz1wcmV2aW91c1ZhbHVlXG4gKiAgIC8vPWN1cnJlbnRDb29yZFxuICogICAvLz1jb29yZEluZGV4XG4gKiAgIC8vPWZlYXR1cmVJbmRleFxuICogICAvLz1tdWx0aUZlYXR1cmVJbmRleFxuICogICAvLz1nZW9tZXRyeUluZGV4XG4gKiAgIHJldHVybiBjdXJyZW50Q29vcmQ7XG4gKiB9KTtcbiAqL1xuZnVuY3Rpb24gY29vcmRSZWR1Y2UoZ2VvanNvbiwgY2FsbGJhY2ssIGluaXRpYWxWYWx1ZSwgZXhjbHVkZVdyYXBDb29yZCkge1xuICB2YXIgcHJldmlvdXNWYWx1ZSA9IGluaXRpYWxWYWx1ZTtcbiAgY29vcmRFYWNoKFxuICAgIGdlb2pzb24sXG4gICAgZnVuY3Rpb24gKFxuICAgICAgY3VycmVudENvb3JkLFxuICAgICAgY29vcmRJbmRleCxcbiAgICAgIGZlYXR1cmVJbmRleCxcbiAgICAgIG11bHRpRmVhdHVyZUluZGV4LFxuICAgICAgZ2VvbWV0cnlJbmRleFxuICAgICkge1xuICAgICAgaWYgKGNvb3JkSW5kZXggPT09IDAgJiYgaW5pdGlhbFZhbHVlID09PSB1bmRlZmluZWQpXG4gICAgICAgIHByZXZpb3VzVmFsdWUgPSBjdXJyZW50Q29vcmQ7XG4gICAgICBlbHNlXG4gICAgICAgIHByZXZpb3VzVmFsdWUgPSBjYWxsYmFjayhcbiAgICAgICAgICBwcmV2aW91c1ZhbHVlLFxuICAgICAgICAgIGN1cnJlbnRDb29yZCxcbiAgICAgICAgICBjb29yZEluZGV4LFxuICAgICAgICAgIGZlYXR1cmVJbmRleCxcbiAgICAgICAgICBtdWx0aUZlYXR1cmVJbmRleCxcbiAgICAgICAgICBnZW9tZXRyeUluZGV4XG4gICAgICAgICk7XG4gICAgfSxcbiAgICBleGNsdWRlV3JhcENvb3JkXG4gICk7XG4gIHJldHVybiBwcmV2aW91c1ZhbHVlO1xufVxuXG4vKipcbiAqIENhbGxiYWNrIGZvciBwcm9wRWFjaFxuICpcbiAqIEBjYWxsYmFjayBwcm9wRWFjaENhbGxiYWNrXG4gKiBAcGFyYW0ge09iamVjdH0gY3VycmVudFByb3BlcnRpZXMgVGhlIGN1cnJlbnQgUHJvcGVydGllcyBiZWluZyBwcm9jZXNzZWQuXG4gKiBAcGFyYW0ge251bWJlcn0gZmVhdHVyZUluZGV4IFRoZSBjdXJyZW50IGluZGV4IG9mIHRoZSBGZWF0dXJlIGJlaW5nIHByb2Nlc3NlZC5cbiAqL1xuXG4vKipcbiAqIEl0ZXJhdGUgb3ZlciBwcm9wZXJ0aWVzIGluIGFueSBHZW9KU09OIG9iamVjdCwgc2ltaWxhciB0byBBcnJheS5mb3JFYWNoKClcbiAqXG4gKiBAbmFtZSBwcm9wRWFjaFxuICogQHBhcmFtIHtGZWF0dXJlQ29sbGVjdGlvbnxGZWF0dXJlfSBnZW9qc29uIGFueSBHZW9KU09OIG9iamVjdFxuICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgYSBtZXRob2QgdGhhdCB0YWtlcyAoY3VycmVudFByb3BlcnRpZXMsIGZlYXR1cmVJbmRleClcbiAqIEByZXR1cm5zIHt2b2lkfVxuICogQGV4YW1wbGVcbiAqIHZhciBmZWF0dXJlcyA9IHR1cmYuZmVhdHVyZUNvbGxlY3Rpb24oW1xuICogICAgIHR1cmYucG9pbnQoWzI2LCAzN10sIHtmb286ICdiYXInfSksXG4gKiAgICAgdHVyZi5wb2ludChbMzYsIDUzXSwge2hlbGxvOiAnd29ybGQnfSlcbiAqIF0pO1xuICpcbiAqIHR1cmYucHJvcEVhY2goZmVhdHVyZXMsIGZ1bmN0aW9uIChjdXJyZW50UHJvcGVydGllcywgZmVhdHVyZUluZGV4KSB7XG4gKiAgIC8vPWN1cnJlbnRQcm9wZXJ0aWVzXG4gKiAgIC8vPWZlYXR1cmVJbmRleFxuICogfSk7XG4gKi9cbmZ1bmN0aW9uIHByb3BFYWNoKGdlb2pzb24sIGNhbGxiYWNrKSB7XG4gIHZhciBpO1xuICBzd2l0Y2ggKGdlb2pzb24udHlwZSkge1xuICAgIGNhc2UgXCJGZWF0dXJlQ29sbGVjdGlvblwiOlxuICAgICAgZm9yIChpID0gMDsgaSA8IGdlb2pzb24uZmVhdHVyZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGNhbGxiYWNrKGdlb2pzb24uZmVhdHVyZXNbaV0ucHJvcGVydGllcywgaSkgPT09IGZhbHNlKSBicmVhaztcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgXCJGZWF0dXJlXCI6XG4gICAgICBjYWxsYmFjayhnZW9qc29uLnByb3BlcnRpZXMsIDApO1xuICAgICAgYnJlYWs7XG4gIH1cbn1cblxuLyoqXG4gKiBDYWxsYmFjayBmb3IgcHJvcFJlZHVjZVxuICpcbiAqIFRoZSBmaXJzdCB0aW1lIHRoZSBjYWxsYmFjayBmdW5jdGlvbiBpcyBjYWxsZWQsIHRoZSB2YWx1ZXMgcHJvdmlkZWQgYXMgYXJndW1lbnRzIGRlcGVuZFxuICogb24gd2hldGhlciB0aGUgcmVkdWNlIG1ldGhvZCBoYXMgYW4gaW5pdGlhbFZhbHVlIGFyZ3VtZW50LlxuICpcbiAqIElmIGFuIGluaXRpYWxWYWx1ZSBpcyBwcm92aWRlZCB0byB0aGUgcmVkdWNlIG1ldGhvZDpcbiAqICAtIFRoZSBwcmV2aW91c1ZhbHVlIGFyZ3VtZW50IGlzIGluaXRpYWxWYWx1ZS5cbiAqICAtIFRoZSBjdXJyZW50VmFsdWUgYXJndW1lbnQgaXMgdGhlIHZhbHVlIG9mIHRoZSBmaXJzdCBlbGVtZW50IHByZXNlbnQgaW4gdGhlIGFycmF5LlxuICpcbiAqIElmIGFuIGluaXRpYWxWYWx1ZSBpcyBub3QgcHJvdmlkZWQ6XG4gKiAgLSBUaGUgcHJldmlvdXNWYWx1ZSBhcmd1bWVudCBpcyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IGVsZW1lbnQgcHJlc2VudCBpbiB0aGUgYXJyYXkuXG4gKiAgLSBUaGUgY3VycmVudFZhbHVlIGFyZ3VtZW50IGlzIHRoZSB2YWx1ZSBvZiB0aGUgc2Vjb25kIGVsZW1lbnQgcHJlc2VudCBpbiB0aGUgYXJyYXkuXG4gKlxuICogQGNhbGxiYWNrIHByb3BSZWR1Y2VDYWxsYmFja1xuICogQHBhcmFtIHsqfSBwcmV2aW91c1ZhbHVlIFRoZSBhY2N1bXVsYXRlZCB2YWx1ZSBwcmV2aW91c2x5IHJldHVybmVkIGluIHRoZSBsYXN0IGludm9jYXRpb25cbiAqIG9mIHRoZSBjYWxsYmFjaywgb3IgaW5pdGlhbFZhbHVlLCBpZiBzdXBwbGllZC5cbiAqIEBwYXJhbSB7Kn0gY3VycmVudFByb3BlcnRpZXMgVGhlIGN1cnJlbnQgUHJvcGVydGllcyBiZWluZyBwcm9jZXNzZWQuXG4gKiBAcGFyYW0ge251bWJlcn0gZmVhdHVyZUluZGV4IFRoZSBjdXJyZW50IGluZGV4IG9mIHRoZSBGZWF0dXJlIGJlaW5nIHByb2Nlc3NlZC5cbiAqL1xuXG4vKipcbiAqIFJlZHVjZSBwcm9wZXJ0aWVzIGluIGFueSBHZW9KU09OIG9iamVjdCBpbnRvIGEgc2luZ2xlIHZhbHVlLFxuICogc2ltaWxhciB0byBob3cgQXJyYXkucmVkdWNlIHdvcmtzLiBIb3dldmVyLCBpbiB0aGlzIGNhc2Ugd2UgbGF6aWx5IHJ1blxuICogdGhlIHJlZHVjdGlvbiwgc28gYW4gYXJyYXkgb2YgYWxsIHByb3BlcnRpZXMgaXMgdW5uZWNlc3NhcnkuXG4gKlxuICogQG5hbWUgcHJvcFJlZHVjZVxuICogQHBhcmFtIHtGZWF0dXJlQ29sbGVjdGlvbnxGZWF0dXJlfSBnZW9qc29uIGFueSBHZW9KU09OIG9iamVjdFxuICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgYSBtZXRob2QgdGhhdCB0YWtlcyAocHJldmlvdXNWYWx1ZSwgY3VycmVudFByb3BlcnRpZXMsIGZlYXR1cmVJbmRleClcbiAqIEBwYXJhbSB7Kn0gW2luaXRpYWxWYWx1ZV0gVmFsdWUgdG8gdXNlIGFzIHRoZSBmaXJzdCBhcmd1bWVudCB0byB0aGUgZmlyc3QgY2FsbCBvZiB0aGUgY2FsbGJhY2suXG4gKiBAcmV0dXJucyB7Kn0gVGhlIHZhbHVlIHRoYXQgcmVzdWx0cyBmcm9tIHRoZSByZWR1Y3Rpb24uXG4gKiBAZXhhbXBsZVxuICogdmFyIGZlYXR1cmVzID0gdHVyZi5mZWF0dXJlQ29sbGVjdGlvbihbXG4gKiAgICAgdHVyZi5wb2ludChbMjYsIDM3XSwge2ZvbzogJ2Jhcid9KSxcbiAqICAgICB0dXJmLnBvaW50KFszNiwgNTNdLCB7aGVsbG86ICd3b3JsZCd9KVxuICogXSk7XG4gKlxuICogdHVyZi5wcm9wUmVkdWNlKGZlYXR1cmVzLCBmdW5jdGlvbiAocHJldmlvdXNWYWx1ZSwgY3VycmVudFByb3BlcnRpZXMsIGZlYXR1cmVJbmRleCkge1xuICogICAvLz1wcmV2aW91c1ZhbHVlXG4gKiAgIC8vPWN1cnJlbnRQcm9wZXJ0aWVzXG4gKiAgIC8vPWZlYXR1cmVJbmRleFxuICogICByZXR1cm4gY3VycmVudFByb3BlcnRpZXNcbiAqIH0pO1xuICovXG5mdW5jdGlvbiBwcm9wUmVkdWNlKGdlb2pzb24sIGNhbGxiYWNrLCBpbml0aWFsVmFsdWUpIHtcbiAgdmFyIHByZXZpb3VzVmFsdWUgPSBpbml0aWFsVmFsdWU7XG4gIHByb3BFYWNoKGdlb2pzb24sIGZ1bmN0aW9uIChjdXJyZW50UHJvcGVydGllcywgZmVhdHVyZUluZGV4KSB7XG4gICAgaWYgKGZlYXR1cmVJbmRleCA9PT0gMCAmJiBpbml0aWFsVmFsdWUgPT09IHVuZGVmaW5lZClcbiAgICAgIHByZXZpb3VzVmFsdWUgPSBjdXJyZW50UHJvcGVydGllcztcbiAgICBlbHNlXG4gICAgICBwcmV2aW91c1ZhbHVlID0gY2FsbGJhY2socHJldmlvdXNWYWx1ZSwgY3VycmVudFByb3BlcnRpZXMsIGZlYXR1cmVJbmRleCk7XG4gIH0pO1xuICByZXR1cm4gcHJldmlvdXNWYWx1ZTtcbn1cblxuLyoqXG4gKiBDYWxsYmFjayBmb3IgZmVhdHVyZUVhY2hcbiAqXG4gKiBAY2FsbGJhY2sgZmVhdHVyZUVhY2hDYWxsYmFja1xuICogQHBhcmFtIHtGZWF0dXJlPGFueT59IGN1cnJlbnRGZWF0dXJlIFRoZSBjdXJyZW50IEZlYXR1cmUgYmVpbmcgcHJvY2Vzc2VkLlxuICogQHBhcmFtIHtudW1iZXJ9IGZlYXR1cmVJbmRleCBUaGUgY3VycmVudCBpbmRleCBvZiB0aGUgRmVhdHVyZSBiZWluZyBwcm9jZXNzZWQuXG4gKi9cblxuLyoqXG4gKiBJdGVyYXRlIG92ZXIgZmVhdHVyZXMgaW4gYW55IEdlb0pTT04gb2JqZWN0LCBzaW1pbGFyIHRvXG4gKiBBcnJheS5mb3JFYWNoLlxuICpcbiAqIEBuYW1lIGZlYXR1cmVFYWNoXG4gKiBAcGFyYW0ge0ZlYXR1cmVDb2xsZWN0aW9ufEZlYXR1cmV8R2VvbWV0cnl9IGdlb2pzb24gYW55IEdlb0pTT04gb2JqZWN0XG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBhIG1ldGhvZCB0aGF0IHRha2VzIChjdXJyZW50RmVhdHVyZSwgZmVhdHVyZUluZGV4KVxuICogQHJldHVybnMge3ZvaWR9XG4gKiBAZXhhbXBsZVxuICogdmFyIGZlYXR1cmVzID0gdHVyZi5mZWF0dXJlQ29sbGVjdGlvbihbXG4gKiAgIHR1cmYucG9pbnQoWzI2LCAzN10sIHtmb286ICdiYXInfSksXG4gKiAgIHR1cmYucG9pbnQoWzM2LCA1M10sIHtoZWxsbzogJ3dvcmxkJ30pXG4gKiBdKTtcbiAqXG4gKiB0dXJmLmZlYXR1cmVFYWNoKGZlYXR1cmVzLCBmdW5jdGlvbiAoY3VycmVudEZlYXR1cmUsIGZlYXR1cmVJbmRleCkge1xuICogICAvLz1jdXJyZW50RmVhdHVyZVxuICogICAvLz1mZWF0dXJlSW5kZXhcbiAqIH0pO1xuICovXG5mdW5jdGlvbiBmZWF0dXJlRWFjaChnZW9qc29uLCBjYWxsYmFjaykge1xuICBpZiAoZ2VvanNvbi50eXBlID09PSBcIkZlYXR1cmVcIikge1xuICAgIGNhbGxiYWNrKGdlb2pzb24sIDApO1xuICB9IGVsc2UgaWYgKGdlb2pzb24udHlwZSA9PT0gXCJGZWF0dXJlQ29sbGVjdGlvblwiKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBnZW9qc29uLmZlYXR1cmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoY2FsbGJhY2soZ2VvanNvbi5mZWF0dXJlc1tpXSwgaSkgPT09IGZhbHNlKSBicmVhaztcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBDYWxsYmFjayBmb3IgZmVhdHVyZVJlZHVjZVxuICpcbiAqIFRoZSBmaXJzdCB0aW1lIHRoZSBjYWxsYmFjayBmdW5jdGlvbiBpcyBjYWxsZWQsIHRoZSB2YWx1ZXMgcHJvdmlkZWQgYXMgYXJndW1lbnRzIGRlcGVuZFxuICogb24gd2hldGhlciB0aGUgcmVkdWNlIG1ldGhvZCBoYXMgYW4gaW5pdGlhbFZhbHVlIGFyZ3VtZW50LlxuICpcbiAqIElmIGFuIGluaXRpYWxWYWx1ZSBpcyBwcm92aWRlZCB0byB0aGUgcmVkdWNlIG1ldGhvZDpcbiAqICAtIFRoZSBwcmV2aW91c1ZhbHVlIGFyZ3VtZW50IGlzIGluaXRpYWxWYWx1ZS5cbiAqICAtIFRoZSBjdXJyZW50VmFsdWUgYXJndW1lbnQgaXMgdGhlIHZhbHVlIG9mIHRoZSBmaXJzdCBlbGVtZW50IHByZXNlbnQgaW4gdGhlIGFycmF5LlxuICpcbiAqIElmIGFuIGluaXRpYWxWYWx1ZSBpcyBub3QgcHJvdmlkZWQ6XG4gKiAgLSBUaGUgcHJldmlvdXNWYWx1ZSBhcmd1bWVudCBpcyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IGVsZW1lbnQgcHJlc2VudCBpbiB0aGUgYXJyYXkuXG4gKiAgLSBUaGUgY3VycmVudFZhbHVlIGFyZ3VtZW50IGlzIHRoZSB2YWx1ZSBvZiB0aGUgc2Vjb25kIGVsZW1lbnQgcHJlc2VudCBpbiB0aGUgYXJyYXkuXG4gKlxuICogQGNhbGxiYWNrIGZlYXR1cmVSZWR1Y2VDYWxsYmFja1xuICogQHBhcmFtIHsqfSBwcmV2aW91c1ZhbHVlIFRoZSBhY2N1bXVsYXRlZCB2YWx1ZSBwcmV2aW91c2x5IHJldHVybmVkIGluIHRoZSBsYXN0IGludm9jYXRpb25cbiAqIG9mIHRoZSBjYWxsYmFjaywgb3IgaW5pdGlhbFZhbHVlLCBpZiBzdXBwbGllZC5cbiAqIEBwYXJhbSB7RmVhdHVyZX0gY3VycmVudEZlYXR1cmUgVGhlIGN1cnJlbnQgRmVhdHVyZSBiZWluZyBwcm9jZXNzZWQuXG4gKiBAcGFyYW0ge251bWJlcn0gZmVhdHVyZUluZGV4IFRoZSBjdXJyZW50IGluZGV4IG9mIHRoZSBGZWF0dXJlIGJlaW5nIHByb2Nlc3NlZC5cbiAqL1xuXG4vKipcbiAqIFJlZHVjZSBmZWF0dXJlcyBpbiBhbnkgR2VvSlNPTiBvYmplY3QsIHNpbWlsYXIgdG8gQXJyYXkucmVkdWNlKCkuXG4gKlxuICogQG5hbWUgZmVhdHVyZVJlZHVjZVxuICogQHBhcmFtIHtGZWF0dXJlQ29sbGVjdGlvbnxGZWF0dXJlfEdlb21ldHJ5fSBnZW9qc29uIGFueSBHZW9KU09OIG9iamVjdFxuICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgYSBtZXRob2QgdGhhdCB0YWtlcyAocHJldmlvdXNWYWx1ZSwgY3VycmVudEZlYXR1cmUsIGZlYXR1cmVJbmRleClcbiAqIEBwYXJhbSB7Kn0gW2luaXRpYWxWYWx1ZV0gVmFsdWUgdG8gdXNlIGFzIHRoZSBmaXJzdCBhcmd1bWVudCB0byB0aGUgZmlyc3QgY2FsbCBvZiB0aGUgY2FsbGJhY2suXG4gKiBAcmV0dXJucyB7Kn0gVGhlIHZhbHVlIHRoYXQgcmVzdWx0cyBmcm9tIHRoZSByZWR1Y3Rpb24uXG4gKiBAZXhhbXBsZVxuICogdmFyIGZlYXR1cmVzID0gdHVyZi5mZWF0dXJlQ29sbGVjdGlvbihbXG4gKiAgIHR1cmYucG9pbnQoWzI2LCAzN10sIHtcImZvb1wiOiBcImJhclwifSksXG4gKiAgIHR1cmYucG9pbnQoWzM2LCA1M10sIHtcImhlbGxvXCI6IFwid29ybGRcIn0pXG4gKiBdKTtcbiAqXG4gKiB0dXJmLmZlYXR1cmVSZWR1Y2UoZmVhdHVyZXMsIGZ1bmN0aW9uIChwcmV2aW91c1ZhbHVlLCBjdXJyZW50RmVhdHVyZSwgZmVhdHVyZUluZGV4KSB7XG4gKiAgIC8vPXByZXZpb3VzVmFsdWVcbiAqICAgLy89Y3VycmVudEZlYXR1cmVcbiAqICAgLy89ZmVhdHVyZUluZGV4XG4gKiAgIHJldHVybiBjdXJyZW50RmVhdHVyZVxuICogfSk7XG4gKi9cbmZ1bmN0aW9uIGZlYXR1cmVSZWR1Y2UoZ2VvanNvbiwgY2FsbGJhY2ssIGluaXRpYWxWYWx1ZSkge1xuICB2YXIgcHJldmlvdXNWYWx1ZSA9IGluaXRpYWxWYWx1ZTtcbiAgZmVhdHVyZUVhY2goZ2VvanNvbiwgZnVuY3Rpb24gKGN1cnJlbnRGZWF0dXJlLCBmZWF0dXJlSW5kZXgpIHtcbiAgICBpZiAoZmVhdHVyZUluZGV4ID09PSAwICYmIGluaXRpYWxWYWx1ZSA9PT0gdW5kZWZpbmVkKVxuICAgICAgcHJldmlvdXNWYWx1ZSA9IGN1cnJlbnRGZWF0dXJlO1xuICAgIGVsc2UgcHJldmlvdXNWYWx1ZSA9IGNhbGxiYWNrKHByZXZpb3VzVmFsdWUsIGN1cnJlbnRGZWF0dXJlLCBmZWF0dXJlSW5kZXgpO1xuICB9KTtcbiAgcmV0dXJuIHByZXZpb3VzVmFsdWU7XG59XG5cbi8qKlxuICogR2V0IGFsbCBjb29yZGluYXRlcyBmcm9tIGFueSBHZW9KU09OIG9iamVjdC5cbiAqXG4gKiBAbmFtZSBjb29yZEFsbFxuICogQHBhcmFtIHtGZWF0dXJlQ29sbGVjdGlvbnxGZWF0dXJlfEdlb21ldHJ5fSBnZW9qc29uIGFueSBHZW9KU09OIG9iamVjdFxuICogQHJldHVybnMge0FycmF5PEFycmF5PG51bWJlcj4+fSBjb29yZGluYXRlIHBvc2l0aW9uIGFycmF5XG4gKiBAZXhhbXBsZVxuICogdmFyIGZlYXR1cmVzID0gdHVyZi5mZWF0dXJlQ29sbGVjdGlvbihbXG4gKiAgIHR1cmYucG9pbnQoWzI2LCAzN10sIHtmb286ICdiYXInfSksXG4gKiAgIHR1cmYucG9pbnQoWzM2LCA1M10sIHtoZWxsbzogJ3dvcmxkJ30pXG4gKiBdKTtcbiAqXG4gKiB2YXIgY29vcmRzID0gdHVyZi5jb29yZEFsbChmZWF0dXJlcyk7XG4gKiAvLz0gW1syNiwgMzddLCBbMzYsIDUzXV1cbiAqL1xuZnVuY3Rpb24gY29vcmRBbGwoZ2VvanNvbikge1xuICB2YXIgY29vcmRzID0gW107XG4gIGNvb3JkRWFjaChnZW9qc29uLCBmdW5jdGlvbiAoY29vcmQpIHtcbiAgICBjb29yZHMucHVzaChjb29yZCk7XG4gIH0pO1xuICByZXR1cm4gY29vcmRzO1xufVxuXG4vKipcbiAqIENhbGxiYWNrIGZvciBnZW9tRWFjaFxuICpcbiAqIEBjYWxsYmFjayBnZW9tRWFjaENhbGxiYWNrXG4gKiBAcGFyYW0ge0dlb21ldHJ5fSBjdXJyZW50R2VvbWV0cnkgVGhlIGN1cnJlbnQgR2VvbWV0cnkgYmVpbmcgcHJvY2Vzc2VkLlxuICogQHBhcmFtIHtudW1iZXJ9IGZlYXR1cmVJbmRleCBUaGUgY3VycmVudCBpbmRleCBvZiB0aGUgRmVhdHVyZSBiZWluZyBwcm9jZXNzZWQuXG4gKiBAcGFyYW0ge09iamVjdH0gZmVhdHVyZVByb3BlcnRpZXMgVGhlIGN1cnJlbnQgRmVhdHVyZSBQcm9wZXJ0aWVzIGJlaW5nIHByb2Nlc3NlZC5cbiAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gZmVhdHVyZUJCb3ggVGhlIGN1cnJlbnQgRmVhdHVyZSBCQm94IGJlaW5nIHByb2Nlc3NlZC5cbiAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30gZmVhdHVyZUlkIFRoZSBjdXJyZW50IEZlYXR1cmUgSWQgYmVpbmcgcHJvY2Vzc2VkLlxuICovXG5cbi8qKlxuICogSXRlcmF0ZSBvdmVyIGVhY2ggZ2VvbWV0cnkgaW4gYW55IEdlb0pTT04gb2JqZWN0LCBzaW1pbGFyIHRvIEFycmF5LmZvckVhY2goKVxuICpcbiAqIEBuYW1lIGdlb21FYWNoXG4gKiBAcGFyYW0ge0ZlYXR1cmVDb2xsZWN0aW9ufEZlYXR1cmV8R2VvbWV0cnl9IGdlb2pzb24gYW55IEdlb0pTT04gb2JqZWN0XG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBhIG1ldGhvZCB0aGF0IHRha2VzIChjdXJyZW50R2VvbWV0cnksIGZlYXR1cmVJbmRleCwgZmVhdHVyZVByb3BlcnRpZXMsIGZlYXR1cmVCQm94LCBmZWF0dXJlSWQpXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqIEBleGFtcGxlXG4gKiB2YXIgZmVhdHVyZXMgPSB0dXJmLmZlYXR1cmVDb2xsZWN0aW9uKFtcbiAqICAgICB0dXJmLnBvaW50KFsyNiwgMzddLCB7Zm9vOiAnYmFyJ30pLFxuICogICAgIHR1cmYucG9pbnQoWzM2LCA1M10sIHtoZWxsbzogJ3dvcmxkJ30pXG4gKiBdKTtcbiAqXG4gKiB0dXJmLmdlb21FYWNoKGZlYXR1cmVzLCBmdW5jdGlvbiAoY3VycmVudEdlb21ldHJ5LCBmZWF0dXJlSW5kZXgsIGZlYXR1cmVQcm9wZXJ0aWVzLCBmZWF0dXJlQkJveCwgZmVhdHVyZUlkKSB7XG4gKiAgIC8vPWN1cnJlbnRHZW9tZXRyeVxuICogICAvLz1mZWF0dXJlSW5kZXhcbiAqICAgLy89ZmVhdHVyZVByb3BlcnRpZXNcbiAqICAgLy89ZmVhdHVyZUJCb3hcbiAqICAgLy89ZmVhdHVyZUlkXG4gKiB9KTtcbiAqL1xuZnVuY3Rpb24gZ2VvbUVhY2goZ2VvanNvbiwgY2FsbGJhY2spIHtcbiAgdmFyIGksXG4gICAgaixcbiAgICBnLFxuICAgIGdlb21ldHJ5LFxuICAgIHN0b3BHLFxuICAgIGdlb21ldHJ5TWF5YmVDb2xsZWN0aW9uLFxuICAgIGlzR2VvbWV0cnlDb2xsZWN0aW9uLFxuICAgIGZlYXR1cmVQcm9wZXJ0aWVzLFxuICAgIGZlYXR1cmVCQm94LFxuICAgIGZlYXR1cmVJZCxcbiAgICBmZWF0dXJlSW5kZXggPSAwLFxuICAgIGlzRmVhdHVyZUNvbGxlY3Rpb24gPSBnZW9qc29uLnR5cGUgPT09IFwiRmVhdHVyZUNvbGxlY3Rpb25cIixcbiAgICBpc0ZlYXR1cmUgPSBnZW9qc29uLnR5cGUgPT09IFwiRmVhdHVyZVwiLFxuICAgIHN0b3AgPSBpc0ZlYXR1cmVDb2xsZWN0aW9uID8gZ2VvanNvbi5mZWF0dXJlcy5sZW5ndGggOiAxO1xuXG4gIC8vIFRoaXMgbG9naWMgbWF5IGxvb2sgYSBsaXR0bGUgd2VpcmQuIFRoZSByZWFzb24gd2h5IGl0IGlzIHRoYXQgd2F5XG4gIC8vIGlzIGJlY2F1c2UgaXQncyB0cnlpbmcgdG8gYmUgZmFzdC4gR2VvSlNPTiBzdXBwb3J0cyBtdWx0aXBsZSBraW5kc1xuICAvLyBvZiBvYmplY3RzIGF0IGl0cyByb290OiBGZWF0dXJlQ29sbGVjdGlvbiwgRmVhdHVyZXMsIEdlb21ldHJpZXMuXG4gIC8vIFRoaXMgZnVuY3Rpb24gaGFzIHRoZSByZXNwb25zaWJpbGl0eSBvZiBoYW5kbGluZyBhbGwgb2YgdGhlbSwgYW5kIHRoYXRcbiAgLy8gbWVhbnMgdGhhdCBzb21lIG9mIHRoZSBgZm9yYCBsb29wcyB5b3Ugc2VlIGJlbG93IGFjdHVhbGx5IGp1c3QgZG9uJ3QgYXBwbHlcbiAgLy8gdG8gY2VydGFpbiBpbnB1dHMuIEZvciBpbnN0YW5jZSwgaWYgeW91IGdpdmUgdGhpcyBqdXN0IGFcbiAgLy8gUG9pbnQgZ2VvbWV0cnksIHRoZW4gYm90aCBsb29wcyBhcmUgc2hvcnQtY2lyY3VpdGVkIGFuZCBhbGwgd2UgZG9cbiAgLy8gaXMgZ3JhZHVhbGx5IHJlbmFtZSB0aGUgaW5wdXQgdW50aWwgaXQncyBjYWxsZWQgJ2dlb21ldHJ5Jy5cbiAgLy9cbiAgLy8gVGhpcyBhbHNvIGFpbXMgdG8gYWxsb2NhdGUgYXMgZmV3IHJlc291cmNlcyBhcyBwb3NzaWJsZToganVzdCBhXG4gIC8vIGZldyBudW1iZXJzIGFuZCBib29sZWFucywgcmF0aGVyIHRoYW4gYW55IHRlbXBvcmFyeSBhcnJheXMgYXMgd291bGRcbiAgLy8gYmUgcmVxdWlyZWQgd2l0aCB0aGUgbm9ybWFsaXphdGlvbiBhcHByb2FjaC5cbiAgZm9yIChpID0gMDsgaSA8IHN0b3A7IGkrKykge1xuICAgIGdlb21ldHJ5TWF5YmVDb2xsZWN0aW9uID0gaXNGZWF0dXJlQ29sbGVjdGlvblxuICAgICAgPyBnZW9qc29uLmZlYXR1cmVzW2ldLmdlb21ldHJ5XG4gICAgICA6IGlzRmVhdHVyZVxuICAgICAgPyBnZW9qc29uLmdlb21ldHJ5XG4gICAgICA6IGdlb2pzb247XG4gICAgZmVhdHVyZVByb3BlcnRpZXMgPSBpc0ZlYXR1cmVDb2xsZWN0aW9uXG4gICAgICA/IGdlb2pzb24uZmVhdHVyZXNbaV0ucHJvcGVydGllc1xuICAgICAgOiBpc0ZlYXR1cmVcbiAgICAgID8gZ2VvanNvbi5wcm9wZXJ0aWVzXG4gICAgICA6IHt9O1xuICAgIGZlYXR1cmVCQm94ID0gaXNGZWF0dXJlQ29sbGVjdGlvblxuICAgICAgPyBnZW9qc29uLmZlYXR1cmVzW2ldLmJib3hcbiAgICAgIDogaXNGZWF0dXJlXG4gICAgICA/IGdlb2pzb24uYmJveFxuICAgICAgOiB1bmRlZmluZWQ7XG4gICAgZmVhdHVyZUlkID0gaXNGZWF0dXJlQ29sbGVjdGlvblxuICAgICAgPyBnZW9qc29uLmZlYXR1cmVzW2ldLmlkXG4gICAgICA6IGlzRmVhdHVyZVxuICAgICAgPyBnZW9qc29uLmlkXG4gICAgICA6IHVuZGVmaW5lZDtcbiAgICBpc0dlb21ldHJ5Q29sbGVjdGlvbiA9IGdlb21ldHJ5TWF5YmVDb2xsZWN0aW9uXG4gICAgICA/IGdlb21ldHJ5TWF5YmVDb2xsZWN0aW9uLnR5cGUgPT09IFwiR2VvbWV0cnlDb2xsZWN0aW9uXCJcbiAgICAgIDogZmFsc2U7XG4gICAgc3RvcEcgPSBpc0dlb21ldHJ5Q29sbGVjdGlvblxuICAgICAgPyBnZW9tZXRyeU1heWJlQ29sbGVjdGlvbi5nZW9tZXRyaWVzLmxlbmd0aFxuICAgICAgOiAxO1xuXG4gICAgZm9yIChnID0gMDsgZyA8IHN0b3BHOyBnKyspIHtcbiAgICAgIGdlb21ldHJ5ID0gaXNHZW9tZXRyeUNvbGxlY3Rpb25cbiAgICAgICAgPyBnZW9tZXRyeU1heWJlQ29sbGVjdGlvbi5nZW9tZXRyaWVzW2ddXG4gICAgICAgIDogZ2VvbWV0cnlNYXliZUNvbGxlY3Rpb247XG5cbiAgICAgIC8vIEhhbmRsZSBudWxsIEdlb21ldHJ5XG4gICAgICBpZiAoZ2VvbWV0cnkgPT09IG51bGwpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGNhbGxiYWNrKFxuICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgIGZlYXR1cmVJbmRleCxcbiAgICAgICAgICAgIGZlYXR1cmVQcm9wZXJ0aWVzLFxuICAgICAgICAgICAgZmVhdHVyZUJCb3gsXG4gICAgICAgICAgICBmZWF0dXJlSWRcbiAgICAgICAgICApID09PSBmYWxzZVxuICAgICAgICApXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHN3aXRjaCAoZ2VvbWV0cnkudHlwZSkge1xuICAgICAgICBjYXNlIFwiUG9pbnRcIjpcbiAgICAgICAgY2FzZSBcIkxpbmVTdHJpbmdcIjpcbiAgICAgICAgY2FzZSBcIk11bHRpUG9pbnRcIjpcbiAgICAgICAgY2FzZSBcIlBvbHlnb25cIjpcbiAgICAgICAgY2FzZSBcIk11bHRpTGluZVN0cmluZ1wiOlxuICAgICAgICBjYXNlIFwiTXVsdGlQb2x5Z29uXCI6IHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBjYWxsYmFjayhcbiAgICAgICAgICAgICAgZ2VvbWV0cnksXG4gICAgICAgICAgICAgIGZlYXR1cmVJbmRleCxcbiAgICAgICAgICAgICAgZmVhdHVyZVByb3BlcnRpZXMsXG4gICAgICAgICAgICAgIGZlYXR1cmVCQm94LFxuICAgICAgICAgICAgICBmZWF0dXJlSWRcbiAgICAgICAgICAgICkgPT09IGZhbHNlXG4gICAgICAgICAgKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJHZW9tZXRyeUNvbGxlY3Rpb25cIjoge1xuICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBnZW9tZXRyeS5nZW9tZXRyaWVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIGNhbGxiYWNrKFxuICAgICAgICAgICAgICAgIGdlb21ldHJ5Lmdlb21ldHJpZXNbal0sXG4gICAgICAgICAgICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgICAgICAgICAgIGZlYXR1cmVQcm9wZXJ0aWVzLFxuICAgICAgICAgICAgICAgIGZlYXR1cmVCQm94LFxuICAgICAgICAgICAgICAgIGZlYXR1cmVJZFxuICAgICAgICAgICAgICApID09PSBmYWxzZVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5rbm93biBHZW9tZXRyeSBUeXBlXCIpO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBPbmx5IGluY3JlYXNlIGBmZWF0dXJlSW5kZXhgIHBlciBlYWNoIGZlYXR1cmVcbiAgICBmZWF0dXJlSW5kZXgrKztcbiAgfVxufVxuXG4vKipcbiAqIENhbGxiYWNrIGZvciBnZW9tUmVkdWNlXG4gKlxuICogVGhlIGZpcnN0IHRpbWUgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIGlzIGNhbGxlZCwgdGhlIHZhbHVlcyBwcm92aWRlZCBhcyBhcmd1bWVudHMgZGVwZW5kXG4gKiBvbiB3aGV0aGVyIHRoZSByZWR1Y2UgbWV0aG9kIGhhcyBhbiBpbml0aWFsVmFsdWUgYXJndW1lbnQuXG4gKlxuICogSWYgYW4gaW5pdGlhbFZhbHVlIGlzIHByb3ZpZGVkIHRvIHRoZSByZWR1Y2UgbWV0aG9kOlxuICogIC0gVGhlIHByZXZpb3VzVmFsdWUgYXJndW1lbnQgaXMgaW5pdGlhbFZhbHVlLlxuICogIC0gVGhlIGN1cnJlbnRWYWx1ZSBhcmd1bWVudCBpcyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IGVsZW1lbnQgcHJlc2VudCBpbiB0aGUgYXJyYXkuXG4gKlxuICogSWYgYW4gaW5pdGlhbFZhbHVlIGlzIG5vdCBwcm92aWRlZDpcbiAqICAtIFRoZSBwcmV2aW91c1ZhbHVlIGFyZ3VtZW50IGlzIHRoZSB2YWx1ZSBvZiB0aGUgZmlyc3QgZWxlbWVudCBwcmVzZW50IGluIHRoZSBhcnJheS5cbiAqICAtIFRoZSBjdXJyZW50VmFsdWUgYXJndW1lbnQgaXMgdGhlIHZhbHVlIG9mIHRoZSBzZWNvbmQgZWxlbWVudCBwcmVzZW50IGluIHRoZSBhcnJheS5cbiAqXG4gKiBAY2FsbGJhY2sgZ2VvbVJlZHVjZUNhbGxiYWNrXG4gKiBAcGFyYW0geyp9IHByZXZpb3VzVmFsdWUgVGhlIGFjY3VtdWxhdGVkIHZhbHVlIHByZXZpb3VzbHkgcmV0dXJuZWQgaW4gdGhlIGxhc3QgaW52b2NhdGlvblxuICogb2YgdGhlIGNhbGxiYWNrLCBvciBpbml0aWFsVmFsdWUsIGlmIHN1cHBsaWVkLlxuICogQHBhcmFtIHtHZW9tZXRyeX0gY3VycmVudEdlb21ldHJ5IFRoZSBjdXJyZW50IEdlb21ldHJ5IGJlaW5nIHByb2Nlc3NlZC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBmZWF0dXJlSW5kZXggVGhlIGN1cnJlbnQgaW5kZXggb2YgdGhlIEZlYXR1cmUgYmVpbmcgcHJvY2Vzc2VkLlxuICogQHBhcmFtIHtPYmplY3R9IGZlYXR1cmVQcm9wZXJ0aWVzIFRoZSBjdXJyZW50IEZlYXR1cmUgUHJvcGVydGllcyBiZWluZyBwcm9jZXNzZWQuXG4gKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IGZlYXR1cmVCQm94IFRoZSBjdXJyZW50IEZlYXR1cmUgQkJveCBiZWluZyBwcm9jZXNzZWQuXG4gKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IGZlYXR1cmVJZCBUaGUgY3VycmVudCBGZWF0dXJlIElkIGJlaW5nIHByb2Nlc3NlZC5cbiAqL1xuXG4vKipcbiAqIFJlZHVjZSBnZW9tZXRyeSBpbiBhbnkgR2VvSlNPTiBvYmplY3QsIHNpbWlsYXIgdG8gQXJyYXkucmVkdWNlKCkuXG4gKlxuICogQG5hbWUgZ2VvbVJlZHVjZVxuICogQHBhcmFtIHtGZWF0dXJlQ29sbGVjdGlvbnxGZWF0dXJlfEdlb21ldHJ5fSBnZW9qc29uIGFueSBHZW9KU09OIG9iamVjdFxuICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgYSBtZXRob2QgdGhhdCB0YWtlcyAocHJldmlvdXNWYWx1ZSwgY3VycmVudEdlb21ldHJ5LCBmZWF0dXJlSW5kZXgsIGZlYXR1cmVQcm9wZXJ0aWVzLCBmZWF0dXJlQkJveCwgZmVhdHVyZUlkKVxuICogQHBhcmFtIHsqfSBbaW5pdGlhbFZhbHVlXSBWYWx1ZSB0byB1c2UgYXMgdGhlIGZpcnN0IGFyZ3VtZW50IHRvIHRoZSBmaXJzdCBjYWxsIG9mIHRoZSBjYWxsYmFjay5cbiAqIEByZXR1cm5zIHsqfSBUaGUgdmFsdWUgdGhhdCByZXN1bHRzIGZyb20gdGhlIHJlZHVjdGlvbi5cbiAqIEBleGFtcGxlXG4gKiB2YXIgZmVhdHVyZXMgPSB0dXJmLmZlYXR1cmVDb2xsZWN0aW9uKFtcbiAqICAgICB0dXJmLnBvaW50KFsyNiwgMzddLCB7Zm9vOiAnYmFyJ30pLFxuICogICAgIHR1cmYucG9pbnQoWzM2LCA1M10sIHtoZWxsbzogJ3dvcmxkJ30pXG4gKiBdKTtcbiAqXG4gKiB0dXJmLmdlb21SZWR1Y2UoZmVhdHVyZXMsIGZ1bmN0aW9uIChwcmV2aW91c1ZhbHVlLCBjdXJyZW50R2VvbWV0cnksIGZlYXR1cmVJbmRleCwgZmVhdHVyZVByb3BlcnRpZXMsIGZlYXR1cmVCQm94LCBmZWF0dXJlSWQpIHtcbiAqICAgLy89cHJldmlvdXNWYWx1ZVxuICogICAvLz1jdXJyZW50R2VvbWV0cnlcbiAqICAgLy89ZmVhdHVyZUluZGV4XG4gKiAgIC8vPWZlYXR1cmVQcm9wZXJ0aWVzXG4gKiAgIC8vPWZlYXR1cmVCQm94XG4gKiAgIC8vPWZlYXR1cmVJZFxuICogICByZXR1cm4gY3VycmVudEdlb21ldHJ5XG4gKiB9KTtcbiAqL1xuZnVuY3Rpb24gZ2VvbVJlZHVjZShnZW9qc29uLCBjYWxsYmFjaywgaW5pdGlhbFZhbHVlKSB7XG4gIHZhciBwcmV2aW91c1ZhbHVlID0gaW5pdGlhbFZhbHVlO1xuICBnZW9tRWFjaChcbiAgICBnZW9qc29uLFxuICAgIGZ1bmN0aW9uIChcbiAgICAgIGN1cnJlbnRHZW9tZXRyeSxcbiAgICAgIGZlYXR1cmVJbmRleCxcbiAgICAgIGZlYXR1cmVQcm9wZXJ0aWVzLFxuICAgICAgZmVhdHVyZUJCb3gsXG4gICAgICBmZWF0dXJlSWRcbiAgICApIHtcbiAgICAgIGlmIChmZWF0dXJlSW5kZXggPT09IDAgJiYgaW5pdGlhbFZhbHVlID09PSB1bmRlZmluZWQpXG4gICAgICAgIHByZXZpb3VzVmFsdWUgPSBjdXJyZW50R2VvbWV0cnk7XG4gICAgICBlbHNlXG4gICAgICAgIHByZXZpb3VzVmFsdWUgPSBjYWxsYmFjayhcbiAgICAgICAgICBwcmV2aW91c1ZhbHVlLFxuICAgICAgICAgIGN1cnJlbnRHZW9tZXRyeSxcbiAgICAgICAgICBmZWF0dXJlSW5kZXgsXG4gICAgICAgICAgZmVhdHVyZVByb3BlcnRpZXMsXG4gICAgICAgICAgZmVhdHVyZUJCb3gsXG4gICAgICAgICAgZmVhdHVyZUlkXG4gICAgICAgICk7XG4gICAgfVxuICApO1xuICByZXR1cm4gcHJldmlvdXNWYWx1ZTtcbn1cblxuLyoqXG4gKiBDYWxsYmFjayBmb3IgZmxhdHRlbkVhY2hcbiAqXG4gKiBAY2FsbGJhY2sgZmxhdHRlbkVhY2hDYWxsYmFja1xuICogQHBhcmFtIHtGZWF0dXJlfSBjdXJyZW50RmVhdHVyZSBUaGUgY3VycmVudCBmbGF0dGVuZWQgZmVhdHVyZSBiZWluZyBwcm9jZXNzZWQuXG4gKiBAcGFyYW0ge251bWJlcn0gZmVhdHVyZUluZGV4IFRoZSBjdXJyZW50IGluZGV4IG9mIHRoZSBGZWF0dXJlIGJlaW5nIHByb2Nlc3NlZC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBtdWx0aUZlYXR1cmVJbmRleCBUaGUgY3VycmVudCBpbmRleCBvZiB0aGUgTXVsdGktRmVhdHVyZSBiZWluZyBwcm9jZXNzZWQuXG4gKi9cblxuLyoqXG4gKiBJdGVyYXRlIG92ZXIgZmxhdHRlbmVkIGZlYXR1cmVzIGluIGFueSBHZW9KU09OIG9iamVjdCwgc2ltaWxhciB0b1xuICogQXJyYXkuZm9yRWFjaC5cbiAqXG4gKiBAbmFtZSBmbGF0dGVuRWFjaFxuICogQHBhcmFtIHtGZWF0dXJlQ29sbGVjdGlvbnxGZWF0dXJlfEdlb21ldHJ5fSBnZW9qc29uIGFueSBHZW9KU09OIG9iamVjdFxuICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgYSBtZXRob2QgdGhhdCB0YWtlcyAoY3VycmVudEZlYXR1cmUsIGZlYXR1cmVJbmRleCwgbXVsdGlGZWF0dXJlSW5kZXgpXG4gKiBAZXhhbXBsZVxuICogdmFyIGZlYXR1cmVzID0gdHVyZi5mZWF0dXJlQ29sbGVjdGlvbihbXG4gKiAgICAgdHVyZi5wb2ludChbMjYsIDM3XSwge2ZvbzogJ2Jhcid9KSxcbiAqICAgICB0dXJmLm11bHRpUG9pbnQoW1s0MCwgMzBdLCBbMzYsIDUzXV0sIHtoZWxsbzogJ3dvcmxkJ30pXG4gKiBdKTtcbiAqXG4gKiB0dXJmLmZsYXR0ZW5FYWNoKGZlYXR1cmVzLCBmdW5jdGlvbiAoY3VycmVudEZlYXR1cmUsIGZlYXR1cmVJbmRleCwgbXVsdGlGZWF0dXJlSW5kZXgpIHtcbiAqICAgLy89Y3VycmVudEZlYXR1cmVcbiAqICAgLy89ZmVhdHVyZUluZGV4XG4gKiAgIC8vPW11bHRpRmVhdHVyZUluZGV4XG4gKiB9KTtcbiAqL1xuZnVuY3Rpb24gZmxhdHRlbkVhY2goZ2VvanNvbiwgY2FsbGJhY2spIHtcbiAgZ2VvbUVhY2goZ2VvanNvbiwgZnVuY3Rpb24gKGdlb21ldHJ5LCBmZWF0dXJlSW5kZXgsIHByb3BlcnRpZXMsIGJib3gsIGlkKSB7XG4gICAgLy8gQ2FsbGJhY2sgZm9yIHNpbmdsZSBnZW9tZXRyeVxuICAgIHZhciB0eXBlID0gZ2VvbWV0cnkgPT09IG51bGwgPyBudWxsIDogZ2VvbWV0cnkudHlwZTtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgbnVsbDpcbiAgICAgIGNhc2UgXCJQb2ludFwiOlxuICAgICAgY2FzZSBcIkxpbmVTdHJpbmdcIjpcbiAgICAgIGNhc2UgXCJQb2x5Z29uXCI6XG4gICAgICAgIGlmIChcbiAgICAgICAgICBjYWxsYmFjayhcbiAgICAgICAgICAgIGZlYXR1cmUoZ2VvbWV0cnksIHByb3BlcnRpZXMsIHsgYmJveDogYmJveCwgaWQ6IGlkIH0pLFxuICAgICAgICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgICAgICAgMFxuICAgICAgICAgICkgPT09IGZhbHNlXG4gICAgICAgIClcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgZ2VvbVR5cGU7XG5cbiAgICAvLyBDYWxsYmFjayBmb3IgbXVsdGktZ2VvbWV0cnlcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgXCJNdWx0aVBvaW50XCI6XG4gICAgICAgIGdlb21UeXBlID0gXCJQb2ludFwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJNdWx0aUxpbmVTdHJpbmdcIjpcbiAgICAgICAgZ2VvbVR5cGUgPSBcIkxpbmVTdHJpbmdcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiTXVsdGlQb2x5Z29uXCI6XG4gICAgICAgIGdlb21UeXBlID0gXCJQb2x5Z29uXCI7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGZvciAoXG4gICAgICB2YXIgbXVsdGlGZWF0dXJlSW5kZXggPSAwO1xuICAgICAgbXVsdGlGZWF0dXJlSW5kZXggPCBnZW9tZXRyeS5jb29yZGluYXRlcy5sZW5ndGg7XG4gICAgICBtdWx0aUZlYXR1cmVJbmRleCsrXG4gICAgKSB7XG4gICAgICB2YXIgY29vcmRpbmF0ZSA9IGdlb21ldHJ5LmNvb3JkaW5hdGVzW211bHRpRmVhdHVyZUluZGV4XTtcbiAgICAgIHZhciBnZW9tID0ge1xuICAgICAgICB0eXBlOiBnZW9tVHlwZSxcbiAgICAgICAgY29vcmRpbmF0ZXM6IGNvb3JkaW5hdGUsXG4gICAgICB9O1xuICAgICAgaWYgKFxuICAgICAgICBjYWxsYmFjayhmZWF0dXJlKGdlb20sIHByb3BlcnRpZXMpLCBmZWF0dXJlSW5kZXgsIG11bHRpRmVhdHVyZUluZGV4KSA9PT1cbiAgICAgICAgZmFsc2VcbiAgICAgIClcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogQ2FsbGJhY2sgZm9yIGZsYXR0ZW5SZWR1Y2VcbiAqXG4gKiBUaGUgZmlyc3QgdGltZSB0aGUgY2FsbGJhY2sgZnVuY3Rpb24gaXMgY2FsbGVkLCB0aGUgdmFsdWVzIHByb3ZpZGVkIGFzIGFyZ3VtZW50cyBkZXBlbmRcbiAqIG9uIHdoZXRoZXIgdGhlIHJlZHVjZSBtZXRob2QgaGFzIGFuIGluaXRpYWxWYWx1ZSBhcmd1bWVudC5cbiAqXG4gKiBJZiBhbiBpbml0aWFsVmFsdWUgaXMgcHJvdmlkZWQgdG8gdGhlIHJlZHVjZSBtZXRob2Q6XG4gKiAgLSBUaGUgcHJldmlvdXNWYWx1ZSBhcmd1bWVudCBpcyBpbml0aWFsVmFsdWUuXG4gKiAgLSBUaGUgY3VycmVudFZhbHVlIGFyZ3VtZW50IGlzIHRoZSB2YWx1ZSBvZiB0aGUgZmlyc3QgZWxlbWVudCBwcmVzZW50IGluIHRoZSBhcnJheS5cbiAqXG4gKiBJZiBhbiBpbml0aWFsVmFsdWUgaXMgbm90IHByb3ZpZGVkOlxuICogIC0gVGhlIHByZXZpb3VzVmFsdWUgYXJndW1lbnQgaXMgdGhlIHZhbHVlIG9mIHRoZSBmaXJzdCBlbGVtZW50IHByZXNlbnQgaW4gdGhlIGFycmF5LlxuICogIC0gVGhlIGN1cnJlbnRWYWx1ZSBhcmd1bWVudCBpcyB0aGUgdmFsdWUgb2YgdGhlIHNlY29uZCBlbGVtZW50IHByZXNlbnQgaW4gdGhlIGFycmF5LlxuICpcbiAqIEBjYWxsYmFjayBmbGF0dGVuUmVkdWNlQ2FsbGJhY2tcbiAqIEBwYXJhbSB7Kn0gcHJldmlvdXNWYWx1ZSBUaGUgYWNjdW11bGF0ZWQgdmFsdWUgcHJldmlvdXNseSByZXR1cm5lZCBpbiB0aGUgbGFzdCBpbnZvY2F0aW9uXG4gKiBvZiB0aGUgY2FsbGJhY2ssIG9yIGluaXRpYWxWYWx1ZSwgaWYgc3VwcGxpZWQuXG4gKiBAcGFyYW0ge0ZlYXR1cmV9IGN1cnJlbnRGZWF0dXJlIFRoZSBjdXJyZW50IEZlYXR1cmUgYmVpbmcgcHJvY2Vzc2VkLlxuICogQHBhcmFtIHtudW1iZXJ9IGZlYXR1cmVJbmRleCBUaGUgY3VycmVudCBpbmRleCBvZiB0aGUgRmVhdHVyZSBiZWluZyBwcm9jZXNzZWQuXG4gKiBAcGFyYW0ge251bWJlcn0gbXVsdGlGZWF0dXJlSW5kZXggVGhlIGN1cnJlbnQgaW5kZXggb2YgdGhlIE11bHRpLUZlYXR1cmUgYmVpbmcgcHJvY2Vzc2VkLlxuICovXG5cbi8qKlxuICogUmVkdWNlIGZsYXR0ZW5lZCBmZWF0dXJlcyBpbiBhbnkgR2VvSlNPTiBvYmplY3QsIHNpbWlsYXIgdG8gQXJyYXkucmVkdWNlKCkuXG4gKlxuICogQG5hbWUgZmxhdHRlblJlZHVjZVxuICogQHBhcmFtIHtGZWF0dXJlQ29sbGVjdGlvbnxGZWF0dXJlfEdlb21ldHJ5fSBnZW9qc29uIGFueSBHZW9KU09OIG9iamVjdFxuICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgYSBtZXRob2QgdGhhdCB0YWtlcyAocHJldmlvdXNWYWx1ZSwgY3VycmVudEZlYXR1cmUsIGZlYXR1cmVJbmRleCwgbXVsdGlGZWF0dXJlSW5kZXgpXG4gKiBAcGFyYW0geyp9IFtpbml0aWFsVmFsdWVdIFZhbHVlIHRvIHVzZSBhcyB0aGUgZmlyc3QgYXJndW1lbnQgdG8gdGhlIGZpcnN0IGNhbGwgb2YgdGhlIGNhbGxiYWNrLlxuICogQHJldHVybnMgeyp9IFRoZSB2YWx1ZSB0aGF0IHJlc3VsdHMgZnJvbSB0aGUgcmVkdWN0aW9uLlxuICogQGV4YW1wbGVcbiAqIHZhciBmZWF0dXJlcyA9IHR1cmYuZmVhdHVyZUNvbGxlY3Rpb24oW1xuICogICAgIHR1cmYucG9pbnQoWzI2LCAzN10sIHtmb286ICdiYXInfSksXG4gKiAgICAgdHVyZi5tdWx0aVBvaW50KFtbNDAsIDMwXSwgWzM2LCA1M11dLCB7aGVsbG86ICd3b3JsZCd9KVxuICogXSk7XG4gKlxuICogdHVyZi5mbGF0dGVuUmVkdWNlKGZlYXR1cmVzLCBmdW5jdGlvbiAocHJldmlvdXNWYWx1ZSwgY3VycmVudEZlYXR1cmUsIGZlYXR1cmVJbmRleCwgbXVsdGlGZWF0dXJlSW5kZXgpIHtcbiAqICAgLy89cHJldmlvdXNWYWx1ZVxuICogICAvLz1jdXJyZW50RmVhdHVyZVxuICogICAvLz1mZWF0dXJlSW5kZXhcbiAqICAgLy89bXVsdGlGZWF0dXJlSW5kZXhcbiAqICAgcmV0dXJuIGN1cnJlbnRGZWF0dXJlXG4gKiB9KTtcbiAqL1xuZnVuY3Rpb24gZmxhdHRlblJlZHVjZShnZW9qc29uLCBjYWxsYmFjaywgaW5pdGlhbFZhbHVlKSB7XG4gIHZhciBwcmV2aW91c1ZhbHVlID0gaW5pdGlhbFZhbHVlO1xuICBmbGF0dGVuRWFjaChcbiAgICBnZW9qc29uLFxuICAgIGZ1bmN0aW9uIChjdXJyZW50RmVhdHVyZSwgZmVhdHVyZUluZGV4LCBtdWx0aUZlYXR1cmVJbmRleCkge1xuICAgICAgaWYgKFxuICAgICAgICBmZWF0dXJlSW5kZXggPT09IDAgJiZcbiAgICAgICAgbXVsdGlGZWF0dXJlSW5kZXggPT09IDAgJiZcbiAgICAgICAgaW5pdGlhbFZhbHVlID09PSB1bmRlZmluZWRcbiAgICAgIClcbiAgICAgICAgcHJldmlvdXNWYWx1ZSA9IGN1cnJlbnRGZWF0dXJlO1xuICAgICAgZWxzZVxuICAgICAgICBwcmV2aW91c1ZhbHVlID0gY2FsbGJhY2soXG4gICAgICAgICAgcHJldmlvdXNWYWx1ZSxcbiAgICAgICAgICBjdXJyZW50RmVhdHVyZSxcbiAgICAgICAgICBmZWF0dXJlSW5kZXgsXG4gICAgICAgICAgbXVsdGlGZWF0dXJlSW5kZXhcbiAgICAgICAgKTtcbiAgICB9XG4gICk7XG4gIHJldHVybiBwcmV2aW91c1ZhbHVlO1xufVxuXG4vKipcbiAqIENhbGxiYWNrIGZvciBzZWdtZW50RWFjaFxuICpcbiAqIEBjYWxsYmFjayBzZWdtZW50RWFjaENhbGxiYWNrXG4gKiBAcGFyYW0ge0ZlYXR1cmU8TGluZVN0cmluZz59IGN1cnJlbnRTZWdtZW50IFRoZSBjdXJyZW50IFNlZ21lbnQgYmVpbmcgcHJvY2Vzc2VkLlxuICogQHBhcmFtIHtudW1iZXJ9IGZlYXR1cmVJbmRleCBUaGUgY3VycmVudCBpbmRleCBvZiB0aGUgRmVhdHVyZSBiZWluZyBwcm9jZXNzZWQuXG4gKiBAcGFyYW0ge251bWJlcn0gbXVsdGlGZWF0dXJlSW5kZXggVGhlIGN1cnJlbnQgaW5kZXggb2YgdGhlIE11bHRpLUZlYXR1cmUgYmVpbmcgcHJvY2Vzc2VkLlxuICogQHBhcmFtIHtudW1iZXJ9IGdlb21ldHJ5SW5kZXggVGhlIGN1cnJlbnQgaW5kZXggb2YgdGhlIEdlb21ldHJ5IGJlaW5nIHByb2Nlc3NlZC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBzZWdtZW50SW5kZXggVGhlIGN1cnJlbnQgaW5kZXggb2YgdGhlIFNlZ21lbnQgYmVpbmcgcHJvY2Vzc2VkLlxuICogQHJldHVybnMge3ZvaWR9XG4gKi9cblxuLyoqXG4gKiBJdGVyYXRlIG92ZXIgMi12ZXJ0ZXggbGluZSBzZWdtZW50IGluIGFueSBHZW9KU09OIG9iamVjdCwgc2ltaWxhciB0byBBcnJheS5mb3JFYWNoKClcbiAqIChNdWx0aSlQb2ludCBnZW9tZXRyaWVzIGRvIG5vdCBjb250YWluIHNlZ21lbnRzIHRoZXJlZm9yZSB0aGV5IGFyZSBpZ25vcmVkIGR1cmluZyB0aGlzIG9wZXJhdGlvbi5cbiAqXG4gKiBAcGFyYW0ge0ZlYXR1cmVDb2xsZWN0aW9ufEZlYXR1cmV8R2VvbWV0cnl9IGdlb2pzb24gYW55IEdlb0pTT05cbiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIGEgbWV0aG9kIHRoYXQgdGFrZXMgKGN1cnJlbnRTZWdtZW50LCBmZWF0dXJlSW5kZXgsIG11bHRpRmVhdHVyZUluZGV4LCBnZW9tZXRyeUluZGV4LCBzZWdtZW50SW5kZXgpXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqIEBleGFtcGxlXG4gKiB2YXIgcG9seWdvbiA9IHR1cmYucG9seWdvbihbW1stNTAsIDVdLCBbLTQwLCAtMTBdLCBbLTUwLCAtMTBdLCBbLTQwLCA1XSwgWy01MCwgNV1dXSk7XG4gKlxuICogLy8gSXRlcmF0ZSBvdmVyIEdlb0pTT04gYnkgMi12ZXJ0ZXggc2VnbWVudHNcbiAqIHR1cmYuc2VnbWVudEVhY2gocG9seWdvbiwgZnVuY3Rpb24gKGN1cnJlbnRTZWdtZW50LCBmZWF0dXJlSW5kZXgsIG11bHRpRmVhdHVyZUluZGV4LCBnZW9tZXRyeUluZGV4LCBzZWdtZW50SW5kZXgpIHtcbiAqICAgLy89Y3VycmVudFNlZ21lbnRcbiAqICAgLy89ZmVhdHVyZUluZGV4XG4gKiAgIC8vPW11bHRpRmVhdHVyZUluZGV4XG4gKiAgIC8vPWdlb21ldHJ5SW5kZXhcbiAqICAgLy89c2VnbWVudEluZGV4XG4gKiB9KTtcbiAqXG4gKiAvLyBDYWxjdWxhdGUgdGhlIHRvdGFsIG51bWJlciBvZiBzZWdtZW50c1xuICogdmFyIHRvdGFsID0gMDtcbiAqIHR1cmYuc2VnbWVudEVhY2gocG9seWdvbiwgZnVuY3Rpb24gKCkge1xuICogICAgIHRvdGFsKys7XG4gKiB9KTtcbiAqL1xuZnVuY3Rpb24gc2VnbWVudEVhY2goZ2VvanNvbiwgY2FsbGJhY2spIHtcbiAgZmxhdHRlbkVhY2goZ2VvanNvbiwgZnVuY3Rpb24gKGZlYXR1cmUkJDEsIGZlYXR1cmVJbmRleCwgbXVsdGlGZWF0dXJlSW5kZXgpIHtcbiAgICB2YXIgc2VnbWVudEluZGV4ID0gMDtcblxuICAgIC8vIEV4Y2x1ZGUgbnVsbCBHZW9tZXRyaWVzXG4gICAgaWYgKCFmZWF0dXJlJCQxLmdlb21ldHJ5KSByZXR1cm47XG4gICAgLy8gKE11bHRpKVBvaW50IGdlb21ldHJpZXMgZG8gbm90IGNvbnRhaW4gc2VnbWVudHMgdGhlcmVmb3JlIHRoZXkgYXJlIGlnbm9yZWQgZHVyaW5nIHRoaXMgb3BlcmF0aW9uLlxuICAgIHZhciB0eXBlID0gZmVhdHVyZSQkMS5nZW9tZXRyeS50eXBlO1xuICAgIGlmICh0eXBlID09PSBcIlBvaW50XCIgfHwgdHlwZSA9PT0gXCJNdWx0aVBvaW50XCIpIHJldHVybjtcblxuICAgIC8vIEdlbmVyYXRlIDItdmVydGV4IGxpbmUgc2VnbWVudHNcbiAgICB2YXIgcHJldmlvdXNDb29yZHM7XG4gICAgdmFyIHByZXZpb3VzRmVhdHVyZUluZGV4ID0gMDtcbiAgICB2YXIgcHJldmlvdXNNdWx0aUluZGV4ID0gMDtcbiAgICB2YXIgcHJldkdlb21JbmRleCA9IDA7XG4gICAgaWYgKFxuICAgICAgY29vcmRFYWNoKFxuICAgICAgICBmZWF0dXJlJCQxLFxuICAgICAgICBmdW5jdGlvbiAoXG4gICAgICAgICAgY3VycmVudENvb3JkLFxuICAgICAgICAgIGNvb3JkSW5kZXgsXG4gICAgICAgICAgZmVhdHVyZUluZGV4Q29vcmQsXG4gICAgICAgICAgbXVsdGlQYXJ0SW5kZXhDb29yZCxcbiAgICAgICAgICBnZW9tZXRyeUluZGV4XG4gICAgICAgICkge1xuICAgICAgICAgIC8vIFNpbXVsYXRpbmcgYSBtZXRhLmNvb3JkUmVkdWNlKCkgc2luY2UgYHJlZHVjZWAgb3BlcmF0aW9ucyBjYW5ub3QgYmUgc3RvcHBlZCBieSByZXR1cm5pbmcgYGZhbHNlYFxuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIHByZXZpb3VzQ29vcmRzID09PSB1bmRlZmluZWQgfHxcbiAgICAgICAgICAgIGZlYXR1cmVJbmRleCA+IHByZXZpb3VzRmVhdHVyZUluZGV4IHx8XG4gICAgICAgICAgICBtdWx0aVBhcnRJbmRleENvb3JkID4gcHJldmlvdXNNdWx0aUluZGV4IHx8XG4gICAgICAgICAgICBnZW9tZXRyeUluZGV4ID4gcHJldkdlb21JbmRleFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgcHJldmlvdXNDb29yZHMgPSBjdXJyZW50Q29vcmQ7XG4gICAgICAgICAgICBwcmV2aW91c0ZlYXR1cmVJbmRleCA9IGZlYXR1cmVJbmRleDtcbiAgICAgICAgICAgIHByZXZpb3VzTXVsdGlJbmRleCA9IG11bHRpUGFydEluZGV4Q29vcmQ7XG4gICAgICAgICAgICBwcmV2R2VvbUluZGV4ID0gZ2VvbWV0cnlJbmRleDtcbiAgICAgICAgICAgIHNlZ21lbnRJbmRleCA9IDA7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBjdXJyZW50U2VnbWVudCA9IGxpbmVTdHJpbmcoXG4gICAgICAgICAgICBbcHJldmlvdXNDb29yZHMsIGN1cnJlbnRDb29yZF0sXG4gICAgICAgICAgICBmZWF0dXJlJCQxLnByb3BlcnRpZXNcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIGNhbGxiYWNrKFxuICAgICAgICAgICAgICBjdXJyZW50U2VnbWVudCxcbiAgICAgICAgICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgICAgICAgICBtdWx0aUZlYXR1cmVJbmRleCxcbiAgICAgICAgICAgICAgZ2VvbWV0cnlJbmRleCxcbiAgICAgICAgICAgICAgc2VnbWVudEluZGV4XG4gICAgICAgICAgICApID09PSBmYWxzZVxuICAgICAgICAgIClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICBzZWdtZW50SW5kZXgrKztcbiAgICAgICAgICBwcmV2aW91c0Nvb3JkcyA9IGN1cnJlbnRDb29yZDtcbiAgICAgICAgfVxuICAgICAgKSA9PT0gZmFsc2VcbiAgICApXG4gICAgICByZXR1cm4gZmFsc2U7XG4gIH0pO1xufVxuXG4vKipcbiAqIENhbGxiYWNrIGZvciBzZWdtZW50UmVkdWNlXG4gKlxuICogVGhlIGZpcnN0IHRpbWUgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIGlzIGNhbGxlZCwgdGhlIHZhbHVlcyBwcm92aWRlZCBhcyBhcmd1bWVudHMgZGVwZW5kXG4gKiBvbiB3aGV0aGVyIHRoZSByZWR1Y2UgbWV0aG9kIGhhcyBhbiBpbml0aWFsVmFsdWUgYXJndW1lbnQuXG4gKlxuICogSWYgYW4gaW5pdGlhbFZhbHVlIGlzIHByb3ZpZGVkIHRvIHRoZSByZWR1Y2UgbWV0aG9kOlxuICogIC0gVGhlIHByZXZpb3VzVmFsdWUgYXJndW1lbnQgaXMgaW5pdGlhbFZhbHVlLlxuICogIC0gVGhlIGN1cnJlbnRWYWx1ZSBhcmd1bWVudCBpcyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IGVsZW1lbnQgcHJlc2VudCBpbiB0aGUgYXJyYXkuXG4gKlxuICogSWYgYW4gaW5pdGlhbFZhbHVlIGlzIG5vdCBwcm92aWRlZDpcbiAqICAtIFRoZSBwcmV2aW91c1ZhbHVlIGFyZ3VtZW50IGlzIHRoZSB2YWx1ZSBvZiB0aGUgZmlyc3QgZWxlbWVudCBwcmVzZW50IGluIHRoZSBhcnJheS5cbiAqICAtIFRoZSBjdXJyZW50VmFsdWUgYXJndW1lbnQgaXMgdGhlIHZhbHVlIG9mIHRoZSBzZWNvbmQgZWxlbWVudCBwcmVzZW50IGluIHRoZSBhcnJheS5cbiAqXG4gKiBAY2FsbGJhY2sgc2VnbWVudFJlZHVjZUNhbGxiYWNrXG4gKiBAcGFyYW0geyp9IHByZXZpb3VzVmFsdWUgVGhlIGFjY3VtdWxhdGVkIHZhbHVlIHByZXZpb3VzbHkgcmV0dXJuZWQgaW4gdGhlIGxhc3QgaW52b2NhdGlvblxuICogb2YgdGhlIGNhbGxiYWNrLCBvciBpbml0aWFsVmFsdWUsIGlmIHN1cHBsaWVkLlxuICogQHBhcmFtIHtGZWF0dXJlPExpbmVTdHJpbmc+fSBjdXJyZW50U2VnbWVudCBUaGUgY3VycmVudCBTZWdtZW50IGJlaW5nIHByb2Nlc3NlZC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBmZWF0dXJlSW5kZXggVGhlIGN1cnJlbnQgaW5kZXggb2YgdGhlIEZlYXR1cmUgYmVpbmcgcHJvY2Vzc2VkLlxuICogQHBhcmFtIHtudW1iZXJ9IG11bHRpRmVhdHVyZUluZGV4IFRoZSBjdXJyZW50IGluZGV4IG9mIHRoZSBNdWx0aS1GZWF0dXJlIGJlaW5nIHByb2Nlc3NlZC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBnZW9tZXRyeUluZGV4IFRoZSBjdXJyZW50IGluZGV4IG9mIHRoZSBHZW9tZXRyeSBiZWluZyBwcm9jZXNzZWQuXG4gKiBAcGFyYW0ge251bWJlcn0gc2VnbWVudEluZGV4IFRoZSBjdXJyZW50IGluZGV4IG9mIHRoZSBTZWdtZW50IGJlaW5nIHByb2Nlc3NlZC5cbiAqL1xuXG4vKipcbiAqIFJlZHVjZSAyLXZlcnRleCBsaW5lIHNlZ21lbnQgaW4gYW55IEdlb0pTT04gb2JqZWN0LCBzaW1pbGFyIHRvIEFycmF5LnJlZHVjZSgpXG4gKiAoTXVsdGkpUG9pbnQgZ2VvbWV0cmllcyBkbyBub3QgY29udGFpbiBzZWdtZW50cyB0aGVyZWZvcmUgdGhleSBhcmUgaWdub3JlZCBkdXJpbmcgdGhpcyBvcGVyYXRpb24uXG4gKlxuICogQHBhcmFtIHtGZWF0dXJlQ29sbGVjdGlvbnxGZWF0dXJlfEdlb21ldHJ5fSBnZW9qc29uIGFueSBHZW9KU09OXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBhIG1ldGhvZCB0aGF0IHRha2VzIChwcmV2aW91c1ZhbHVlLCBjdXJyZW50U2VnbWVudCwgY3VycmVudEluZGV4KVxuICogQHBhcmFtIHsqfSBbaW5pdGlhbFZhbHVlXSBWYWx1ZSB0byB1c2UgYXMgdGhlIGZpcnN0IGFyZ3VtZW50IHRvIHRoZSBmaXJzdCBjYWxsIG9mIHRoZSBjYWxsYmFjay5cbiAqIEByZXR1cm5zIHt2b2lkfVxuICogQGV4YW1wbGVcbiAqIHZhciBwb2x5Z29uID0gdHVyZi5wb2x5Z29uKFtbWy01MCwgNV0sIFstNDAsIC0xMF0sIFstNTAsIC0xMF0sIFstNDAsIDVdLCBbLTUwLCA1XV1dKTtcbiAqXG4gKiAvLyBJdGVyYXRlIG92ZXIgR2VvSlNPTiBieSAyLXZlcnRleCBzZWdtZW50c1xuICogdHVyZi5zZWdtZW50UmVkdWNlKHBvbHlnb24sIGZ1bmN0aW9uIChwcmV2aW91c1NlZ21lbnQsIGN1cnJlbnRTZWdtZW50LCBmZWF0dXJlSW5kZXgsIG11bHRpRmVhdHVyZUluZGV4LCBnZW9tZXRyeUluZGV4LCBzZWdtZW50SW5kZXgpIHtcbiAqICAgLy89IHByZXZpb3VzU2VnbWVudFxuICogICAvLz0gY3VycmVudFNlZ21lbnRcbiAqICAgLy89IGZlYXR1cmVJbmRleFxuICogICAvLz0gbXVsdGlGZWF0dXJlSW5kZXhcbiAqICAgLy89IGdlb21ldHJ5SW5kZXhcbiAqICAgLy89IHNlZ21lbnRJbmRleFxuICogICByZXR1cm4gY3VycmVudFNlZ21lbnRcbiAqIH0pO1xuICpcbiAqIC8vIENhbGN1bGF0ZSB0aGUgdG90YWwgbnVtYmVyIG9mIHNlZ21lbnRzXG4gKiB2YXIgaW5pdGlhbFZhbHVlID0gMFxuICogdmFyIHRvdGFsID0gdHVyZi5zZWdtZW50UmVkdWNlKHBvbHlnb24sIGZ1bmN0aW9uIChwcmV2aW91c1ZhbHVlKSB7XG4gKiAgICAgcHJldmlvdXNWYWx1ZSsrO1xuICogICAgIHJldHVybiBwcmV2aW91c1ZhbHVlO1xuICogfSwgaW5pdGlhbFZhbHVlKTtcbiAqL1xuZnVuY3Rpb24gc2VnbWVudFJlZHVjZShnZW9qc29uLCBjYWxsYmFjaywgaW5pdGlhbFZhbHVlKSB7XG4gIHZhciBwcmV2aW91c1ZhbHVlID0gaW5pdGlhbFZhbHVlO1xuICB2YXIgc3RhcnRlZCA9IGZhbHNlO1xuICBzZWdtZW50RWFjaChcbiAgICBnZW9qc29uLFxuICAgIGZ1bmN0aW9uIChcbiAgICAgIGN1cnJlbnRTZWdtZW50LFxuICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgbXVsdGlGZWF0dXJlSW5kZXgsXG4gICAgICBnZW9tZXRyeUluZGV4LFxuICAgICAgc2VnbWVudEluZGV4XG4gICAgKSB7XG4gICAgICBpZiAoc3RhcnRlZCA9PT0gZmFsc2UgJiYgaW5pdGlhbFZhbHVlID09PSB1bmRlZmluZWQpXG4gICAgICAgIHByZXZpb3VzVmFsdWUgPSBjdXJyZW50U2VnbWVudDtcbiAgICAgIGVsc2VcbiAgICAgICAgcHJldmlvdXNWYWx1ZSA9IGNhbGxiYWNrKFxuICAgICAgICAgIHByZXZpb3VzVmFsdWUsXG4gICAgICAgICAgY3VycmVudFNlZ21lbnQsXG4gICAgICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgICAgIG11bHRpRmVhdHVyZUluZGV4LFxuICAgICAgICAgIGdlb21ldHJ5SW5kZXgsXG4gICAgICAgICAgc2VnbWVudEluZGV4XG4gICAgICAgICk7XG4gICAgICBzdGFydGVkID0gdHJ1ZTtcbiAgICB9XG4gICk7XG4gIHJldHVybiBwcmV2aW91c1ZhbHVlO1xufVxuXG4vKipcbiAqIENhbGxiYWNrIGZvciBsaW5lRWFjaFxuICpcbiAqIEBjYWxsYmFjayBsaW5lRWFjaENhbGxiYWNrXG4gKiBAcGFyYW0ge0ZlYXR1cmU8TGluZVN0cmluZz59IGN1cnJlbnRMaW5lIFRoZSBjdXJyZW50IExpbmVTdHJpbmd8TGluZWFyUmluZyBiZWluZyBwcm9jZXNzZWRcbiAqIEBwYXJhbSB7bnVtYmVyfSBmZWF0dXJlSW5kZXggVGhlIGN1cnJlbnQgaW5kZXggb2YgdGhlIEZlYXR1cmUgYmVpbmcgcHJvY2Vzc2VkXG4gKiBAcGFyYW0ge251bWJlcn0gbXVsdGlGZWF0dXJlSW5kZXggVGhlIGN1cnJlbnQgaW5kZXggb2YgdGhlIE11bHRpLUZlYXR1cmUgYmVpbmcgcHJvY2Vzc2VkXG4gKiBAcGFyYW0ge251bWJlcn0gZ2VvbWV0cnlJbmRleCBUaGUgY3VycmVudCBpbmRleCBvZiB0aGUgR2VvbWV0cnkgYmVpbmcgcHJvY2Vzc2VkXG4gKi9cblxuLyoqXG4gKiBJdGVyYXRlIG92ZXIgbGluZSBvciByaW5nIGNvb3JkaW5hdGVzIGluIExpbmVTdHJpbmcsIFBvbHlnb24sIE11bHRpTGluZVN0cmluZywgTXVsdGlQb2x5Z29uIEZlYXR1cmVzIG9yIEdlb21ldHJpZXMsXG4gKiBzaW1pbGFyIHRvIEFycmF5LmZvckVhY2guXG4gKlxuICogQG5hbWUgbGluZUVhY2hcbiAqIEBwYXJhbSB7R2VvbWV0cnl8RmVhdHVyZTxMaW5lU3RyaW5nfFBvbHlnb258TXVsdGlMaW5lU3RyaW5nfE11bHRpUG9seWdvbj59IGdlb2pzb24gb2JqZWN0XG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBhIG1ldGhvZCB0aGF0IHRha2VzIChjdXJyZW50TGluZSwgZmVhdHVyZUluZGV4LCBtdWx0aUZlYXR1cmVJbmRleCwgZ2VvbWV0cnlJbmRleClcbiAqIEBleGFtcGxlXG4gKiB2YXIgbXVsdGlMaW5lID0gdHVyZi5tdWx0aUxpbmVTdHJpbmcoW1xuICogICBbWzI2LCAzN10sIFszNSwgNDVdXSxcbiAqICAgW1szNiwgNTNdLCBbMzgsIDUwXSwgWzQxLCA1NV1dXG4gKiBdKTtcbiAqXG4gKiB0dXJmLmxpbmVFYWNoKG11bHRpTGluZSwgZnVuY3Rpb24gKGN1cnJlbnRMaW5lLCBmZWF0dXJlSW5kZXgsIG11bHRpRmVhdHVyZUluZGV4LCBnZW9tZXRyeUluZGV4KSB7XG4gKiAgIC8vPWN1cnJlbnRMaW5lXG4gKiAgIC8vPWZlYXR1cmVJbmRleFxuICogICAvLz1tdWx0aUZlYXR1cmVJbmRleFxuICogICAvLz1nZW9tZXRyeUluZGV4XG4gKiB9KTtcbiAqL1xuZnVuY3Rpb24gbGluZUVhY2goZ2VvanNvbiwgY2FsbGJhY2spIHtcbiAgLy8gdmFsaWRhdGlvblxuICBpZiAoIWdlb2pzb24pIHRocm93IG5ldyBFcnJvcihcImdlb2pzb24gaXMgcmVxdWlyZWRcIik7XG5cbiAgZmxhdHRlbkVhY2goZ2VvanNvbiwgZnVuY3Rpb24gKGZlYXR1cmUkJDEsIGZlYXR1cmVJbmRleCwgbXVsdGlGZWF0dXJlSW5kZXgpIHtcbiAgICBpZiAoZmVhdHVyZSQkMS5nZW9tZXRyeSA9PT0gbnVsbCkgcmV0dXJuO1xuICAgIHZhciB0eXBlID0gZmVhdHVyZSQkMS5nZW9tZXRyeS50eXBlO1xuICAgIHZhciBjb29yZHMgPSBmZWF0dXJlJCQxLmdlb21ldHJ5LmNvb3JkaW5hdGVzO1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSBcIkxpbmVTdHJpbmdcIjpcbiAgICAgICAgaWYgKGNhbGxiYWNrKGZlYXR1cmUkJDEsIGZlYXR1cmVJbmRleCwgbXVsdGlGZWF0dXJlSW5kZXgsIDAsIDApID09PSBmYWxzZSlcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIlBvbHlnb25cIjpcbiAgICAgICAgZm9yIChcbiAgICAgICAgICB2YXIgZ2VvbWV0cnlJbmRleCA9IDA7XG4gICAgICAgICAgZ2VvbWV0cnlJbmRleCA8IGNvb3Jkcy5sZW5ndGg7XG4gICAgICAgICAgZ2VvbWV0cnlJbmRleCsrXG4gICAgICAgICkge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIGNhbGxiYWNrKFxuICAgICAgICAgICAgICBsaW5lU3RyaW5nKGNvb3Jkc1tnZW9tZXRyeUluZGV4XSwgZmVhdHVyZSQkMS5wcm9wZXJ0aWVzKSxcbiAgICAgICAgICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgICAgICAgICBtdWx0aUZlYXR1cmVJbmRleCxcbiAgICAgICAgICAgICAgZ2VvbWV0cnlJbmRleFxuICAgICAgICAgICAgKSA9PT0gZmFsc2VcbiAgICAgICAgICApXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBDYWxsYmFjayBmb3IgbGluZVJlZHVjZVxuICpcbiAqIFRoZSBmaXJzdCB0aW1lIHRoZSBjYWxsYmFjayBmdW5jdGlvbiBpcyBjYWxsZWQsIHRoZSB2YWx1ZXMgcHJvdmlkZWQgYXMgYXJndW1lbnRzIGRlcGVuZFxuICogb24gd2hldGhlciB0aGUgcmVkdWNlIG1ldGhvZCBoYXMgYW4gaW5pdGlhbFZhbHVlIGFyZ3VtZW50LlxuICpcbiAqIElmIGFuIGluaXRpYWxWYWx1ZSBpcyBwcm92aWRlZCB0byB0aGUgcmVkdWNlIG1ldGhvZDpcbiAqICAtIFRoZSBwcmV2aW91c1ZhbHVlIGFyZ3VtZW50IGlzIGluaXRpYWxWYWx1ZS5cbiAqICAtIFRoZSBjdXJyZW50VmFsdWUgYXJndW1lbnQgaXMgdGhlIHZhbHVlIG9mIHRoZSBmaXJzdCBlbGVtZW50IHByZXNlbnQgaW4gdGhlIGFycmF5LlxuICpcbiAqIElmIGFuIGluaXRpYWxWYWx1ZSBpcyBub3QgcHJvdmlkZWQ6XG4gKiAgLSBUaGUgcHJldmlvdXNWYWx1ZSBhcmd1bWVudCBpcyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IGVsZW1lbnQgcHJlc2VudCBpbiB0aGUgYXJyYXkuXG4gKiAgLSBUaGUgY3VycmVudFZhbHVlIGFyZ3VtZW50IGlzIHRoZSB2YWx1ZSBvZiB0aGUgc2Vjb25kIGVsZW1lbnQgcHJlc2VudCBpbiB0aGUgYXJyYXkuXG4gKlxuICogQGNhbGxiYWNrIGxpbmVSZWR1Y2VDYWxsYmFja1xuICogQHBhcmFtIHsqfSBwcmV2aW91c1ZhbHVlIFRoZSBhY2N1bXVsYXRlZCB2YWx1ZSBwcmV2aW91c2x5IHJldHVybmVkIGluIHRoZSBsYXN0IGludm9jYXRpb25cbiAqIG9mIHRoZSBjYWxsYmFjaywgb3IgaW5pdGlhbFZhbHVlLCBpZiBzdXBwbGllZC5cbiAqIEBwYXJhbSB7RmVhdHVyZTxMaW5lU3RyaW5nPn0gY3VycmVudExpbmUgVGhlIGN1cnJlbnQgTGluZVN0cmluZ3xMaW5lYXJSaW5nIGJlaW5nIHByb2Nlc3NlZC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBmZWF0dXJlSW5kZXggVGhlIGN1cnJlbnQgaW5kZXggb2YgdGhlIEZlYXR1cmUgYmVpbmcgcHJvY2Vzc2VkXG4gKiBAcGFyYW0ge251bWJlcn0gbXVsdGlGZWF0dXJlSW5kZXggVGhlIGN1cnJlbnQgaW5kZXggb2YgdGhlIE11bHRpLUZlYXR1cmUgYmVpbmcgcHJvY2Vzc2VkXG4gKiBAcGFyYW0ge251bWJlcn0gZ2VvbWV0cnlJbmRleCBUaGUgY3VycmVudCBpbmRleCBvZiB0aGUgR2VvbWV0cnkgYmVpbmcgcHJvY2Vzc2VkXG4gKi9cblxuLyoqXG4gKiBSZWR1Y2UgZmVhdHVyZXMgaW4gYW55IEdlb0pTT04gb2JqZWN0LCBzaW1pbGFyIHRvIEFycmF5LnJlZHVjZSgpLlxuICpcbiAqIEBuYW1lIGxpbmVSZWR1Y2VcbiAqIEBwYXJhbSB7R2VvbWV0cnl8RmVhdHVyZTxMaW5lU3RyaW5nfFBvbHlnb258TXVsdGlMaW5lU3RyaW5nfE11bHRpUG9seWdvbj59IGdlb2pzb24gb2JqZWN0XG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBhIG1ldGhvZCB0aGF0IHRha2VzIChwcmV2aW91c1ZhbHVlLCBjdXJyZW50TGluZSwgZmVhdHVyZUluZGV4LCBtdWx0aUZlYXR1cmVJbmRleCwgZ2VvbWV0cnlJbmRleClcbiAqIEBwYXJhbSB7Kn0gW2luaXRpYWxWYWx1ZV0gVmFsdWUgdG8gdXNlIGFzIHRoZSBmaXJzdCBhcmd1bWVudCB0byB0aGUgZmlyc3QgY2FsbCBvZiB0aGUgY2FsbGJhY2suXG4gKiBAcmV0dXJucyB7Kn0gVGhlIHZhbHVlIHRoYXQgcmVzdWx0cyBmcm9tIHRoZSByZWR1Y3Rpb24uXG4gKiBAZXhhbXBsZVxuICogdmFyIG11bHRpUG9seSA9IHR1cmYubXVsdGlQb2x5Z29uKFtcbiAqICAgdHVyZi5wb2x5Z29uKFtbWzEyLDQ4XSxbMiw0MV0sWzI0LDM4XSxbMTIsNDhdXSwgW1s5LDQ0XSxbMTMsNDFdLFsxMyw0NV0sWzksNDRdXV0pLFxuICogICB0dXJmLnBvbHlnb24oW1tbNSwgNV0sIFswLCAwXSwgWzIsIDJdLCBbNCwgNF0sIFs1LCA1XV1dKVxuICogXSk7XG4gKlxuICogdHVyZi5saW5lUmVkdWNlKG11bHRpUG9seSwgZnVuY3Rpb24gKHByZXZpb3VzVmFsdWUsIGN1cnJlbnRMaW5lLCBmZWF0dXJlSW5kZXgsIG11bHRpRmVhdHVyZUluZGV4LCBnZW9tZXRyeUluZGV4KSB7XG4gKiAgIC8vPXByZXZpb3VzVmFsdWVcbiAqICAgLy89Y3VycmVudExpbmVcbiAqICAgLy89ZmVhdHVyZUluZGV4XG4gKiAgIC8vPW11bHRpRmVhdHVyZUluZGV4XG4gKiAgIC8vPWdlb21ldHJ5SW5kZXhcbiAqICAgcmV0dXJuIGN1cnJlbnRMaW5lXG4gKiB9KTtcbiAqL1xuZnVuY3Rpb24gbGluZVJlZHVjZShnZW9qc29uLCBjYWxsYmFjaywgaW5pdGlhbFZhbHVlKSB7XG4gIHZhciBwcmV2aW91c1ZhbHVlID0gaW5pdGlhbFZhbHVlO1xuICBsaW5lRWFjaChcbiAgICBnZW9qc29uLFxuICAgIGZ1bmN0aW9uIChjdXJyZW50TGluZSwgZmVhdHVyZUluZGV4LCBtdWx0aUZlYXR1cmVJbmRleCwgZ2VvbWV0cnlJbmRleCkge1xuICAgICAgaWYgKGZlYXR1cmVJbmRleCA9PT0gMCAmJiBpbml0aWFsVmFsdWUgPT09IHVuZGVmaW5lZClcbiAgICAgICAgcHJldmlvdXNWYWx1ZSA9IGN1cnJlbnRMaW5lO1xuICAgICAgZWxzZVxuICAgICAgICBwcmV2aW91c1ZhbHVlID0gY2FsbGJhY2soXG4gICAgICAgICAgcHJldmlvdXNWYWx1ZSxcbiAgICAgICAgICBjdXJyZW50TGluZSxcbiAgICAgICAgICBmZWF0dXJlSW5kZXgsXG4gICAgICAgICAgbXVsdGlGZWF0dXJlSW5kZXgsXG4gICAgICAgICAgZ2VvbWV0cnlJbmRleFxuICAgICAgICApO1xuICAgIH1cbiAgKTtcbiAgcmV0dXJuIHByZXZpb3VzVmFsdWU7XG59XG5cbi8qKlxuICogRmluZHMgYSBwYXJ0aWN1bGFyIDItdmVydGV4IExpbmVTdHJpbmcgU2VnbWVudCBmcm9tIGEgR2VvSlNPTiB1c2luZyBgQHR1cmYvbWV0YWAgaW5kZXhlcy5cbiAqXG4gKiBOZWdhdGl2ZSBpbmRleGVzIGFyZSBwZXJtaXR0ZWQuXG4gKiBQb2ludCAmIE11bHRpUG9pbnQgd2lsbCBhbHdheXMgcmV0dXJuIG51bGwuXG4gKlxuICogQHBhcmFtIHtGZWF0dXJlQ29sbGVjdGlvbnxGZWF0dXJlfEdlb21ldHJ5fSBnZW9qc29uIEFueSBHZW9KU09OIEZlYXR1cmUgb3IgR2VvbWV0cnlcbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz17fV0gT3B0aW9uYWwgcGFyYW1ldGVyc1xuICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLmZlYXR1cmVJbmRleD0wXSBGZWF0dXJlIEluZGV4XG4gKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMubXVsdGlGZWF0dXJlSW5kZXg9MF0gTXVsdGktRmVhdHVyZSBJbmRleFxuICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLmdlb21ldHJ5SW5kZXg9MF0gR2VvbWV0cnkgSW5kZXhcbiAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5zZWdtZW50SW5kZXg9MF0gU2VnbWVudCBJbmRleFxuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLnByb3BlcnRpZXM9e31dIFRyYW5zbGF0ZSBQcm9wZXJ0aWVzIHRvIG91dHB1dCBMaW5lU3RyaW5nXG4gKiBAcGFyYW0ge0JCb3h9IFtvcHRpb25zLmJib3g9e31dIFRyYW5zbGF0ZSBCQm94IHRvIG91dHB1dCBMaW5lU3RyaW5nXG4gKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IFtvcHRpb25zLmlkPXt9XSBUcmFuc2xhdGUgSWQgdG8gb3V0cHV0IExpbmVTdHJpbmdcbiAqIEByZXR1cm5zIHtGZWF0dXJlPExpbmVTdHJpbmc+fSAyLXZlcnRleCBHZW9KU09OIEZlYXR1cmUgTGluZVN0cmluZ1xuICogQGV4YW1wbGVcbiAqIHZhciBtdWx0aUxpbmUgPSB0dXJmLm11bHRpTGluZVN0cmluZyhbXG4gKiAgICAgW1sxMCwgMTBdLCBbNTAsIDMwXSwgWzMwLCA0MF1dLFxuICogICAgIFtbLTEwLCAtMTBdLCBbLTUwLCAtMzBdLCBbLTMwLCAtNDBdXVxuICogXSk7XG4gKlxuICogLy8gRmlyc3QgU2VnbWVudCAoZGVmYXVsdHMgYXJlIDApXG4gKiB0dXJmLmZpbmRTZWdtZW50KG11bHRpTGluZSk7XG4gKiAvLyA9PiBGZWF0dXJlPExpbmVTdHJpbmc8W1sxMCwgMTBdLCBbNTAsIDMwXV0+PlxuICpcbiAqIC8vIEZpcnN0IFNlZ21lbnQgb2YgMm5kIE11bHRpIEZlYXR1cmVcbiAqIHR1cmYuZmluZFNlZ21lbnQobXVsdGlMaW5lLCB7bXVsdGlGZWF0dXJlSW5kZXg6IDF9KTtcbiAqIC8vID0+IEZlYXR1cmU8TGluZVN0cmluZzxbWy0xMCwgLTEwXSwgWy01MCwgLTMwXV0+PlxuICpcbiAqIC8vIExhc3QgU2VnbWVudCBvZiBMYXN0IE11bHRpIEZlYXR1cmVcbiAqIHR1cmYuZmluZFNlZ21lbnQobXVsdGlMaW5lLCB7bXVsdGlGZWF0dXJlSW5kZXg6IC0xLCBzZWdtZW50SW5kZXg6IC0xfSk7XG4gKiAvLyA9PiBGZWF0dXJlPExpbmVTdHJpbmc8W1stNTAsIC0zMF0sIFstMzAsIC00MF1dPj5cbiAqL1xuZnVuY3Rpb24gZmluZFNlZ21lbnQoZ2VvanNvbiwgb3B0aW9ucykge1xuICAvLyBPcHRpb25hbCBQYXJhbWV0ZXJzXG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICBpZiAoIWlzT2JqZWN0KG9wdGlvbnMpKSB0aHJvdyBuZXcgRXJyb3IoXCJvcHRpb25zIGlzIGludmFsaWRcIik7XG4gIHZhciBmZWF0dXJlSW5kZXggPSBvcHRpb25zLmZlYXR1cmVJbmRleCB8fCAwO1xuICB2YXIgbXVsdGlGZWF0dXJlSW5kZXggPSBvcHRpb25zLm11bHRpRmVhdHVyZUluZGV4IHx8IDA7XG4gIHZhciBnZW9tZXRyeUluZGV4ID0gb3B0aW9ucy5nZW9tZXRyeUluZGV4IHx8IDA7XG4gIHZhciBzZWdtZW50SW5kZXggPSBvcHRpb25zLnNlZ21lbnRJbmRleCB8fCAwO1xuXG4gIC8vIEZpbmQgRmVhdHVyZUluZGV4XG4gIHZhciBwcm9wZXJ0aWVzID0gb3B0aW9ucy5wcm9wZXJ0aWVzO1xuICB2YXIgZ2VvbWV0cnk7XG5cbiAgc3dpdGNoIChnZW9qc29uLnR5cGUpIHtcbiAgICBjYXNlIFwiRmVhdHVyZUNvbGxlY3Rpb25cIjpcbiAgICAgIGlmIChmZWF0dXJlSW5kZXggPCAwKVxuICAgICAgICBmZWF0dXJlSW5kZXggPSBnZW9qc29uLmZlYXR1cmVzLmxlbmd0aCArIGZlYXR1cmVJbmRleDtcbiAgICAgIHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzIHx8IGdlb2pzb24uZmVhdHVyZXNbZmVhdHVyZUluZGV4XS5wcm9wZXJ0aWVzO1xuICAgICAgZ2VvbWV0cnkgPSBnZW9qc29uLmZlYXR1cmVzW2ZlYXR1cmVJbmRleF0uZ2VvbWV0cnk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwiRmVhdHVyZVwiOlxuICAgICAgcHJvcGVydGllcyA9IHByb3BlcnRpZXMgfHwgZ2VvanNvbi5wcm9wZXJ0aWVzO1xuICAgICAgZ2VvbWV0cnkgPSBnZW9qc29uLmdlb21ldHJ5O1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBcIlBvaW50XCI6XG4gICAgY2FzZSBcIk11bHRpUG9pbnRcIjpcbiAgICAgIHJldHVybiBudWxsO1xuICAgIGNhc2UgXCJMaW5lU3RyaW5nXCI6XG4gICAgY2FzZSBcIlBvbHlnb25cIjpcbiAgICBjYXNlIFwiTXVsdGlMaW5lU3RyaW5nXCI6XG4gICAgY2FzZSBcIk11bHRpUG9seWdvblwiOlxuICAgICAgZ2VvbWV0cnkgPSBnZW9qc29uO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihcImdlb2pzb24gaXMgaW52YWxpZFwiKTtcbiAgfVxuXG4gIC8vIEZpbmQgU2VnbWVudEluZGV4XG4gIGlmIChnZW9tZXRyeSA9PT0gbnVsbCkgcmV0dXJuIG51bGw7XG4gIHZhciBjb29yZHMgPSBnZW9tZXRyeS5jb29yZGluYXRlcztcbiAgc3dpdGNoIChnZW9tZXRyeS50eXBlKSB7XG4gICAgY2FzZSBcIlBvaW50XCI6XG4gICAgY2FzZSBcIk11bHRpUG9pbnRcIjpcbiAgICAgIHJldHVybiBudWxsO1xuICAgIGNhc2UgXCJMaW5lU3RyaW5nXCI6XG4gICAgICBpZiAoc2VnbWVudEluZGV4IDwgMCkgc2VnbWVudEluZGV4ID0gY29vcmRzLmxlbmd0aCArIHNlZ21lbnRJbmRleCAtIDE7XG4gICAgICByZXR1cm4gbGluZVN0cmluZyhcbiAgICAgICAgW2Nvb3Jkc1tzZWdtZW50SW5kZXhdLCBjb29yZHNbc2VnbWVudEluZGV4ICsgMV1dLFxuICAgICAgICBwcm9wZXJ0aWVzLFxuICAgICAgICBvcHRpb25zXG4gICAgICApO1xuICAgIGNhc2UgXCJQb2x5Z29uXCI6XG4gICAgICBpZiAoZ2VvbWV0cnlJbmRleCA8IDApIGdlb21ldHJ5SW5kZXggPSBjb29yZHMubGVuZ3RoICsgZ2VvbWV0cnlJbmRleDtcbiAgICAgIGlmIChzZWdtZW50SW5kZXggPCAwKVxuICAgICAgICBzZWdtZW50SW5kZXggPSBjb29yZHNbZ2VvbWV0cnlJbmRleF0ubGVuZ3RoICsgc2VnbWVudEluZGV4IC0gMTtcbiAgICAgIHJldHVybiBsaW5lU3RyaW5nKFxuICAgICAgICBbXG4gICAgICAgICAgY29vcmRzW2dlb21ldHJ5SW5kZXhdW3NlZ21lbnRJbmRleF0sXG4gICAgICAgICAgY29vcmRzW2dlb21ldHJ5SW5kZXhdW3NlZ21lbnRJbmRleCArIDFdLFxuICAgICAgICBdLFxuICAgICAgICBwcm9wZXJ0aWVzLFxuICAgICAgICBvcHRpb25zXG4gICAgICApO1xuICAgIGNhc2UgXCJNdWx0aUxpbmVTdHJpbmdcIjpcbiAgICAgIGlmIChtdWx0aUZlYXR1cmVJbmRleCA8IDApXG4gICAgICAgIG11bHRpRmVhdHVyZUluZGV4ID0gY29vcmRzLmxlbmd0aCArIG11bHRpRmVhdHVyZUluZGV4O1xuICAgICAgaWYgKHNlZ21lbnRJbmRleCA8IDApXG4gICAgICAgIHNlZ21lbnRJbmRleCA9IGNvb3Jkc1ttdWx0aUZlYXR1cmVJbmRleF0ubGVuZ3RoICsgc2VnbWVudEluZGV4IC0gMTtcbiAgICAgIHJldHVybiBsaW5lU3RyaW5nKFxuICAgICAgICBbXG4gICAgICAgICAgY29vcmRzW211bHRpRmVhdHVyZUluZGV4XVtzZWdtZW50SW5kZXhdLFxuICAgICAgICAgIGNvb3Jkc1ttdWx0aUZlYXR1cmVJbmRleF1bc2VnbWVudEluZGV4ICsgMV0sXG4gICAgICAgIF0sXG4gICAgICAgIHByb3BlcnRpZXMsXG4gICAgICAgIG9wdGlvbnNcbiAgICAgICk7XG4gICAgY2FzZSBcIk11bHRpUG9seWdvblwiOlxuICAgICAgaWYgKG11bHRpRmVhdHVyZUluZGV4IDwgMClcbiAgICAgICAgbXVsdGlGZWF0dXJlSW5kZXggPSBjb29yZHMubGVuZ3RoICsgbXVsdGlGZWF0dXJlSW5kZXg7XG4gICAgICBpZiAoZ2VvbWV0cnlJbmRleCA8IDApXG4gICAgICAgIGdlb21ldHJ5SW5kZXggPSBjb29yZHNbbXVsdGlGZWF0dXJlSW5kZXhdLmxlbmd0aCArIGdlb21ldHJ5SW5kZXg7XG4gICAgICBpZiAoc2VnbWVudEluZGV4IDwgMClcbiAgICAgICAgc2VnbWVudEluZGV4ID1cbiAgICAgICAgICBjb29yZHNbbXVsdGlGZWF0dXJlSW5kZXhdW2dlb21ldHJ5SW5kZXhdLmxlbmd0aCAtIHNlZ21lbnRJbmRleCAtIDE7XG4gICAgICByZXR1cm4gbGluZVN0cmluZyhcbiAgICAgICAgW1xuICAgICAgICAgIGNvb3Jkc1ttdWx0aUZlYXR1cmVJbmRleF1bZ2VvbWV0cnlJbmRleF1bc2VnbWVudEluZGV4XSxcbiAgICAgICAgICBjb29yZHNbbXVsdGlGZWF0dXJlSW5kZXhdW2dlb21ldHJ5SW5kZXhdW3NlZ21lbnRJbmRleCArIDFdLFxuICAgICAgICBdLFxuICAgICAgICBwcm9wZXJ0aWVzLFxuICAgICAgICBvcHRpb25zXG4gICAgICApO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihcImdlb2pzb24gaXMgaW52YWxpZFwiKTtcbn1cblxuLyoqXG4gKiBGaW5kcyBhIHBhcnRpY3VsYXIgUG9pbnQgZnJvbSBhIEdlb0pTT04gdXNpbmcgYEB0dXJmL21ldGFgIGluZGV4ZXMuXG4gKlxuICogTmVnYXRpdmUgaW5kZXhlcyBhcmUgcGVybWl0dGVkLlxuICpcbiAqIEBwYXJhbSB7RmVhdHVyZUNvbGxlY3Rpb258RmVhdHVyZXxHZW9tZXRyeX0gZ2VvanNvbiBBbnkgR2VvSlNPTiBGZWF0dXJlIG9yIEdlb21ldHJ5XG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnM9e31dIE9wdGlvbmFsIHBhcmFtZXRlcnNcbiAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5mZWF0dXJlSW5kZXg9MF0gRmVhdHVyZSBJbmRleFxuICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLm11bHRpRmVhdHVyZUluZGV4PTBdIE11bHRpLUZlYXR1cmUgSW5kZXhcbiAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5nZW9tZXRyeUluZGV4PTBdIEdlb21ldHJ5IEluZGV4XG4gKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMuY29vcmRJbmRleD0wXSBDb29yZCBJbmRleFxuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLnByb3BlcnRpZXM9e31dIFRyYW5zbGF0ZSBQcm9wZXJ0aWVzIHRvIG91dHB1dCBQb2ludFxuICogQHBhcmFtIHtCQm94fSBbb3B0aW9ucy5iYm94PXt9XSBUcmFuc2xhdGUgQkJveCB0byBvdXRwdXQgUG9pbnRcbiAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30gW29wdGlvbnMuaWQ9e31dIFRyYW5zbGF0ZSBJZCB0byBvdXRwdXQgUG9pbnRcbiAqIEByZXR1cm5zIHtGZWF0dXJlPFBvaW50Pn0gMi12ZXJ0ZXggR2VvSlNPTiBGZWF0dXJlIFBvaW50XG4gKiBAZXhhbXBsZVxuICogdmFyIG11bHRpTGluZSA9IHR1cmYubXVsdGlMaW5lU3RyaW5nKFtcbiAqICAgICBbWzEwLCAxMF0sIFs1MCwgMzBdLCBbMzAsIDQwXV0sXG4gKiAgICAgW1stMTAsIC0xMF0sIFstNTAsIC0zMF0sIFstMzAsIC00MF1dXG4gKiBdKTtcbiAqXG4gKiAvLyBGaXJzdCBTZWdtZW50IChkZWZhdWx0cyBhcmUgMClcbiAqIHR1cmYuZmluZFBvaW50KG11bHRpTGluZSk7XG4gKiAvLyA9PiBGZWF0dXJlPFBvaW50PFsxMCwgMTBdPj5cbiAqXG4gKiAvLyBGaXJzdCBTZWdtZW50IG9mIHRoZSAybmQgTXVsdGktRmVhdHVyZVxuICogdHVyZi5maW5kUG9pbnQobXVsdGlMaW5lLCB7bXVsdGlGZWF0dXJlSW5kZXg6IDF9KTtcbiAqIC8vID0+IEZlYXR1cmU8UG9pbnQ8Wy0xMCwgLTEwXT4+XG4gKlxuICogLy8gTGFzdCBTZWdtZW50IG9mIGxhc3QgTXVsdGktRmVhdHVyZVxuICogdHVyZi5maW5kUG9pbnQobXVsdGlMaW5lLCB7bXVsdGlGZWF0dXJlSW5kZXg6IC0xLCBjb29yZEluZGV4OiAtMX0pO1xuICogLy8gPT4gRmVhdHVyZTxQb2ludDxbLTMwLCAtNDBdPj5cbiAqL1xuZnVuY3Rpb24gZmluZFBvaW50KGdlb2pzb24sIG9wdGlvbnMpIHtcbiAgLy8gT3B0aW9uYWwgUGFyYW1ldGVyc1xuICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgaWYgKCFpc09iamVjdChvcHRpb25zKSkgdGhyb3cgbmV3IEVycm9yKFwib3B0aW9ucyBpcyBpbnZhbGlkXCIpO1xuICB2YXIgZmVhdHVyZUluZGV4ID0gb3B0aW9ucy5mZWF0dXJlSW5kZXggfHwgMDtcbiAgdmFyIG11bHRpRmVhdHVyZUluZGV4ID0gb3B0aW9ucy5tdWx0aUZlYXR1cmVJbmRleCB8fCAwO1xuICB2YXIgZ2VvbWV0cnlJbmRleCA9IG9wdGlvbnMuZ2VvbWV0cnlJbmRleCB8fCAwO1xuICB2YXIgY29vcmRJbmRleCA9IG9wdGlvbnMuY29vcmRJbmRleCB8fCAwO1xuXG4gIC8vIEZpbmQgRmVhdHVyZUluZGV4XG4gIHZhciBwcm9wZXJ0aWVzID0gb3B0aW9ucy5wcm9wZXJ0aWVzO1xuICB2YXIgZ2VvbWV0cnk7XG5cbiAgc3dpdGNoIChnZW9qc29uLnR5cGUpIHtcbiAgICBjYXNlIFwiRmVhdHVyZUNvbGxlY3Rpb25cIjpcbiAgICAgIGlmIChmZWF0dXJlSW5kZXggPCAwKVxuICAgICAgICBmZWF0dXJlSW5kZXggPSBnZW9qc29uLmZlYXR1cmVzLmxlbmd0aCArIGZlYXR1cmVJbmRleDtcbiAgICAgIHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzIHx8IGdlb2pzb24uZmVhdHVyZXNbZmVhdHVyZUluZGV4XS5wcm9wZXJ0aWVzO1xuICAgICAgZ2VvbWV0cnkgPSBnZW9qc29uLmZlYXR1cmVzW2ZlYXR1cmVJbmRleF0uZ2VvbWV0cnk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwiRmVhdHVyZVwiOlxuICAgICAgcHJvcGVydGllcyA9IHByb3BlcnRpZXMgfHwgZ2VvanNvbi5wcm9wZXJ0aWVzO1xuICAgICAgZ2VvbWV0cnkgPSBnZW9qc29uLmdlb21ldHJ5O1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBcIlBvaW50XCI6XG4gICAgY2FzZSBcIk11bHRpUG9pbnRcIjpcbiAgICAgIHJldHVybiBudWxsO1xuICAgIGNhc2UgXCJMaW5lU3RyaW5nXCI6XG4gICAgY2FzZSBcIlBvbHlnb25cIjpcbiAgICBjYXNlIFwiTXVsdGlMaW5lU3RyaW5nXCI6XG4gICAgY2FzZSBcIk11bHRpUG9seWdvblwiOlxuICAgICAgZ2VvbWV0cnkgPSBnZW9qc29uO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihcImdlb2pzb24gaXMgaW52YWxpZFwiKTtcbiAgfVxuXG4gIC8vIEZpbmQgQ29vcmQgSW5kZXhcbiAgaWYgKGdlb21ldHJ5ID09PSBudWxsKSByZXR1cm4gbnVsbDtcbiAgdmFyIGNvb3JkcyA9IGdlb21ldHJ5LmNvb3JkaW5hdGVzO1xuICBzd2l0Y2ggKGdlb21ldHJ5LnR5cGUpIHtcbiAgICBjYXNlIFwiUG9pbnRcIjpcbiAgICAgIHJldHVybiBwb2ludChjb29yZHMsIHByb3BlcnRpZXMsIG9wdGlvbnMpO1xuICAgIGNhc2UgXCJNdWx0aVBvaW50XCI6XG4gICAgICBpZiAobXVsdGlGZWF0dXJlSW5kZXggPCAwKVxuICAgICAgICBtdWx0aUZlYXR1cmVJbmRleCA9IGNvb3Jkcy5sZW5ndGggKyBtdWx0aUZlYXR1cmVJbmRleDtcbiAgICAgIHJldHVybiBwb2ludChjb29yZHNbbXVsdGlGZWF0dXJlSW5kZXhdLCBwcm9wZXJ0aWVzLCBvcHRpb25zKTtcbiAgICBjYXNlIFwiTGluZVN0cmluZ1wiOlxuICAgICAgaWYgKGNvb3JkSW5kZXggPCAwKSBjb29yZEluZGV4ID0gY29vcmRzLmxlbmd0aCArIGNvb3JkSW5kZXg7XG4gICAgICByZXR1cm4gcG9pbnQoY29vcmRzW2Nvb3JkSW5kZXhdLCBwcm9wZXJ0aWVzLCBvcHRpb25zKTtcbiAgICBjYXNlIFwiUG9seWdvblwiOlxuICAgICAgaWYgKGdlb21ldHJ5SW5kZXggPCAwKSBnZW9tZXRyeUluZGV4ID0gY29vcmRzLmxlbmd0aCArIGdlb21ldHJ5SW5kZXg7XG4gICAgICBpZiAoY29vcmRJbmRleCA8IDApXG4gICAgICAgIGNvb3JkSW5kZXggPSBjb29yZHNbZ2VvbWV0cnlJbmRleF0ubGVuZ3RoICsgY29vcmRJbmRleDtcbiAgICAgIHJldHVybiBwb2ludChjb29yZHNbZ2VvbWV0cnlJbmRleF1bY29vcmRJbmRleF0sIHByb3BlcnRpZXMsIG9wdGlvbnMpO1xuICAgIGNhc2UgXCJNdWx0aUxpbmVTdHJpbmdcIjpcbiAgICAgIGlmIChtdWx0aUZlYXR1cmVJbmRleCA8IDApXG4gICAgICAgIG11bHRpRmVhdHVyZUluZGV4ID0gY29vcmRzLmxlbmd0aCArIG11bHRpRmVhdHVyZUluZGV4O1xuICAgICAgaWYgKGNvb3JkSW5kZXggPCAwKVxuICAgICAgICBjb29yZEluZGV4ID0gY29vcmRzW211bHRpRmVhdHVyZUluZGV4XS5sZW5ndGggKyBjb29yZEluZGV4O1xuICAgICAgcmV0dXJuIHBvaW50KGNvb3Jkc1ttdWx0aUZlYXR1cmVJbmRleF1bY29vcmRJbmRleF0sIHByb3BlcnRpZXMsIG9wdGlvbnMpO1xuICAgIGNhc2UgXCJNdWx0aVBvbHlnb25cIjpcbiAgICAgIGlmIChtdWx0aUZlYXR1cmVJbmRleCA8IDApXG4gICAgICAgIG11bHRpRmVhdHVyZUluZGV4ID0gY29vcmRzLmxlbmd0aCArIG11bHRpRmVhdHVyZUluZGV4O1xuICAgICAgaWYgKGdlb21ldHJ5SW5kZXggPCAwKVxuICAgICAgICBnZW9tZXRyeUluZGV4ID0gY29vcmRzW211bHRpRmVhdHVyZUluZGV4XS5sZW5ndGggKyBnZW9tZXRyeUluZGV4O1xuICAgICAgaWYgKGNvb3JkSW5kZXggPCAwKVxuICAgICAgICBjb29yZEluZGV4ID1cbiAgICAgICAgICBjb29yZHNbbXVsdGlGZWF0dXJlSW5kZXhdW2dlb21ldHJ5SW5kZXhdLmxlbmd0aCAtIGNvb3JkSW5kZXg7XG4gICAgICByZXR1cm4gcG9pbnQoXG4gICAgICAgIGNvb3Jkc1ttdWx0aUZlYXR1cmVJbmRleF1bZ2VvbWV0cnlJbmRleF1bY29vcmRJbmRleF0sXG4gICAgICAgIHByb3BlcnRpZXMsXG4gICAgICAgIG9wdGlvbnNcbiAgICAgICk7XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKFwiZ2VvanNvbiBpcyBpbnZhbGlkXCIpO1xufVxuXG5leHBvcnQgeyBjb29yZEVhY2gsIGNvb3JkUmVkdWNlLCBwcm9wRWFjaCwgcHJvcFJlZHVjZSwgZmVhdHVyZUVhY2gsIGZlYXR1cmVSZWR1Y2UsIGNvb3JkQWxsLCBnZW9tRWFjaCwgZ2VvbVJlZHVjZSwgZmxhdHRlbkVhY2gsIGZsYXR0ZW5SZWR1Y2UsIHNlZ21lbnRFYWNoLCBzZWdtZW50UmVkdWNlLCBsaW5lRWFjaCwgbGluZVJlZHVjZSwgZmluZFNlZ21lbnQsIGZpbmRQb2ludCB9O1xuIiwiaW1wb3J0IERyYXdQb2x5Z29uIGZyb20gJ0BtYXBib3gvbWFwYm94LWdsLWRyYXcvc3JjL21vZGVzL2RyYXdfcG9seWdvbic7XG5pbXBvcnQge2dlb2pzb25UeXBlcywgY3Vyc29ycywgdHlwZXMsIHVwZGF0ZUFjdGlvbnMsIG1vZGVzLCBldmVudHN9IGZyb20gJ0BtYXBib3gvbWFwYm94LWdsLWRyYXcvc3JjL2NvbnN0YW50cyc7XG5pbXBvcnQgc2ltcGxpZnkgZnJvbSBcIkB0dXJmL3NpbXBsaWZ5XCI7XG5cbmNvbnN0IEZyZWVoYW5kTW9kZSA9IE9iamVjdC5hc3NpZ24oe30sIERyYXdQb2x5Z29uKVxuXG5GcmVlaGFuZE1vZGUub25TZXR1cCA9IGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IHBvbHlnb24gPSB0aGlzLm5ld0ZlYXR1cmUoe1xuICAgICAgICB0eXBlOiBnZW9qc29uVHlwZXMuRkVBVFVSRSxcbiAgICAgICAgcHJvcGVydGllczoge30sXG4gICAgICAgIGdlb21ldHJ5OiB7XG4gICAgICAgICAgICB0eXBlOiBnZW9qc29uVHlwZXMuUE9MWUdPTixcbiAgICAgICAgICAgIGNvb3JkaW5hdGVzOiBbW11dXG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuYWRkRmVhdHVyZShwb2x5Z29uKTtcbiAgICB0aGlzLmNsZWFyU2VsZWN0ZWRGZWF0dXJlcygpO1xuICAgIFxuICAgIC8vIGRpc2FibGUgZHJhZ1BhblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMubWFwIHx8ICF0aGlzLm1hcC5kcmFnUGFuKSByZXR1cm47XG4gICAgICAgIHRoaXMubWFwLmRyYWdQYW4uZGlzYWJsZSgpO1xuICAgIH0sIDApO1xuXG4gICAgdGhpcy51cGRhdGVVSUNsYXNzZXMoeyBtb3VzZTogY3Vyc29ycy5BREQgfSk7XG4gICAgdGhpcy5hY3RpdmF0ZVVJQnV0dG9uKHR5cGVzLlBPTFlHT04pO1xuICAgIHRoaXMuc2V0QWN0aW9uYWJsZVN0YXRlKHtcbiAgICAgICAgdHJhc2g6IHRydWVcbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHBvbHlnb24sXG4gICAgICAgIGN1cnJlbnRWZXJ0ZXhQb3NpdGlvbjogMCxcbiAgICAgICAgZHJhZ01vdmluZzogZmFsc2VcbiAgICB9O1xufTtcblxuRnJlZWhhbmRNb2RlLm9uRHJhZyA9IEZyZWVoYW5kTW9kZS5vblRvdWNoTW92ZSA9IGZ1bmN0aW9uIChzdGF0ZSwgZSl7XG4gICAgc3RhdGUuZHJhZ01vdmluZyA9IHRydWU7XG4gICAgdGhpcy51cGRhdGVVSUNsYXNzZXMoeyBtb3VzZTogY3Vyc29ycy5BREQgfSk7XG4gICAgc3RhdGUucG9seWdvbi51cGRhdGVDb29yZGluYXRlKGAwLiR7c3RhdGUuY3VycmVudFZlcnRleFBvc2l0aW9ufWAsIGUubG5nTGF0LmxuZywgZS5sbmdMYXQubGF0KTtcbiAgICBzdGF0ZS5jdXJyZW50VmVydGV4UG9zaXRpb24rKztcbiAgICBzdGF0ZS5wb2x5Z29uLnVwZGF0ZUNvb3JkaW5hdGUoYDAuJHtzdGF0ZS5jdXJyZW50VmVydGV4UG9zaXRpb259YCwgZS5sbmdMYXQubG5nLCBlLmxuZ0xhdC5sYXQpO1xufVxuXG5GcmVlaGFuZE1vZGUub25Nb3VzZVVwID0gZnVuY3Rpb24gKHN0YXRlLCBlKXtcbiAgICBpZiAoc3RhdGUuZHJhZ01vdmluZykge1xuICAgICAgICB0aGlzLnNpbXBsaWZ5KHN0YXRlLnBvbHlnb24pO1xuICAgICAgICB0aGlzLmZpcmVVcGRhdGUoKTtcbiAgICAgICAgdGhpcy5jaGFuZ2VNb2RlKG1vZGVzLlNJTVBMRV9TRUxFQ1QsIHsgZmVhdHVyZUlkczogW3N0YXRlLnBvbHlnb24uaWRdIH0pO1xuICAgIH1cbn1cblxuRnJlZWhhbmRNb2RlLm9uVG91Y2hFbmQgPSBmdW5jdGlvbihzdGF0ZSwgZSkge1xuICAgIHRoaXMub25Nb3VzZVVwKHN0YXRlLCBlKVxufVxuXG5GcmVlaGFuZE1vZGUuZmlyZVVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubWFwLmZpcmUoZXZlbnRzLlVQREFURSwge1xuICAgICAgICBhY3Rpb246IHVwZGF0ZUFjdGlvbnMuTU9WRSxcbiAgICAgICAgZmVhdHVyZXM6IHRoaXMuZ2V0U2VsZWN0ZWQoKS5tYXAoZiA9PiBmLnRvR2VvSlNPTigpKVxuICAgIH0pO1xufTtcblxuRnJlZWhhbmRNb2RlLnNpbXBsaWZ5ID0gZnVuY3Rpb24ocG9seWdvbikge1xuICBjb25zdCB0b2xlcmFuY2UgPSAxIC8gTWF0aC5wb3coMS4wNSwgMTAgKiB0aGlzLm1hcC5nZXRab29tKCkpIC8vIGh0dHBzOi8vd3d3LmRlc21vcy5jb20vY2FsY3VsYXRvci9ub2xwMGc2cHdyXG4gIHNpbXBsaWZ5KHBvbHlnb24sIHtcbiAgICAgIG11dGF0ZTogdHJ1ZSxcbiAgICAgIHRvbGVyYW5jZTogdG9sZXJhbmNlLFxuICAgICAgaGlnaFF1YWxpdHk6IHRydWVcbiAgfSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IEZyZWVoYW5kTW9kZVxuIiwiaW1wb3J0IEZyZWVoYW5kTW9kZSBmcm9tICcuLi9zcmMvaW5kZXguanMnO1xuXG5tYXBib3hnbC5hY2Nlc3NUb2tlbiA9ICdway5leUoxSWpvaVltVnVaV2h0YTJVaUxDSmhJam9pWTJwbFlUbDZiM2MyTUhnNU9ESnhiR1Y0YVhSNFozcDZZU0o5LmQzalNBYnNxU21wSnd5VmNwOWlYYncnO1xuICB2YXIgbWFwID0gbmV3IG1hcGJveGdsLk1hcCh7XG4gIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLFxuICBzdHlsZTogJ21hcGJveDovL3N0eWxlcy9tYXBib3gvc3RyZWV0cy12MTEnLFxuICBjZW50ZXI6IFstOTQuNzM3MjM2LCBcdDMyLjUxNDg4NV0sXG4gIHpvb206IDEyXG59KTtcblxudmFyIERyYXcgPSBuZXcgTWFwYm94RHJhdyh7XG4gIG1vZGVzOiBPYmplY3QuYXNzaWduKE1hcGJveERyYXcubW9kZXMsIHtcbiAgICBkcmF3X3BvbHlnb246IEZyZWVoYW5kTW9kZVxuICB9KVxufSk7XG5cbm1hcC5hZGRDb250cm9sKERyYXcsICd0b3AtbGVmdCcpO1xubWFwLm9uKCdkcmF3LmNyZWF0ZScsIGdlb2pzb25Gcm9tRHJhd2luZyk7XG5mdW5jdGlvbiBnZW9qc29uRnJvbURyYXdpbmcoKXtcbiAgICBjb25zb2xlLmxvZyhhcmd1bWVudHMsIERyYXcuZ2V0QWxsKCkpO1xufSJdLCJzb3VyY2VSb290IjoiIn0=